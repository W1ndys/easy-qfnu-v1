<!--è¯¾ç¨‹è¡¨é¡µé¢-->
<view class="container">
  <!-- å¤´éƒ¨æ§åˆ¶æ  -->
  <view class="header-controls card">
    <!-- è§†å›¾åˆ‡æ¢ -->
    <view class="view-toggle">
      <view 
        class="toggle-btn {{viewMode === 'week' ? 'active' : ''}}"
        data-mode="week"
        bindtap="switchViewMode"
      >
        å‘¨è§†å›¾
      </view>
      <view 
        class="toggle-btn {{viewMode === 'today' ? 'active' : ''}}"
        data-mode="today"
        bindtap="switchViewMode"
      >
        ä»Šæ—¥
      </view>
    </view>

    <!-- å¯¼å‡ºæŒ‰é’® -->
    <view class="export-btn" bindtap="exportSchedule">
      <text class="export-icon">ğŸ“¤</text>
    </view>
  </view>

  <!-- å‘¨è§†å›¾ -->
  <view class="week-view" wx:if="{{viewMode === 'week'}}">
    <!-- å‘¨æ¬¡æ§åˆ¶ -->
    <view class="week-control card">
      <view class="week-nav">
        <view 
          class="nav-btn {{currentWeek <= 1 ? 'disabled' : ''}}"
          data-direction="prev"
          bindtap="changeWeek"
        >
          â† ä¸Šä¸€å‘¨
        </view>
        <view class="week-info" bindtap="goToCurrentWeek">
          <text class="semester-text">{{currentSemester}}</text>
          <text class="week-text">ç¬¬{{currentWeek}}å‘¨</text>
        </view>
        <view 
          class="nav-btn {{currentWeek >= 20 ? 'disabled' : ''}}"
          data-direction="next"
          bindtap="changeWeek"
        >
          ä¸‹ä¸€å‘¨ â†’
        </view>
      </view>
    </view>

    <!-- è¯¾ç¨‹è¡¨æ ¼ -->
    <view class="schedule-table card">
      <!-- è¡¨å¤´ -->
      <view class="table-header">
        <view class="time-header">æ—¶é—´</view>
        <view class="day-header" wx:for="{{weekDays}}" wx:key="index">
          {{item}}
        </view>
      </view>

      <!-- è¡¨æ ¼å†…å®¹ -->
      <view class="table-body">
        <view class="time-row" wx:for="{{timeSlots}}" wx:for-item="slot" wx:for-index="slotIndex" wx:key="slotIndex">
          <!-- æ—¶é—´åˆ— -->
          <view class="time-cell">
            <text class="period-text">{{slot.period}}</text>
            <text class="time-text">{{slot.time}}</text>
          </view>

          <!-- è¯¾ç¨‹åˆ— -->
          <view class="course-cell" wx:for="{{weekDays}}" wx:for-index="dayIndex" wx:key="dayIndex">
            <view 
              class="course-item"
              wx:for="{{coursesGrid[slotIndex][dayIndex]}}"
              wx:for-item="course"
              wx:key="index"
              data-course="{{course}}"
              bindtap="onCourseTap"
            >
              <text class="course-name">{{course.course_info.course_name}}</text>
              <text class="course-location">{{course.course_info.location}}</text>
              <text class="course-teacher">{{course.course_info.teacher}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥è§†å›¾ -->
  <view class="today-view" wx:if="{{viewMode === 'today'}}">
    <!-- æ—¥æœŸä¿¡æ¯ -->
    <view class="date-info card">
      <view class="date-header">
        <text class="date-title">ä»Šæ—¥è¯¾ç¨‹</text>
        <text class="date-text">{{currentDate}}</text>
      </view>
    </view>

    <!-- ä»Šæ—¥è¯¾ç¨‹åˆ—è¡¨ -->
    <view class="today-courses" wx:if="{{todayCourses.length > 0}}">
      <view 
        class="today-course-item card"
        wx:for="{{todayCourses}}"
        wx:key="index"
        data-course="{{item}}"
        bindtap="onTodayCourseTap"
      >
        <view class="course-time-badge {{item.statusClass}}">
          <text class="time-start">{{item.start_time}}</text>
          <text class="time-divider">-</text>
          <text class="time-end">{{item.end_time}}</text>
        </view>

        <view class="course-details">
          <text class="course-title">{{item.course_info.course_name}}</text>
          <view class="course-meta">
            <text class="meta-item">ğŸ“ {{item.course_info.location}}</text>
            <text class="meta-item">ğŸ‘¨â€ğŸ« {{item.course_info.teacher}}</text>
            <text class="meta-item">ğŸ“š {{item.class_period}}</text>
          </view>
        </view>

        <view class="course-status">
          <text class="status-text {{item.statusClass}}">{{item.statusText}}</text>
          <text class="course-arrow">></text>
        </view>
      </view>
    </view>

    <!-- ä»Šæ—¥æ— è¯¾ -->
    <view class="no-courses-today card" wx:else>
      <view class="empty-state">
        <text class="empty-icon">ğŸ“…</text>
        <text class="empty-text">ä»Šæ—¥æ— è¯¾ç¨‹å®‰æ’</text>
        <text class="empty-desc">å¥½å¥½ä¼‘æ¯æˆ–è‡ªä¸»å­¦ä¹ å§ï¼</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{isLoading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!isLoading && schedule.length === 0 && viewMode === 'week'}}">
    <text class="empty-icon">ğŸ“š</text>
    <text class="empty-text">æš‚æ— è¯¾ç¨‹è¡¨æ•°æ®</text>
    <text class="empty-desc">è¯·æ£€æŸ¥ç½‘ç»œæˆ–ä¸‹æ‹‰åˆ·æ–°</text>
  </view>
</view>

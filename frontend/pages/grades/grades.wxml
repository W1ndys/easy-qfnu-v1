<!--æˆç»©æŸ¥è¯¢é¡µé¢-->
<view class="container">
  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-card card" wx:if="{{gradeStats}}">
    <view class="stats-header">
      <text class="stats-title">æˆç»©ç»Ÿè®¡</text>
      <text class="detail-btn" bindtap="showStatsDetail">è¯¦æƒ…</text>
    </view>
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-value">{{gradeStats.gpa}}</text>
        <text class="stat-label">æ€»GPA</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{gradeStats.weighted_average}}</text>
        <text class="stat-label">åŠ æƒå¹³å‡</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{gradeStats.total_credits}}</text>
        <text class="stat-label">æ€»å­¦åˆ†</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{gradeStats.total_courses}}</text>
        <text class="stat-label">æ€»è¯¾ç¨‹</text>
      </view>
    </view>
    
    <!-- é¢å¤–ç»Ÿè®¡ -->
    <view class="extra-stats">
      <view class="extra-stat excellent">
        <text class="extra-label">ä¼˜ç§€è¯¾ç¨‹</text>
        <text class="extra-value">{{gradeStats.excellent_courses}}é—¨</text>
      </view>
      <view class="extra-stat failed" wx:if="{{gradeStats.failed_courses > 0}}">
        <text class="extra-label">æŒ‚ç§‘è¯¾ç¨‹</text>
        <text class="extra-value">{{gradeStats.failed_courses}}é—¨</text>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰å’Œæ’åº -->
  <view class="filter-card card">
    <view class="filter-row">
      <!-- å­¦æœŸç­›é€‰ -->
      <view class="filter-item">
        <text class="filter-label">å­¦æœŸç­›é€‰ï¼š</text>
        <view class="semester-picker" bindtap="showSemesterPicker">
          <text class="semester-text">{{selectedSemester || 'å…¨éƒ¨å­¦æœŸ'}}</text>
          <text class="picker-arrow">ğŸ“…</text>
        </view>
      </view>
      
      <!-- å¯¼å‡ºæŒ‰é’® -->
      <view class="export-btn" bindtap="exportGrades">
        <text class="export-icon">ğŸ“¤</text>
        <text class="export-text">å¯¼å‡º</text>
      </view>
    </view>

    <!-- æ’åºé€‰é¡¹ -->
    <view class="sort-row">
      <text class="sort-label">æ’åºï¼š</text>
      <view class="sort-options">
        <view 
          class="sort-option {{sortBy === 'semester' ? 'active' : ''}}"
          data-sort="semester"
          bindtap="onSortChange"
        >
          å­¦æœŸ{{semesterSortIcon}}
        </view>
        <view 
          class="sort-option {{sortBy === 'score' ? 'active' : ''}}"
          data-sort="score"
          bindtap="onSortChange"
        >
          æˆç»©{{scoreSortIcon}}
        </view>
        <view 
          class="sort-option {{sortBy === 'credit' ? 'active' : ''}}"
          data-sort="credit"
          bindtap="onSortChange"
        >
          å­¦åˆ†{{creditSortIcon}}
        </view>
      </view>
    </view>
  </view>

  <!-- æˆç»©åˆ—è¡¨ -->
  <view class="grades-list">
    <view 
      class="grade-item card"
      wx:for="{{grades}}" 
      wx:key="index"
      data-grade="{{item}}"
      bindtap="showGradeDetail"
    >
      <view class="grade-header">
        <text class="course-name">{{item.course_name}}</text>
        <view class="score-badge {{item.score >= 90 ? 'excellent' : item.score >= 80 ? 'good' : item.score >= 60 ? 'pass' : 'fail'}}">
          {{item.score}}
        </view>
      </view>
      
      <view class="grade-details">
        <view class="detail-row">
          <text class="detail-label">å­¦æœŸï¼š</text>
          <text class="detail-value">{{item.semester}}</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">å­¦åˆ†ï¼š</text>
          <text class="detail-value">{{item.credit}}</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">ç»©ç‚¹ï¼š</text>
          <text class="detail-value">{{item.grade_point}}</text>
        </view>
        <view class="detail-row" wx:if="{{item.teacher}}">
          <text class="detail-label">æ•™å¸ˆï¼š</text>
          <text class="detail-value">{{item.teacher}}</text>
        </view>
      </view>
      
      <view class="grade-footer">
        <text class="course-type">{{item.course_type || 'å¿…ä¿®'}}</text>
        <text class="view-detail">æŸ¥çœ‹è¯¦æƒ… ></text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!isLoading && grades.length === 0}}">
    <text class="empty-icon">ğŸ“Š</text>
    <text class="empty-text">æš‚æ— æˆç»©æ•°æ®</text>
    <text class="empty-desc">ä¸‹æ‹‰åˆ·æ–°è¯•è¯•</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{isLoading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>

<!-- å­¦æœŸé€‰æ‹©å™¨ -->
<view class="picker-overlay {{showSemesterPicker ? 'show' : ''}}" bindtap="hideSemesterPicker">
  <view class="picker-content" catchtap="">
    <view class="picker-header">
      <text class="picker-title">é€‰æ‹©å­¦æœŸ</text>
      <text class="picker-close" bindtap="hideSemesterPicker">âœ•</text>
    </view>
    <picker-view class="picker-view" bindchange="onSemesterChange">
      <picker-view-column>
        <view class="picker-item">å…¨éƒ¨å­¦æœŸ</view>
        <view class="picker-item" wx:for="{{semesters}}" wx:key="index">{{item}}</view>
      </picker-view-column>
    </picker-view>
  </view>
</view>

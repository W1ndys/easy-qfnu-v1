<!--æˆç»©é¡µé¢ - ç®€æ´ç°ç™½è®¾è®¡-->
<view class="container">
  <!-- æˆç»©ç»Ÿè®¡æ‘˜è¦ -->
  <view class="grade-summary fade-in" wx:if="{{summary}}">
    <text class="summary-title">æˆç»©æ¦‚å†µ</text>
    <view class="summary-stats">
      <view class="stat-item">
        <text class="stat-value stat-gpa">{{summary.gpa || '-'}}</text>
        <text class="stat-label">å¹³å‡ç»©ç‚¹</text>
      </view>
      <view class="stat-item">
        <text class="stat-value stat-credits">{{summary.totalCredits || '-'}}</text>
        <text class="stat-label">æ€»å­¦åˆ†</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{summary.totalCourses || '-'}}</text>
        <text class="stat-label">è¯¾ç¨‹æ•°</text>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰å’Œæ’åº -->
  <view class="filter-section fade-in">
    <view class="filter-row">
      <text class="filter-label">å­¦æœŸç­›é€‰</text>
      <view class="filter-controls">
        <picker 
          class="semester-picker"
          mode="selector"
          range="{{semesterOptions}}"
          range-key="label"
          value="{{selectedSemesterIndex}}"
          bindchange="onSemesterChange"
        >
          <text>{{selectedSemester.label || 'å…¨éƒ¨å­¦æœŸ'}}</text>
        </picker>
      </view>
    </view>
    
    <view class="filter-row">
      <text class="filter-label">æ’åºæ–¹å¼</text>
      <view class="sort-buttons">
        <view 
          class="sort-btn {{sortBy === 'semester' ? 'active' : ''}}"
          data-sort="semester"
          bindtap="onSortChange"
        >
          <text>å­¦æœŸ</text>
          <text class="sort-icon">{{semesterSortIcon}}</text>
        </view>
        <view 
          class="sort-btn {{sortBy === 'score' ? 'active' : ''}}"
          data-sort="score"
          bindtap="onSortChange"
        >
          <text>æˆç»©</text>
          <text class="sort-icon">{{scoreSortIcon}}</text>
        </view>
        <view 
          class="sort-btn {{sortBy === 'credit' ? 'active' : ''}}"
          data-sort="credit"
          bindtap="onSortChange"
        >
          <text>å­¦åˆ†</text>
          <text class="sort-icon">{{creditSortIcon}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æˆç»©åˆ—è¡¨ -->
  <view class="grades-list fade-in" wx:if="{{filteredGrades.length > 0}}">
    <view 
      class="semester-group"
      wx:for="{{groupedGrades}}" 
      wx:key="semester"
    >
      <view class="semester-header">
        <text class="semester-title">{{item.semester}}</text>
        <text class="semester-stats">{{item.grades.length}}é—¨è¯¾ç¨‹</text>
      </view>
      
      <view 
        class="grade-item"
        wx:for="{{item.grades}}" 
        wx:for-item="grade"
        wx:key="id"
        bindtap="showGradeDetail"
        data-grade="{{grade}}"
      >
        <view class="grade-header">
          <text class="course-name">{{grade.courseName}}</text>
          <text class="grade-score {{grade.scoreClass}}">{{grade.displayScore}}</text>
        </view>
        
        <view class="grade-details">
          <view class="course-info">
            <view class="info-item">
              <text>å­¦åˆ†ï¼š</text>
              <text class="grade-point">{{grade.credits}}</text>
            </view>
            <view class="info-item">
              <text>ç»©ç‚¹ï¼š</text>
              <text class="grade-point">{{grade.gradePoint}}</text>
            </view>
            <view class="info-item" wx:if="{{grade.courseType}}">
              <text>{{grade.courseType}}</text>
            </view>
          </view>
          <text>{{grade.semester}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-grades" wx:if="{{!isLoading && filteredGrades.length === 0}}">
    <view class="empty-icon">ğŸ“š</view>
    <text class="empty-text">æš‚æ— æˆç»©æ•°æ®</text>
    <text class="empty-desc">è¯·ç¨åé‡è¯•æˆ–æ£€æŸ¥ç½‘ç»œè¿æ¥</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <view class="loading-icon"></view>
    <text class="loading-text">æ­£åœ¨åŠ è½½æˆç»©æ•°æ®...</text>
  </view>

  <!-- ä¸‹æ‹‰åˆ·æ–°æç¤º -->
  <view class="refresh-tip" wx:if="{{!isLoading && filteredGrades.length > 0}}">
    <text class="refresh-tip-text">ä¸‹æ‹‰å¯åˆ·æ–°æ•°æ®</text>
  </view>

  <!-- æˆç»©è¯¦æƒ…å¼¹çª— -->
  <view class="grade-detail-modal" wx:if="{{showDetailModal}}" bindtap="hideGradeDetail">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">{{selectedGrade.courseName}}</text>
      </view>
      
      <view class="modal-body">
        <view class="detail-item">
          <text class="detail-label">è¯¾ç¨‹æˆç»©</text>
          <text class="detail-value {{selectedGrade.scoreClass}}">{{selectedGrade.displayScore}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å­¦åˆ†</text>
          <text class="detail-value">{{selectedGrade.credits}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">ç»©ç‚¹</text>
          <text class="detail-value">{{selectedGrade.gradePoint}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">è¯¾ç¨‹æ€§è´¨</text>
          <text class="detail-value">{{selectedGrade.courseType || 'æœªçŸ¥'}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å­¦æœŸ</text>
          <text class="detail-value">{{selectedGrade.semester}}</text>
        </view>
        <view class="detail-item" wx:if="{{selectedGrade.teacher}}">
          <text class="detail-label">ä»»è¯¾æ•™å¸ˆ</text>
          <text class="detail-value">{{selectedGrade.teacher}}</text>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="modal-close-btn" bindtap="hideGradeDetail">å…³é—­</button>
      </view>
    </view>
  </view>
</view>
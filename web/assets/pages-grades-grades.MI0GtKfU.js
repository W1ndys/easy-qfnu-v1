import{l as e,p as a,Z as l,q as s,s as t,u,A as c,v as d,r as i,c as o,w as n,o as r,a as f,j as _,t as v,f as m,R as g,F as p,d as k,_ as y,$ as h,g as b,k as x,a0 as A,K as P,n as C,M as w,N as G}from"./index-B_lwVLEp.js";import{o as N,a as j,r as F,_ as T}from"./uni-app.es.p6p1YEjm.js";import{P as S}from"./PageLayout._wayZIu7.js";import{L as O,E as $}from"./EmptyState.C_EDZMJn.js";import{_ as z}from"./_plugin-vue_export-helper.BCo6x5W8.js";const B=z({__name:"grades",setup(z){const B=e().globalData.apiBaseURL,E=`${B}/api/v1/grades`,L=`${B}/api/v1/gpa/calculate`,R=a(!0),M=a([]),q=a(null),D=a(null),H=a(null),I=a(null),K=a(0),U=a([]),Z=a(!1),J=a([]),Q=a(!1),V=a(null),W=a(new Set),X=a(!1),Y=l((()=>0===M.value.length)),ee=l((()=>`å·²é€‰ ${J.value.length} / ${U.value.length} é—¨`)),ae=l((()=>Q.value||0===J.value.length));N((()=>{le(),setTimeout((()=>{(M.value.length>0||!R.value)&&(X.value=!0)}),500)})),j((()=>{s("token")||(t({title:"è¯·å…ˆç™»å½•",icon:"none"}),u({url:"/pages/index/index"}))}));const le=()=>{if(!s("token"))return t({title:"è¯·å…ˆç™»å½•",icon:"none"}),void u({url:"/pages/index/index"});se()},se=async()=>{R.value=!0;try{const{statusCode:e,data:a}=await c({url:E,method:"GET",header:{Authorization:"Bearer "+s("token")}});200===e&&a.success?(U.value=a.data||[],M.value=te(U.value),q.value=a.basic_gpa,D.value=a.semester_gpa,H.value=a.yearly_gpa,I.value=a.effective_gpa,K.value=U.value.length):401===e?(d("token"),t({title:"ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•",icon:"none"}),setTimeout((()=>u({url:"/pages/index/index"})),1500)):t({title:a.detail||"èŽ·å–æˆç»©å¤±è´¥",icon:"none"})}catch(e){console.error("è¯·æ±‚å¤±è´¥",e),t({title:"æœåŠ¡å™¨è¿žæŽ¥å¤±è´¥",icon:"none"})}finally{R.value=!1}},te=e=>{if(!e||0===e.length)return[];const a=e.reduce(((e,a)=>((e[a.semester]=e[a.semester]||[]).push(a),e)),{});return Object.keys(a).map((e=>({semesterName:e,grades:a[e]}))).sort(((e,a)=>a.semesterName.localeCompare(e.semesterName)))},ue=e=>J.value.includes(e),ce=e=>W.value.has(e),de=e=>{var a;Z.value?re(e.index):(a=e.index,W.value.has(a)?W.value.delete(a):W.value.add(a))},ie=e=>{const a=parseFloat(e);return isNaN(a)?"score-text-grade":a>=90?"score-high":a>=75?"score-mid":a>=60?"score-low":"score-fail"},oe=()=>{X.value=!1},ne=e=>{Z.value=e.detail.value,Z.value||(_e(),ve())},re=e=>{const a=J.value.indexOf(e);a>-1?J.value.splice(a,1):J.value.push(e),ve()},fe=()=>{J.value=U.value.map((e=>e.index)),ve()},_e=()=>{J.value=[],ve()},ve=()=>{V.value=null},me=async()=>{if(0===J.value.length)return void t({title:"è¯·è‡³å°‘é€‰æ‹©ä¸€é—¨è¯¾ç¨‹",icon:"none"});Q.value=!0;const e={include_indices:J.value.map(String),remove_retakes:!0};try{const{statusCode:a,data:l}=await c({url:L,method:"POST",header:{Authorization:"Bearer "+s("token"),"Content-Type":"application/json"},data:e});200===a&&l.success?(V.value=l.data,t({title:"GPAè®¡ç®—å®Œæˆ",icon:"success"})):t({title:l.detail||"GPAè®¡ç®—å¤±è´¥",icon:"none"})}catch(a){console.error("GPAè®¡ç®—è¯·æ±‚å¤±è´¥",a),t({title:"ç½‘ç»œè¿žæŽ¥å¤±è´¥",icon:"none"})}finally{Q.value=!1}};return(e,a)=>{const l=b,s=x,t=A,u=F(i("uni-icons"),T),c=P;return r(),o(S,null,{default:n((()=>[R.value?(r(),o(O,{key:0,text:"æ­£åœ¨ä»Žæ•™åŠ¡ç³»ç»ŸåŒæ­¥æˆç»©..."})):(r(),o(l,{key:1,class:"page-container page-rounded-container"},{default:n((()=>[f(l,{class:"background-decoration"},{default:n((()=>[f(l,{class:"circle circle-1"}),f(l,{class:"circle circle-2"}),f(l,{class:"circle circle-3"})])),_:1}),f(l,{class:"content-wrapper"},{default:n((()=>[Y.value?(r(),o($,{key:0,"icon-type":"info-filled",title:"æ²¡æœ‰æŸ¥è¯¢åˆ°ä»»ä½•æˆç»©è®°å½•",description:"è¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥æˆ–ç¨åŽé‡è¯•","show-retry":!0,onRetry:se})):(r(),o(l,{key:1},{default:n((()=>[q.value?(r(),o(l,{key:0,class:"analysis-container"},{default:n((()=>[f(l,{class:"main-gpa-section"},{default:n((()=>[f(l,{class:"gpa-item"},{default:n((()=>[f(s,{class:"gpa-value"},{default:n((()=>{var e,a;return[_(v((null==(a=null==(e=q.value)?void 0:e.weighted_gpa)?void 0:a.toFixed(2))||"N/A"),1)]})),_:1}),f(s,{class:"gpa-label"},{default:n((()=>[_("æ€»åŠ æƒå¹³å‡GPA")])),_:1})])),_:1}),f(l,{class:"gpa-item"},{default:n((()=>[f(s,{class:"gpa-value"},{default:n((()=>{var e,a;return[_(v((null==(a=null==(e=I.value)?void 0:e.weighted_gpa)?void 0:a.toFixed(2))||"N/A"),1)]})),_:1}),f(s,{class:"gpa-label"},{default:n((()=>[_("æœ‰æ•ˆGPA (åŽ»é‡ä¿®)")])),_:1})])),_:1}),f(l,{class:"gpa-item"},{default:n((()=>[f(s,{class:"gpa-value"},{default:n((()=>[_(v(K.value||0),1)])),_:1}),f(s,{class:"gpa-label"},{default:n((()=>[_("æ€»è¯¾ç¨‹æ•°")])),_:1})])),_:1})])),_:1}),f(l,{class:"detailed-gpa-section"},{default:n((()=>[f(l,{class:"section-header"},{default:n((()=>[f(s,{class:"section-title"},{default:n((()=>[_("è¯¦ç»†GPAåˆ†å¸ƒ")])),_:1})])),_:1}),f(l,{class:"details-flex-container"},{default:n((()=>[H.value&&Object.keys(H.value).length>0?(r(!0),m(p,{key:0},g(H.value,((e,a)=>(r(),o(l,{key:a,class:"detail-item-flex"},{default:n((()=>[f(s,{class:"detail-label"},{default:n((()=>[_(v(a)+"å­¦å¹´",1)])),_:2},1024),f(s,{class:"detail-sub-info"},{default:n((()=>[_(v(e.course_count)+"é—¨ / "+v(e.total_credit.toFixed(1))+"å­¦åˆ†",1)])),_:2},1024),f(s,{class:"detail-value"},{default:n((()=>[_(v(e.weighted_gpa.toFixed(2)),1)])),_:2},1024)])),_:2},1024)))),128)):k("",!0),D.value&&Object.keys(D.value).length>0?(r(!0),m(p,{key:1},g(D.value,((e,a)=>(r(),o(l,{key:a,class:"detail-item-flex"},{default:n((()=>[f(s,{class:"detail-label"},{default:n((()=>[_(v(a),1)])),_:2},1024),f(s,{class:"detail-sub-info"},{default:n((()=>[_(v(e.course_count)+"é—¨ / "+v(e.total_credit.toFixed(1))+"å­¦åˆ†",1)])),_:2},1024),f(s,{class:"detail-value"},{default:n((()=>[_(v(e.weighted_gpa.toFixed(2)),1)])),_:2},1024)])),_:2},1024)))),128)):k("",!0)])),_:1})])),_:1})])),_:1})):k("",!0),f(l,{class:"custom-gpa-toggle-section"},{default:n((()=>[f(l,{class:"toggle-left"},{default:n((()=>[f(s,{class:"toggle-title"},{default:n((()=>[_("è‡ªå®šä¹‰GPAè®¡ç®—")])),_:1}),f(s,{class:"toggle-desc"},{default:n((()=>[_("å‹¾é€‰è¯¾ç¨‹ä»¥è®¡ç®—ç‰¹å®šGPA")])),_:1})])),_:1}),f(t,{checked:Z.value,onChange:ne,color:"#7F4515"},null,8,["checked"])])),_:1}),Z.value?(r(),o(l,{key:1,class:"custom-mode-tip"},{default:n((()=>[f(l,{class:"tip-icon"},{default:n((()=>[_("ðŸ’¡")])),_:1}),f(s,{class:"tip-text"},{default:n((()=>[_("è¯·å‹¾é€‰ **éœ€è¦è®¡å…¥** GPAçš„è¯¾ç¨‹")])),_:1})])),_:1})):k("",!0),f(l,{class:"grades-list-container"},{default:n((()=>[(r(!0),m(p,null,g(M.value,(e=>(r(),o(l,{key:e.semesterName,class:"semester-block"},{default:n((()=>[f(l,{class:"semester-header"},{default:n((()=>[f(s,{class:"semester-name"},{default:n((()=>[_(v(e.semesterName),1)])),_:2},1024)])),_:2},1024),f(l,{class:"courses-list"},{default:n((()=>[(r(!0),m(p,null,g(e.grades,(e=>(r(),o(l,{key:e.index,class:C(["course-card",{"is-custom-mode":Z.value,"is-selected":ue(e.index)}])},{default:n((()=>[f(l,{class:"course-main",onClick:a=>de(e)},{default:n((()=>[Z.value?(r(),o(l,{key:0,class:"course-checkbox-wrapper"},{default:n((()=>[f(l,{class:C(["checkbox-inner",{checked:ue(e.index)}])},null,8,["class"])])),_:2},1024)):k("",!0),f(l,{class:"course-core-info"},{default:n((()=>[f(s,{class:"course-name"},{default:n((()=>[_(v(e.courseName),1)])),_:2},1024),f(l,{class:"course-meta"},{default:n((()=>[f(l,{class:"meta-tag credit"},{default:n((()=>[_("å­¦åˆ†: "+v(e.credit),1)])),_:2},1024),f(l,{class:"meta-tag gpa"},{default:n((()=>[_("ç»©ç‚¹: "+v(e.gpa),1)])),_:2},1024),e.courseAttribute?(r(),o(l,{key:0,class:"meta-tag attribute"},{default:n((()=>[_(v(e.courseAttribute),1)])),_:2},1024)):k("",!0)])),_:2},1024)])),_:2},1024),f(l,{class:"course-side"},{default:n((()=>[f(l,{class:"course-score"},{default:n((()=>[f(s,{class:C(["score-text",ie(e.score)])},{default:n((()=>[_(v(e.score),1)])),_:2},1032,["class"]),e.scoreTag?(r(),o(s,{key:0,class:"score-tag"},{default:n((()=>[_(v(e.scoreTag),1)])),_:2},1024)):k("",!0)])),_:2},1024),f(l,{class:C(["expand-icon",{expanded:ce(e.index)}])},{default:n((()=>[f(u,{type:"down",size:"16",color:"#868e96"})])),_:2},1032,["class"])])),_:2},1024)])),_:2},1032,["onClick"]),w(f(l,{class:"course-details"},{default:n((()=>[f(l,{class:"detail-grid"},{default:n((()=>[f(l,{class:"detail-item"},{default:n((()=>[f(s,{class:"detail-label"},{default:n((()=>[_("è¯¾ç¨‹ä»£ç ")])),_:1}),f(s,{class:"detail-value"},{default:n((()=>[_(v(e.courseCode),1)])),_:2},1024)])),_:2},1024),f(l,{class:"detail-item"},{default:n((()=>[f(s,{class:"detail-label"},{default:n((()=>[_("æ€»å­¦æ—¶")])),_:1}),f(s,{class:"detail-value"},{default:n((()=>[_(v(e.totalHours),1)])),_:2},1024)])),_:2},1024),f(l,{class:"detail-item"},{default:n((()=>[f(s,{class:"detail-label"},{default:n((()=>[_("è¯¾ç¨‹æ€§è´¨")])),_:1}),f(s,{class:"detail-value"},{default:n((()=>[_(v(e.courseNature),1)])),_:2},1024)])),_:2},1024),f(l,{class:"detail-item"},{default:n((()=>[f(s,{class:"detail-label"},{default:n((()=>[_("è¯¾ç¨‹ç±»åˆ«")])),_:1}),f(s,{class:"detail-value"},{default:n((()=>[_(v(e.courseCategory),1)])),_:2},1024)])),_:2},1024),f(l,{class:"detail-item"},{default:n((()=>[f(s,{class:"detail-label"},{default:n((()=>[_("è€ƒæ ¸æ–¹å¼")])),_:1}),f(s,{class:"detail-value"},{default:n((()=>[_(v(e.assessmentMethod),1)])),_:2},1024)])),_:2},1024),f(l,{class:"detail-item"},{default:n((()=>[f(s,{class:"detail-label"},{default:n((()=>[_("è€ƒè¯•ç±»åž‹")])),_:1}),f(s,{class:"detail-value"},{default:n((()=>[_(v(e.examType),1)])),_:2},1024)])),_:2},1024),e.groupName?(r(),o(l,{key:0,class:"detail-item"},{default:n((()=>[f(s,{class:"detail-label"},{default:n((()=>[_("è¯¾ç¨‹åˆ†ç»„")])),_:1}),f(s,{class:"detail-value"},{default:n((()=>[_(v(e.groupName),1)])),_:2},1024)])),_:2},1024)):k("",!0),e.retakeSemester?(r(),o(l,{key:1,class:"detail-item"},{default:n((()=>[f(s,{class:"detail-label"},{default:n((()=>[_("é‡ä¿®å­¦æœŸ")])),_:1}),f(s,{class:"detail-value"},{default:n((()=>[_(v(e.retakeSemester),1)])),_:2},1024)])),_:2},1024)):k("",!0)])),_:2},1024)])),_:2},1536),[[G,ce(e.index)]])])),_:2},1032,["class"])))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}))])),_:1})])),_:1})),Z.value?(r(),o(l,{key:2,class:"custom-gpa-footer"},{default:n((()=>[V.value?(r(),o(l,{key:0,class:"result-display-card"},{default:n((()=>[f(l,{class:"result-header"},{default:n((()=>[f(s,{class:"result-title"},{default:n((()=>[_("è‡ªå®šä¹‰è®¡ç®—ç»“æžœ")])),_:1}),f(s,{class:"close-result-btn",onClick:ve},{default:n((()=>[_("å…³é—­")])),_:1})])),_:1}),f(l,{class:"result-content"},{default:n((()=>[f(l,{class:"result-gpa"},{default:n((()=>[f(s,{class:"gpa-value"},{default:n((()=>{var e;return[_(v((null==(e=V.value.weighted_gpa)?void 0:e.toFixed(2))||"0.00"),1)]})),_:1}),f(s,{class:"gpa-label"},{default:n((()=>[_("åŠ æƒå¹³å‡GPA")])),_:1})])),_:1}),f(l,{class:"result-stats"},{default:n((()=>[f(l,{class:"stat-item"},{default:n((()=>[f(s,{class:"stat-value"},{default:n((()=>[_(v(V.value.total_credit||0),1)])),_:1}),f(s,{class:"stat-label"},{default:n((()=>[_("æ€»å­¦åˆ†")])),_:1})])),_:1}),f(l,{class:"stat-item"},{default:n((()=>[f(s,{class:"stat-value"},{default:n((()=>[_(v(V.value.course_count||0),1)])),_:1}),f(s,{class:"stat-label"},{default:n((()=>[_("è¯¾ç¨‹æ•°")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):k("",!0),f(l,{class:"footer-actions"},{default:n((()=>[f(l,{class:"selection-info"},{default:n((()=>[f(s,{class:"info-text"},{default:n((()=>[_(v(ee.value),1)])),_:1}),f(l,{class:"actions"},{default:n((()=>[f(s,{class:"action-btn",onClick:fe},{default:n((()=>[_("å…¨é€‰")])),_:1}),f(s,{class:"action-btn",onClick:_e},{default:n((()=>[_("æ¸…ç©º")])),_:1})])),_:1})])),_:1}),f(c,{class:"calculate-btn",onClick:me,disabled:ae.value},{default:n((()=>[_(v(Q.value?"è®¡ç®—ä¸­...":"è®¡ç®—è‡ªå®šä¹‰GPA"),1)])),_:1},8,["disabled"])])),_:1})])),_:1})):k("",!0),f(h,{name:"modal"},{default:n((()=>[X.value?(r(),o(l,{key:0,class:"modal-overlay",onClick:y(oe,["self"])},{default:n((()=>[f(l,{class:"modal-container"},{default:n((()=>[f(l,{class:"modal-header"},{default:n((()=>[f(s,{class:"modal-title"},{default:n((()=>[_("æˆç»©æŸ¥è¯¢ä¸ŽGPAåˆ†æžæç¤º")])),_:1})])),_:1}),f(l,{class:"modal-content"},{default:n((()=>[f(s,null,{default:n((()=>[_(" å› ä¸åŒä¸“ä¸šæˆ–ä¸åŒç›®æ ‡é™¢æ ¡çš„è¦æ±‚ä¸åŒï¼Œä¿ç ”æ‰€éœ€è¦çš„ç»©ç‚¹è¦æ±‚ä¸åŒï¼Œå¦‚æœ‰éœ€æ±‚ï¼Œè¯·å‰å¾€åº•éƒ¨è‡ªå®šä¹‰GPAè®¡ç®—è‡ªè¡Œè®¡ç®— ")])),_:1})])),_:1}),f(l,{class:"modal-footer"},{default:n((()=>[f(c,{class:"modal-btn",onClick:oe},{default:n((()=>[_("æˆ‘å·²çŸ¥æ™“")])),_:1})])),_:1})])),_:1})])),_:1})):k("",!0)])),_:1})])),_:1})}}},[["__scopeId","data-v-dd22f1a4"]]);export{B as default};

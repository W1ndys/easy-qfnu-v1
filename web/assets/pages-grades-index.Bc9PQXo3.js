import{o as e,c as a,w as l,a as s,j as t,t as u,d as c,f as d,F as i,P as o,g as r,p as n,q as f,s as _,u as p,z as g,l as v,v as m,r as y,k,W as h,J as b,n as x,L as G,M as A}from"./index-MH9vcbHw.js";import{_ as P,o as C,b as w,r as N,a as j}from"./uni-app.es.Bi0WrrUT.js";import{M as O,P as T}from"./ModernCard.BQ9MfCAS.js";import{L as S,E as z}from"./EmptyState.--jU9UPG.js";const B=P({__name:"GPAAnalysis",props:{gpaAnalysis:{type:Object,required:!0},effectiveGpa:{type:Object,default:null},yearlyGpa:{type:Object,default:null},semesterGpa:{type:Object,default:null},totalCourses:{type:Number,default:0}},setup:n=>(f,_)=>{const p=r;return e(),a(p,{class:"gpa-analysis"},{default:l((()=>[s(O,{title:"GPAç»¼åˆåˆ†æž",highlight:""},{default:l((()=>[s(p,{class:"main-gpa-container"},{default:l((()=>[s(p,{class:"main-gpa-item highlight"},{default:l((()=>[s(p,{class:"gpa-label"},{default:l((()=>[t("æœ‰æ•ˆGPA")])),_:1}),n.effectiveGpa?(e(),a(p,{key:0,class:"gpa-value primary"},{default:l((()=>[t(u(n.effectiveGpa.weighted_gpa),1)])),_:1})):c("",!0),n.effectiveGpa?(e(),a(p,{key:1,class:"gpa-detail"},{default:l((()=>[t(" å­¦åˆ†: "+u(n.effectiveGpa.total_credit)+" | è¯¾ç¨‹: "+u(n.effectiveGpa.course_count),1)])),_:1})):c("",!0),s(p,{class:"gpa-note"},{default:l((()=>[t("åŽ»é‡ä¿®è¡¥è€ƒï¼Œå–æœ€é«˜æˆç»©")])),_:1})])),_:1}),s(p,{class:"gpa-divider"}),s(p,{class:"main-gpa-item"},{default:l((()=>[s(p,{class:"gpa-label"},{default:l((()=>[t("åŸºç¡€GPA")])),_:1}),s(p,{class:"gpa-value"},{default:l((()=>[t(u(n.gpaAnalysis.basic_gpa.weighted_gpa),1)])),_:1}),s(p,{class:"gpa-detail"},{default:l((()=>[t(" å­¦åˆ†: "+u(n.gpaAnalysis.basic_gpa.total_credit)+" | è¯¾ç¨‹: "+u(n.gpaAnalysis.basic_gpa.course_count),1)])),_:1}),s(p,{class:"gpa-note"},{default:l((()=>[t("åŒ…å«æ‰€æœ‰æˆç»©")])),_:1})])),_:1})])),_:1}),s(p,{class:"total-courses"},{default:l((()=>[t("æ€»è¯¾ç¨‹æ•°: "+u(n.totalCourses),1)])),_:1})])),_:1}),n.yearlyGpa?(e(),a(O,{key:0,title:"æŒ‰å­¦å¹´GPAåˆ†æž"},{default:l((()=>[s(p,{class:"yearly-gpa-container"},{default:l((()=>[(e(!0),d(i,null,o(n.yearlyGpa,((c,d)=>(e(),a(p,{key:d,class:"yearly-item"},{default:l((()=>[s(p,{class:"year-title"},{default:l((()=>[t(u(d)+"å­¦å¹´",1)])),_:2},1024),s(p,{class:"year-gpa"},{default:l((()=>[t(u(c.weighted_gpa),1)])),_:2},1024),s(p,{class:"year-detail"},{default:l((()=>[t(" å­¦åˆ†: "+u(c.total_credit)+" | è¯¾ç¨‹: "+u(c.course_count),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):c("",!0),n.semesterGpa?(e(),a(O,{key:1,title:"æŒ‰å­¦æœŸGPAåˆ†æž"},{default:l((()=>[s(p,{class:"semester-gpa-container"},{default:l((()=>[(e(!0),d(i,null,o(n.semesterGpa,((c,d)=>(e(),a(p,{key:d,class:"semester-item"},{default:l((()=>[s(p,{class:"semester-title"},{default:l((()=>[t(u(d),1)])),_:2},1024),s(p,{class:"semester-gpa"},{default:l((()=>[t(u(c.weighted_gpa),1)])),_:2},1024),s(p,{class:"semester-detail"},{default:l((()=>[t(" å­¦åˆ†: "+u(c.total_credit)+" | è¯¾ç¨‹: "+u(c.course_count),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):c("",!0)])),_:1})}},[["__scopeId","data-v-ec33fa78"]]),L=P({__name:"index",setup(P){const O=n(!0),L=n([]),M=n(null),E=n(null),F=n(null),R=n(null),q=n(0),D=n([]),I=n(!1),U=n([]),$=n(!1),H=n(null),J=n(new Set);C((()=>W())),w((()=>{f("token")||(_({title:"è¯·å…ˆç™»å½•",icon:"none"}),p({url:"/pages/index/index"}))}));const W=()=>{if(!f("token"))return _({title:"è¯·å…ˆç™»å½•",icon:"none"}),void p({url:"/pages/index/index"});K()},K=async()=>{O.value=!0;try{const{statusCode:e,data:a}=await g({url:`${v().globalData.apiBaseURL}/api/v1/grades`,method:"GET",header:{Authorization:"Bearer "+f("token")}});200===e&&a.success?(D.value=a.data||[],L.value=Q(D.value),M.value=a.gpa_analysis,E.value=a.semester_gpa,F.value=a.yearly_gpa,R.value=a.effective_gpa,q.value=a.total_courses):401===e?(m("token"),_({title:"ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•",icon:"none"}),setTimeout((()=>p({url:"/pages/index/index"})),1500)):_({title:a.detail||"èŽ·å–æˆç»©å¤±è´¥",icon:"none"})}catch(e){console.error("è¯·æ±‚å¤±è´¥",e),_({title:"æœåŠ¡å™¨è¿žæŽ¥å¤±è´¥",icon:"none"})}finally{O.value=!1}},Q=e=>{if(!e||0===e.length)return[];const a=e.reduce(((e,a)=>((e[a.semester]=e[a.semester]||[]).push(a),e)),{});return Object.keys(a).map((e=>({semesterName:e,grades:a[e]}))).sort(((e,a)=>a.semesterName.localeCompare(e.semesterName)))},V=e=>U.value.includes(e),X=e=>J.value.has(e),Y=e=>{var a;I.value?ae(e.index):(a=e.index,J.value.has(a)?J.value.delete(a):J.value.add(a))},Z=e=>{const a=parseFloat(e);return isNaN(a)?"score-text-grade":a>=90?"score-high":a>=75?"score-mid":a>=60?"score-low":"score-fail"},ee=e=>{I.value=e.detail.value,I.value||(se(),te())},ae=e=>{const a=U.value.indexOf(e);a>-1?U.value.splice(a,1):U.value.push(e),te()},le=()=>{U.value=D.value.map((e=>e.index)),te()},se=()=>{U.value=[],te()},te=()=>{H.value=null},ue=async()=>{if(0===U.value.length)return void _({title:"è¯·è‡³å°‘é€‰æ‹©ä¸€é—¨è¯¾ç¨‹",icon:"none"});$.value=!0;const e={include_indices:U.value,remove_retakes:!0};try{const{statusCode:a,data:l}=await g({url:`${v().globalData.apiBaseURL}/api/v1/gpa/calculate`,method:"POST",header:{Authorization:"Bearer "+f("token"),"Content-Type":"application/json"},data:e});200===a&&l.success?(H.value=l.data,_({title:"GPAè®¡ç®—å®Œæˆ",icon:"success"})):_({title:l.detail||"GPAè®¡ç®—å¤±è´¥",icon:"none"})}catch(a){console.error("GPAè®¡ç®—è¯·æ±‚å¤±è´¥",a),_({title:"ç½‘ç»œè¿žæŽ¥å¤±è´¥",icon:"none"})}finally{$.value=!1}};return(n,f)=>{const _=k,p=r,g=h,v=N(y("uni-icons"),j),m=b;return e(),a(T,null,{default:l((()=>[O.value?(e(),a(S,{key:0,text:"æ­£åœ¨ä»Žæ•™åŠ¡ç³»ç»ŸåŒæ­¥æˆç»©..."})):(e(),a(p,{key:1,class:"page-container"},{default:l((()=>[0===L.value.length?(e(),a(z,{key:0,"icon-type":"info-filled",title:"æ²¡æœ‰æŸ¥è¯¢åˆ°ä»»ä½•æˆç»©è®°å½•",description:"è¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥æˆ–ç¨åŽé‡è¯•","show-retry":!0,onRetry:K})):(e(),a(p,{key:1},{default:l((()=>[M.value?(e(),a(B,{key:0,"gpa-analysis":M.value,"effective-gpa":R.value,"yearly-gpa":F.value,"semester-gpa":E.value,"total-courses":q.value},null,8,["gpa-analysis","effective-gpa","yearly-gpa","semester-gpa","total-courses"])):c("",!0),s(p,{class:"custom-gpa-toggle-section"},{default:l((()=>[s(p,{class:"toggle-left"},{default:l((()=>[s(_,{class:"toggle-title"},{default:l((()=>[t("è‡ªå®šä¹‰GPAè®¡ç®—")])),_:1}),s(_,{class:"toggle-desc"},{default:l((()=>[t("å‹¾é€‰è¯¾ç¨‹ä»¥è®¡ç®—ç‰¹å®šGPA")])),_:1})])),_:1}),s(g,{checked:I.value,onChange:ee,color:"#667eea"},null,8,["checked"])])),_:1}),I.value?(e(),a(p,{key:1,class:"custom-mode-tip"},{default:l((()=>[s(p,{class:"tip-icon"},{default:l((()=>[t("ðŸ’¡")])),_:1}),s(_,{class:"tip-text"},{default:l((()=>[t("è¯·å‹¾é€‰ **éœ€è¦è®¡å…¥** GPAçš„è¯¾ç¨‹")])),_:1})])),_:1})):c("",!0),s(p,{class:"grades-list-container"},{default:l((()=>[(e(!0),d(i,null,o(L.value,(r=>(e(),a(p,{key:r.semesterName,class:"semester-block"},{default:l((()=>[s(p,{class:"semester-header"},{default:l((()=>[s(_,{class:"semester-name"},{default:l((()=>[t(u(r.semesterName),1)])),_:2},1024)])),_:2},1024),s(p,{class:"courses-list"},{default:l((()=>[(e(!0),d(i,null,o(r.grades,(d=>(e(),a(p,{key:d.index,class:x(["course-card",{"is-custom-mode":I.value,"is-selected":V(d.index)}])},{default:l((()=>[s(p,{class:"course-main",onClick:e=>Y(d)},{default:l((()=>[I.value?(e(),a(p,{key:0,class:"course-checkbox-wrapper"},{default:l((()=>[s(p,{class:x(["checkbox-inner",{checked:V(d.index)}])},null,8,["class"])])),_:2},1024)):c("",!0),s(p,{class:"course-core-info"},{default:l((()=>[s(_,{class:"course-name"},{default:l((()=>[t(u(d.courseName),1)])),_:2},1024),s(p,{class:"course-meta"},{default:l((()=>[s(p,{class:"meta-tag credit"},{default:l((()=>[t("å­¦åˆ†: "+u(d.credit),1)])),_:2},1024),s(p,{class:"meta-tag gpa"},{default:l((()=>[t("ç»©ç‚¹: "+u(d.gpa),1)])),_:2},1024),d.courseAttribute?(e(),a(p,{key:0,class:"meta-tag attribute"},{default:l((()=>[t(u(d.courseAttribute),1)])),_:2},1024)):c("",!0)])),_:2},1024)])),_:2},1024),s(p,{class:"course-side"},{default:l((()=>[s(p,{class:"course-score"},{default:l((()=>[s(_,{class:x(["score-text",Z(d.score)])},{default:l((()=>[t(u(d.score),1)])),_:2},1032,["class"]),d.scoreTag?(e(),a(_,{key:0,class:"score-tag"},{default:l((()=>[t(u(d.scoreTag),1)])),_:2},1024)):c("",!0)])),_:2},1024),s(p,{class:x(["expand-icon",{expanded:X(d.index)}])},{default:l((()=>[s(v,{type:"down",size:"16",color:"#868e96"})])),_:2},1032,["class"])])),_:2},1024)])),_:2},1032,["onClick"]),G(s(p,{class:"course-details"},{default:l((()=>[s(p,{class:"detail-grid"},{default:l((()=>[s(p,{class:"detail-item"},{default:l((()=>[s(_,{class:"detail-label"},{default:l((()=>[t("è¯¾ç¨‹ä»£ç ")])),_:1}),s(_,{class:"detail-value"},{default:l((()=>[t(u(d.courseCode),1)])),_:2},1024)])),_:2},1024),s(p,{class:"detail-item"},{default:l((()=>[s(_,{class:"detail-label"},{default:l((()=>[t("æ€»å­¦æ—¶")])),_:1}),s(_,{class:"detail-value"},{default:l((()=>[t(u(d.totalHours),1)])),_:2},1024)])),_:2},1024),s(p,{class:"detail-item"},{default:l((()=>[s(_,{class:"detail-label"},{default:l((()=>[t("è¯¾ç¨‹æ€§è´¨")])),_:1}),s(_,{class:"detail-value"},{default:l((()=>[t(u(d.courseNature),1)])),_:2},1024)])),_:2},1024),s(p,{class:"detail-item"},{default:l((()=>[s(_,{class:"detail-label"},{default:l((()=>[t("è¯¾ç¨‹ç±»åˆ«")])),_:1}),s(_,{class:"detail-value"},{default:l((()=>[t(u(d.courseCategory),1)])),_:2},1024)])),_:2},1024),s(p,{class:"detail-item"},{default:l((()=>[s(_,{class:"detail-label"},{default:l((()=>[t("è€ƒæ ¸æ–¹å¼")])),_:1}),s(_,{class:"detail-value"},{default:l((()=>[t(u(d.assessmentMethod),1)])),_:2},1024)])),_:2},1024),s(p,{class:"detail-item"},{default:l((()=>[s(_,{class:"detail-label"},{default:l((()=>[t("è€ƒè¯•ç±»åž‹")])),_:1}),s(_,{class:"detail-value"},{default:l((()=>[t(u(d.examType),1)])),_:2},1024)])),_:2},1024),d.groupName?(e(),a(p,{key:0,class:"detail-item"},{default:l((()=>[s(_,{class:"detail-label"},{default:l((()=>[t("è¯¾ç¨‹åˆ†ç»„")])),_:1}),s(_,{class:"detail-value"},{default:l((()=>[t(u(d.groupName),1)])),_:2},1024)])),_:2},1024)):c("",!0),d.retakeSemester?(e(),a(p,{key:1,class:"detail-item"},{default:l((()=>[s(_,{class:"detail-label"},{default:l((()=>[t("é‡ä¿®å­¦æœŸ")])),_:1}),s(_,{class:"detail-value"},{default:l((()=>[t(u(d.retakeSemester),1)])),_:2},1024)])),_:2},1024)):c("",!0)])),_:2},1024)])),_:2},1536),[[A,X(d.index)]])])),_:2},1032,["class"])))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}))])),_:1})),I.value?(e(),a(p,{key:2,class:"custom-gpa-footer"},{default:l((()=>[H.value?(e(),a(p,{key:0,class:"result-display-card"},{default:l((()=>[s(p,{class:"result-header"},{default:l((()=>[s(_,{class:"result-title"},{default:l((()=>[t("è‡ªå®šä¹‰è®¡ç®—ç»“æžœ")])),_:1}),s(_,{class:"close-result-btn",onClick:te},{default:l((()=>[t("å…³é—­")])),_:1})])),_:1}),s(p,{class:"result-content"},{default:l((()=>[s(p,{class:"result-gpa"},{default:l((()=>[s(_,{class:"gpa-value"},{default:l((()=>{var e;return[t(u((null==(e=H.value.weighted_gpa)?void 0:e.toFixed(2))||"0.00"),1)]})),_:1}),s(_,{class:"gpa-label"},{default:l((()=>[t("åŠ æƒå¹³å‡GPA")])),_:1})])),_:1}),s(p,{class:"result-stats"},{default:l((()=>[s(p,{class:"stat-item"},{default:l((()=>[s(_,{class:"stat-value"},{default:l((()=>[t(u(H.value.total_credit||0),1)])),_:1}),s(_,{class:"stat-label"},{default:l((()=>[t("æ€»å­¦åˆ†")])),_:1})])),_:1}),s(p,{class:"stat-item"},{default:l((()=>[s(_,{class:"stat-value"},{default:l((()=>[t(u(H.value.course_count||0),1)])),_:1}),s(_,{class:"stat-label"},{default:l((()=>[t("è¯¾ç¨‹æ•°")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):c("",!0),s(p,{class:"footer-actions"},{default:l((()=>[s(p,{class:"selection-info"},{default:l((()=>[s(_,{class:"info-text"},{default:l((()=>[t("å·²é€‰ "+u(U.value.length)+" / "+u(D.value.length)+" é—¨",1)])),_:1}),s(p,{class:"actions"},{default:l((()=>[s(_,{class:"action-btn",onClick:le},{default:l((()=>[t("å…¨é€‰")])),_:1}),s(_,{class:"action-btn",onClick:se},{default:l((()=>[t("æ¸…ç©º")])),_:1})])),_:1})])),_:1}),s(m,{class:"calculate-btn",onClick:ue,disabled:$.value||0===U.value.length},{default:l((()=>[t(u($.value?"è®¡ç®—ä¸­...":"è®¡ç®—è‡ªå®šä¹‰GPA"),1)])),_:1},8,["disabled"])])),_:1})])),_:1})):c("",!0)])),_:1})}}},[["__scopeId","data-v-c670209b"]]);export{L as default};

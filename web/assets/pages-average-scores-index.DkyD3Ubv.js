import{O as e,q as s,s as a,u as t,l as r,z as l,v as c,r as o,c as n,w as i,g as u,o as d,a as h,j as f,n as m,t as p,d as _,f as g,K as y,F,k,I as b,J as v}from"./index-zk8L-a-J.js";import{_ as T,r as C,a as S}from"./uni-app.es.BpZPP8S7.js";const z=T({data:()=>({searchForm:{course:"",teacher:""},resultData:{},loading:!1,searched:!1,emptyMessage:"未找到相关数据",courseError:!1,teacherError:!1,courseFocused:!1,teacherFocused:!1}),computed:{hasResults(){return Object.keys(this.resultData).length>0},courseHint(){const e=this.searchForm.course.trim().length;return 0===e?"请输入课程名称或代码":e<3?`至少需要3个字符，当前${e}个字符`:`已输入${e}个字符`},teacherHint(){const e=this.searchForm.teacher.trim().length;return 0===e?"":e<2?`至少需要2个字符，当前${e}个字符`:`已输入${e}个字符`},canSearch(){const e=this.searchForm.course.trim().length,s=this.searchForm.teacher.trim().length;return e>=3&&(0===s||s>=2)}},onLoad(){e({title:"平均分查询"}),this.checkLoginStatus()},onShow(){this.checkLoginStatus()},methods:{checkLoginStatus:()=>!!s("token")||(a({title:"请先登录",icon:"none"}),t({url:"/pages/index/index"}),!1),validateCourse(){const e=this.searchForm.course.trim().length;this.courseError=e>0&&e<3},validateTeacher(){const e=this.searchForm.teacher.trim().length;this.teacherError=e>0&&e<2},async handleSearch(){if(this.checkLoginStatus())if(this.searchForm.course.trim())if(this.searchForm.course.trim().length<3)a({title:"课程名称至少需要3个字符",icon:"none"});else if(this.searchForm.teacher.trim()&&this.searchForm.teacher.trim().length<2)a({title:"教师姓名至少需要2个字符",icon:"none"});else{this.loading=!0,this.searched=!0;try{const e={course:this.searchForm.course.trim()};this.searchForm.teacher.trim()&&(e.teacher=this.searchForm.teacher.trim());const s=await this.queryAverageScores(e);200===s.code?(this.resultData=s.data,this.hasResults||(this.emptyMessage="未找到相关数据")):(this.resultData={},this.emptyMessage=s.message||"查询失败",a({title:this.emptyMessage,icon:"none"}))}catch(e){console.error("查询平均分失败:",e),this.resultData={};let s="网络错误，请重试";e.message&&(e.message.includes("HTTP 422")?s="输入参数格式错误，请检查输入内容":e.message.includes("HTTP 400")?s="请求参数错误，请检查输入内容":e.message.includes("HTTP 500")?s="服务器内部错误，请稍后重试":e.message.includes("HTTP")&&(s=`请求失败: ${e.message}`)),this.emptyMessage=s,a({title:s,icon:"none",duration:3e3})}finally{this.loading=!1}}else a({title:"请输入课程名称或代码",icon:"none"})},handleReset(){this.searchForm={course:"",teacher:""},this.resultData={},this.searched=!1,this.courseError=!1,this.teacherError=!1},async queryAverageScores(e){const o=r().globalData.apiBaseURL,n=s("token");return n?new Promise(((s,r)=>{l({url:`${o}/api/v1/average-scores`,method:"GET",data:e,header:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},success:e=>{var l;return 401===e.statusCode?(c("token"),a({title:"登录已过期，请重新登录",icon:"none"}),void setTimeout((()=>{t({url:"/pages/index/index"})}),1500)):200!==e.statusCode?(console.error("API请求失败:",e),void r(new Error(`HTTP ${e.statusCode}: ${(null==(l=e.data)?void 0:l.message)||"请求失败"}`))):void s(e.data)},fail:e=>{r(e)}})})):(a({title:"请先登录",icon:"none"}),void t({url:"/pages/index/index"}))},formatTime:e=>e?e.replace("T"," ").split(".")[0]:""}},[["render",function(e,s,a,t,r,l){const c=u,T=k,z=C(o("uni-icons"),S),E=b,x=v;return d(),n(c,{class:"page-container page-rounded-container"},{default:i((()=>[h(c,{class:"background-decoration"},{default:i((()=>[h(c,{class:"circle circle-1"}),h(c,{class:"circle circle-2"}),h(c,{class:"circle circle-3"})])),_:1}),h(c,{class:"page-header"},{default:i((()=>[h(c,{class:"header-content"},{default:i((()=>[h(T,{class:"page-title"},{default:i((()=>[f("平均分查询")])),_:1}),h(T,{class:"page-subtitle"},{default:i((()=>[f("Academic Score Analysis")])),_:1})])),_:1})])),_:1}),h(c,{class:"content-wrapper"},{default:i((()=>[h(c,{class:"search-card modern-card"},{default:i((()=>[h(c,{class:"card-header"},{default:i((()=>[h(c,{class:"header-icon"},{default:i((()=>[h(z,{type:"search",size:"24",color:"#7f4515"})])),_:1}),h(c,{class:"header-text"},{default:i((()=>[h(T,{class:"card-title"},{default:i((()=>[f("课程信息查询")])),_:1}),h(T,{class:"card-subtitle"},{default:i((()=>[f("输入课程信息开始查询")])),_:1})])),_:1})])),_:1}),h(c,{class:"form-content"},{default:i((()=>[h(c,{class:"form-group"},{default:i((()=>[h(c,{class:"input-label"},{default:i((()=>[h(z,{type:"book",size:"20",color:"#495057"}),h(T,null,{default:i((()=>[f("课程名称/代码")])),_:1})])),_:1}),h(c,{class:"input-wrapper"},{default:i((()=>[h(E,{class:m(["modern-input",{"input-error":r.courseError,"input-focus":r.courseFocused}]),modelValue:r.searchForm.course,"onUpdate:modelValue":s[0]||(s[0]=e=>r.searchForm.course=e),placeholder:"请输入课程名称或课程代码（至少3个字符）",onConfirm:l.handleSearch,onInput:l.validateCourse,onFocus:s[1]||(s[1]=e=>r.courseFocused=!0),onBlur:s[2]||(s[2]=e=>r.courseFocused=!1)},null,8,["class","modelValue","onConfirm","onInput"]),h(c,{class:m(["input-line",{active:r.courseFocused}])},null,8,["class"])])),_:1}),h(T,{class:m(["input-hint",{"hint-error":r.courseError}])},{default:i((()=>[f(p(l.courseHint),1)])),_:1},8,["class"])])),_:1}),h(c,{class:"form-group"},{default:i((()=>[h(c,{class:"input-label"},{default:i((()=>[h(z,{type:"person",size:"20",color:"#495057"}),h(T,null,{default:i((()=>[f("教师姓名（选填）")])),_:1})])),_:1}),h(c,{class:"input-wrapper"},{default:i((()=>[h(E,{class:m(["modern-input",{"input-error":r.teacherError,"input-focus":r.teacherFocused}]),modelValue:r.searchForm.teacher,"onUpdate:modelValue":s[3]||(s[3]=e=>r.searchForm.teacher=e),placeholder:"不填则查询所有老师（至少2个字符）",onConfirm:l.handleSearch,onInput:l.validateTeacher,onFocus:s[4]||(s[4]=e=>r.teacherFocused=!0),onBlur:s[5]||(s[5]=e=>r.teacherFocused=!1)},null,8,["class","modelValue","onConfirm","onInput"]),h(c,{class:m(["input-line",{active:r.teacherFocused}])},null,8,["class"])])),_:1}),r.searchForm.teacher.trim()?(d(),n(T,{key:0,class:m(["input-hint",{"hint-error":r.teacherError}])},{default:i((()=>[f(p(l.teacherHint),1)])),_:1},8,["class"])):_("",!0)])),_:1}),h(c,{class:"button-group"},{default:i((()=>[h(x,{class:"action-btn primary-btn",onClick:l.handleSearch,loading:r.loading,disabled:!l.canSearch},{default:i((()=>[r.loading?_("",!0):(d(),n(z,{key:0,type:"search",size:"20",color:"#ffffff"})),h(T,null,{default:i((()=>[f(p(r.loading?"查询中...":"开始查询"),1)])),_:1})])),_:1},8,["onClick","loading","disabled"]),h(x,{class:"action-btn secondary-btn",onClick:l.handleReset},{default:i((()=>[h(z,{type:"refresh",size:"20",color:"#495057"}),h(T,null,{default:i((()=>[f("重置")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1}),l.hasResults?(d(),n(c,{key:0,class:"results-section"},{default:i((()=>[h(c,{class:"results-header"},{default:i((()=>[h(c,{class:"results-info"},{default:i((()=>[h(T,{class:"results-title"},{default:i((()=>[f("查询结果")])),_:1}),h(T,{class:"results-count"},{default:i((()=>[f("共找到 "+p(Object.keys(r.resultData).length)+" 门课程",1)])),_:1})])),_:1})])),_:1}),(d(!0),g(F,null,y(r.resultData,((e,s)=>(d(),n(c,{class:"course-card modern-card",key:s},{default:i((()=>[h(c,{class:"course-header"},{default:i((()=>[h(c,{class:"course-info"},{default:i((()=>[h(c,{class:"course-icon"},{default:i((()=>[h(z,{type:"book",size:"20",color:"#7f4515"})])),_:1}),h(T,{class:"course-name"},{default:i((()=>[f(p(s),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),h(c,{class:"course-content"},{default:i((()=>[(d(!0),g(F,null,y(Object.keys(e),((s,a)=>(d(),n(c,{class:"teacher-section",key:s},{default:i((()=>[h(c,{class:"teacher-header"},{default:i((()=>[h(c,{class:"teacher-info"},{default:i((()=>[h(c,{class:"teacher-avatar"},{default:i((()=>[h(z,{type:"person",size:"16",color:"#7f4515"})])),_:1}),h(T,{class:"teacher-name"},{default:i((()=>[f(p(s),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),h(c,{class:"semester-list"},{default:i((()=>[(d(!0),g(F,null,y(e[s],((e,s)=>(d(),n(c,{class:"semester-item",key:s},{default:i((()=>[h(c,{class:"semester-info"},{default:i((()=>[h(T,{class:"semester-name"},{default:i((()=>[f(p(s),1)])),_:2},1024),e.update_time?(d(),n(T,{key:0,class:"update-time"},{default:i((()=>[f(p(l.formatTime(e.update_time)),1)])),_:2},1024)):_("",!0)])),_:2},1024),h(c,{class:"score-info"},{default:i((()=>[h(c,{class:"score-item"},{default:i((()=>[h(T,{class:"score-label"},{default:i((()=>[f("平均分")])),_:1}),h(T,{class:"score-value primary"},{default:i((()=>[f(p(e.average_score.toFixed(2)),1)])),_:2},1024)])),_:2},1024),h(c,{class:"score-item"},{default:i((()=>[h(T,{class:"score-label"},{default:i((()=>[f("人数")])),_:1}),h(T,{class:"score-value secondary"},{default:i((()=>[f(p(e.student_count),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})):r.searched&&!r.loading?(d(),n(c,{key:1,class:"empty-state modern-card"},{default:i((()=>[h(c,{class:"empty-content"},{default:i((()=>[h(c,{class:"empty-icon"},{default:i((()=>[h(z,{type:"info",size:"80",color:"#adb5bd"})])),_:1}),h(T,{class:"empty-title"},{default:i((()=>[f("未找到相关数据")])),_:1}),h(T,{class:"empty-subtitle"},{default:i((()=>[f(p(r.emptyMessage),1)])),_:1}),h(x,{class:"action-btn primary-btn retry-btn",onClick:l.handleReset},{default:i((()=>[h(z,{type:"refresh",size:"20",color:"#ffffff"}),h(T,null,{default:i((()=>[f("重新搜索")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1})):r.searched||r.loading?r.loading?(d(),n(c,{key:3,class:"loading-state modern-card"},{default:i((()=>[h(c,{class:"loading-content"},{default:i((()=>[h(c,{class:"loading-spinner"},{default:i((()=>[h(z,{type:"spinner-cycle",size:"60",color:"#7f4515"})])),_:1}),h(T,{class:"loading-text"},{default:i((()=>[f("正在查询数据...")])),_:1})])),_:1})])),_:1})):_("",!0):(d(),n(c,{key:2,class:"initial-state modern-card"},{default:i((()=>[h(c,{class:"initial-content"},{default:i((()=>[h(c,{class:"initial-icon"},{default:i((()=>[h(z,{type:"search",size:"80",color:"#7f4515"})])),_:1}),h(T,{class:"initial-title"},{default:i((()=>[f("欢迎使用平均分查询")])),_:1}),h(T,{class:"initial-subtitle"},{default:i((()=>[f("请输入课程信息开始查询学术数据")])),_:1})])),_:1})])),_:1}))])),_:1})])),_:1})}],["__scopeId","data-v-ceecf2c9"]]);export{z as default};

import{p as e,q as a,s as l,u as s,z as t,l as u,v as c,r as d,c as i,w as o,o as n,a as r,j as f,t as _,f as v,P as g,F as p,d as m,k,g as y,W as h,J as x,n as b,L as A,M as P}from"./index-M3z4vu0c.js";import{_ as w,o as C,b as N,r as G,a as F}from"./uni-app.es.DFjlVgil.js";import{P as j}from"./PageLayout.Zwsza9vX.js";import{L as T,E as L}from"./EmptyState.WvNmgYPj.js";const O=w({__name:"index",setup(w){const O=e(!0),S=e([]),z=e(null),B=e(null),E=e(null),R=e(null),D=e(0),M=e([]),U=e(!1),$=e([]),q=e(!1),H=e(null),I=e(new Set);C((()=>J())),N((()=>{a("token")||(l({title:"è¯·å…ˆç™»å½•",icon:"none"}),s({url:"/pages/index/index"}))}));const J=()=>{if(!a("token"))return l({title:"è¯·å…ˆç™»å½•",icon:"none"}),void s({url:"/pages/index/index"});W()},W=async()=>{var e;O.value=!0;try{const{statusCode:d,data:i}=await t({url:`${u().globalData.apiBaseURL}/api/v1/grades`,method:"GET",header:{Authorization:"Bearer "+a("token")}});200===d&&i.success?(M.value=i.data||[],S.value=K(M.value),z.value=null==(e=i.gpa_analysis)?void 0:e.basic_gpa,B.value=i.semester_gpa,E.value=i.yearly_gpa,R.value=i.effective_gpa,D.value=i.total_courses):401===d?(c("token"),l({title:"ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•",icon:"none"}),setTimeout((()=>s({url:"/pages/index/index"})),1500)):l({title:i.detail||"èŽ·å–æˆç»©å¤±è´¥",icon:"none"})}catch(d){console.error("è¯·æ±‚å¤±è´¥",d),l({title:"æœåŠ¡å™¨è¿žæŽ¥å¤±è´¥",icon:"none"})}finally{O.value=!1}},K=e=>{if(!e||0===e.length)return[];const a=e.reduce(((e,a)=>((e[a.semester]=e[a.semester]||[]).push(a),e)),{});return Object.keys(a).map((e=>({semesterName:e,grades:a[e]}))).sort(((e,a)=>a.semesterName.localeCompare(e.semesterName)))},Q=e=>$.value.includes(e),V=e=>I.value.has(e),X=e=>{var a;U.value?ee(e.index):(a=e.index,I.value.has(a)?I.value.delete(a):I.value.add(a))},Y=e=>{const a=parseFloat(e);return isNaN(a)?"score-text-grade":a>=90?"score-high":a>=75?"score-mid":a>=60?"score-low":"score-fail"},Z=e=>{U.value=e.detail.value,U.value||(le(),se())},ee=e=>{const a=$.value.indexOf(e);a>-1?$.value.splice(a,1):$.value.push(e),se()},ae=()=>{$.value=M.value.map((e=>e.index)),se()},le=()=>{$.value=[],se()},se=()=>{H.value=null},te=async()=>{if(0===$.value.length)return void l({title:"è¯·è‡³å°‘é€‰æ‹©ä¸€é—¨è¯¾ç¨‹",icon:"none"});q.value=!0;const e={include_indices:$.value,remove_retakes:!0};try{const{statusCode:s,data:c}=await t({url:`${u().globalData.apiBaseURL}/api/v1/gpa/calculate`,method:"POST",header:{Authorization:"Bearer "+a("token"),"Content-Type":"application/json"},data:e});200===s&&c.success?(H.value=c.data,l({title:"GPAè®¡ç®—å®Œæˆ",icon:"success"})):l({title:c.detail||"GPAè®¡ç®—å¤±è´¥",icon:"none"})}catch(s){console.error("GPAè®¡ç®—è¯·æ±‚å¤±è´¥",s),l({title:"ç½‘ç»œè¿žæŽ¥å¤±è´¥",icon:"none"})}finally{q.value=!1}};return(e,a)=>{const l=k,s=y,t=h,u=G(d("uni-icons"),F),c=x;return n(),i(j,null,{default:o((()=>[O.value?(n(),i(T,{key:0,text:"æ­£åœ¨ä»Žæ•™åŠ¡ç³»ç»ŸåŒæ­¥æˆç»©..."})):(n(),i(s,{key:1,class:"page-container"},{default:o((()=>[0===S.value.length?(n(),i(L,{key:0,"icon-type":"info-filled",title:"æ²¡æœ‰æŸ¥è¯¢åˆ°ä»»ä½•æˆç»©è®°å½•",description:"è¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥æˆ–ç¨åŽé‡è¯•","show-retry":!0,onRetry:W})):(n(),i(s,{key:1},{default:o((()=>[z.value?(n(),i(s,{key:0,class:"analysis-container"},{default:o((()=>[r(s,{class:"main-gpa-section"},{default:o((()=>[r(s,{class:"gpa-item"},{default:o((()=>[r(l,{class:"gpa-value"},{default:o((()=>{var e,a;return[f(_((null==(a=null==(e=z.value)?void 0:e.weighted_gpa)?void 0:a.toFixed(2))||"N/A"),1)]})),_:1}),r(l,{class:"gpa-label"},{default:o((()=>[f("æ€»åŠ æƒå¹³å‡GPA")])),_:1})])),_:1}),r(s,{class:"gpa-item"},{default:o((()=>[r(l,{class:"gpa-value"},{default:o((()=>{var e,a;return[f(_((null==(a=null==(e=R.value)?void 0:e.weighted_gpa)?void 0:a.toFixed(2))||"N/A"),1)]})),_:1}),r(l,{class:"gpa-label"},{default:o((()=>[f("æœ‰æ•ˆGPA (åŽ»é‡ä¿®)")])),_:1})])),_:1}),r(s,{class:"gpa-item"},{default:o((()=>[r(l,{class:"gpa-value"},{default:o((()=>[f(_(D.value||0),1)])),_:1}),r(l,{class:"gpa-label"},{default:o((()=>[f("æ€»è¯¾ç¨‹æ•°")])),_:1})])),_:1})])),_:1}),r(s,{class:"detailed-gpa-section"},{default:o((()=>[r(s,{class:"section-header"},{default:o((()=>[r(l,{class:"section-title"},{default:o((()=>[f("è¯¦ç»†GPAåˆ†å¸ƒ")])),_:1})])),_:1}),r(s,{class:"details-flex-container"},{default:o((()=>[E.value&&Object.keys(E.value).length>0?(n(!0),v(p,{key:0},g(E.value,((e,a)=>(n(),i(s,{key:a,class:"detail-item-flex"},{default:o((()=>[r(l,{class:"detail-label"},{default:o((()=>[f(_(a)+"å­¦å¹´",1)])),_:2},1024),r(l,{class:"detail-sub-info"},{default:o((()=>[f(_(e.course_count)+"é—¨ / "+_(e.total_credit.toFixed(1))+"å­¦åˆ†",1)])),_:2},1024),r(l,{class:"detail-value"},{default:o((()=>[f(_(e.weighted_gpa.toFixed(2)),1)])),_:2},1024)])),_:2},1024)))),128)):m("",!0),B.value&&Object.keys(B.value).length>0?(n(!0),v(p,{key:1},g(B.value,((e,a)=>(n(),i(s,{key:a,class:"detail-item-flex"},{default:o((()=>[r(l,{class:"detail-label"},{default:o((()=>[f(_(a),1)])),_:2},1024),r(l,{class:"detail-sub-info"},{default:o((()=>[f(_(e.course_count)+"é—¨ / "+_(e.total_credit.toFixed(1))+"å­¦åˆ†",1)])),_:2},1024),r(l,{class:"detail-value"},{default:o((()=>[f(_(e.weighted_gpa.toFixed(2)),1)])),_:2},1024)])),_:2},1024)))),128)):m("",!0)])),_:1})])),_:1})])),_:1})):m("",!0),r(s,{class:"custom-gpa-toggle-section"},{default:o((()=>[r(s,{class:"toggle-left"},{default:o((()=>[r(l,{class:"toggle-title"},{default:o((()=>[f("è‡ªå®šä¹‰GPAè®¡ç®—")])),_:1}),r(l,{class:"toggle-desc"},{default:o((()=>[f("å‹¾é€‰è¯¾ç¨‹ä»¥è®¡ç®—ç‰¹å®šGPA")])),_:1})])),_:1}),r(t,{checked:U.value,onChange:Z,color:"#7F4515"},null,8,["checked"])])),_:1}),U.value?(n(),i(s,{key:1,class:"custom-mode-tip"},{default:o((()=>[r(s,{class:"tip-icon"},{default:o((()=>[f("ðŸ’¡")])),_:1}),r(l,{class:"tip-text"},{default:o((()=>[f("è¯·å‹¾é€‰ **éœ€è¦è®¡å…¥** GPAçš„è¯¾ç¨‹")])),_:1})])),_:1})):m("",!0),r(s,{class:"grades-list-container"},{default:o((()=>[(n(!0),v(p,null,g(S.value,(e=>(n(),i(s,{key:e.semesterName,class:"semester-block"},{default:o((()=>[r(s,{class:"semester-header"},{default:o((()=>[r(l,{class:"semester-name"},{default:o((()=>[f(_(e.semesterName),1)])),_:2},1024)])),_:2},1024),r(s,{class:"courses-list"},{default:o((()=>[(n(!0),v(p,null,g(e.grades,(e=>(n(),i(s,{key:e.index,class:b(["course-card",{"is-custom-mode":U.value,"is-selected":Q(e.index)}])},{default:o((()=>[r(s,{class:"course-main",onClick:a=>X(e)},{default:o((()=>[U.value?(n(),i(s,{key:0,class:"course-checkbox-wrapper"},{default:o((()=>[r(s,{class:b(["checkbox-inner",{checked:Q(e.index)}])},null,8,["class"])])),_:2},1024)):m("",!0),r(s,{class:"course-core-info"},{default:o((()=>[r(l,{class:"course-name"},{default:o((()=>[f(_(e.courseName),1)])),_:2},1024),r(s,{class:"course-meta"},{default:o((()=>[r(s,{class:"meta-tag credit"},{default:o((()=>[f("å­¦åˆ†: "+_(e.credit),1)])),_:2},1024),r(s,{class:"meta-tag gpa"},{default:o((()=>[f("ç»©ç‚¹: "+_(e.gpa),1)])),_:2},1024),e.courseAttribute?(n(),i(s,{key:0,class:"meta-tag attribute"},{default:o((()=>[f(_(e.courseAttribute),1)])),_:2},1024)):m("",!0)])),_:2},1024)])),_:2},1024),r(s,{class:"course-side"},{default:o((()=>[r(s,{class:"course-score"},{default:o((()=>[r(l,{class:b(["score-text",Y(e.score)])},{default:o((()=>[f(_(e.score),1)])),_:2},1032,["class"]),e.scoreTag?(n(),i(l,{key:0,class:"score-tag"},{default:o((()=>[f(_(e.scoreTag),1)])),_:2},1024)):m("",!0)])),_:2},1024),r(s,{class:b(["expand-icon",{expanded:V(e.index)}])},{default:o((()=>[r(u,{type:"down",size:"16",color:"#868e96"})])),_:2},1032,["class"])])),_:2},1024)])),_:2},1032,["onClick"]),A(r(s,{class:"course-details"},{default:o((()=>[r(s,{class:"detail-grid"},{default:o((()=>[r(s,{class:"detail-item"},{default:o((()=>[r(l,{class:"detail-label"},{default:o((()=>[f("è¯¾ç¨‹ä»£ç ")])),_:1}),r(l,{class:"detail-value"},{default:o((()=>[f(_(e.courseCode),1)])),_:2},1024)])),_:2},1024),r(s,{class:"detail-item"},{default:o((()=>[r(l,{class:"detail-label"},{default:o((()=>[f("æ€»å­¦æ—¶")])),_:1}),r(l,{class:"detail-value"},{default:o((()=>[f(_(e.totalHours),1)])),_:2},1024)])),_:2},1024),r(s,{class:"detail-item"},{default:o((()=>[r(l,{class:"detail-label"},{default:o((()=>[f("è¯¾ç¨‹æ€§è´¨")])),_:1}),r(l,{class:"detail-value"},{default:o((()=>[f(_(e.courseNature),1)])),_:2},1024)])),_:2},1024),r(s,{class:"detail-item"},{default:o((()=>[r(l,{class:"detail-label"},{default:o((()=>[f("è¯¾ç¨‹ç±»åˆ«")])),_:1}),r(l,{class:"detail-value"},{default:o((()=>[f(_(e.courseCategory),1)])),_:2},1024)])),_:2},1024),r(s,{class:"detail-item"},{default:o((()=>[r(l,{class:"detail-label"},{default:o((()=>[f("è€ƒæ ¸æ–¹å¼")])),_:1}),r(l,{class:"detail-value"},{default:o((()=>[f(_(e.assessmentMethod),1)])),_:2},1024)])),_:2},1024),r(s,{class:"detail-item"},{default:o((()=>[r(l,{class:"detail-label"},{default:o((()=>[f("è€ƒè¯•ç±»åž‹")])),_:1}),r(l,{class:"detail-value"},{default:o((()=>[f(_(e.examType),1)])),_:2},1024)])),_:2},1024),e.groupName?(n(),i(s,{key:0,class:"detail-item"},{default:o((()=>[r(l,{class:"detail-label"},{default:o((()=>[f("è¯¾ç¨‹åˆ†ç»„")])),_:1}),r(l,{class:"detail-value"},{default:o((()=>[f(_(e.groupName),1)])),_:2},1024)])),_:2},1024)):m("",!0),e.retakeSemester?(n(),i(s,{key:1,class:"detail-item"},{default:o((()=>[r(l,{class:"detail-label"},{default:o((()=>[f("é‡ä¿®å­¦æœŸ")])),_:1}),r(l,{class:"detail-value"},{default:o((()=>[f(_(e.retakeSemester),1)])),_:2},1024)])),_:2},1024)):m("",!0)])),_:2},1024)])),_:2},1536),[[P,V(e.index)]])])),_:2},1032,["class"])))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}))])),_:1})),U.value?(n(),i(s,{key:2,class:"custom-gpa-footer"},{default:o((()=>[H.value?(n(),i(s,{key:0,class:"result-display-card"},{default:o((()=>[r(s,{class:"result-header"},{default:o((()=>[r(l,{class:"result-title"},{default:o((()=>[f("è‡ªå®šä¹‰è®¡ç®—ç»“æžœ")])),_:1}),r(l,{class:"close-result-btn",onClick:se},{default:o((()=>[f("å…³é—­")])),_:1})])),_:1}),r(s,{class:"result-content"},{default:o((()=>[r(s,{class:"result-gpa"},{default:o((()=>[r(l,{class:"gpa-value"},{default:o((()=>{var e;return[f(_((null==(e=H.value.weighted_gpa)?void 0:e.toFixed(2))||"0.00"),1)]})),_:1}),r(l,{class:"gpa-label"},{default:o((()=>[f("åŠ æƒå¹³å‡GPA")])),_:1})])),_:1}),r(s,{class:"result-stats"},{default:o((()=>[r(s,{class:"stat-item"},{default:o((()=>[r(l,{class:"stat-value"},{default:o((()=>[f(_(H.value.total_credit||0),1)])),_:1}),r(l,{class:"stat-label"},{default:o((()=>[f("æ€»å­¦åˆ†")])),_:1})])),_:1}),r(s,{class:"stat-item"},{default:o((()=>[r(l,{class:"stat-value"},{default:o((()=>[f(_(H.value.course_count||0),1)])),_:1}),r(l,{class:"stat-label"},{default:o((()=>[f("è¯¾ç¨‹æ•°")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):m("",!0),r(s,{class:"footer-actions"},{default:o((()=>[r(s,{class:"selection-info"},{default:o((()=>[r(l,{class:"info-text"},{default:o((()=>[f("å·²é€‰ "+_($.value.length)+" / "+_(M.value.length)+" é—¨",1)])),_:1}),r(s,{class:"actions"},{default:o((()=>[r(l,{class:"action-btn",onClick:ae},{default:o((()=>[f("å…¨é€‰")])),_:1}),r(l,{class:"action-btn",onClick:le},{default:o((()=>[f("æ¸…ç©º")])),_:1})])),_:1})])),_:1}),r(c,{class:"calculate-btn",onClick:te,disabled:q.value||0===$.value.length},{default:o((()=>[f(_(q.value?"è®¡ç®—ä¸­...":"è®¡ç®—è‡ªå®šä¹‰GPA"),1)])),_:1},8,["disabled"])])),_:1})])),_:1})):m("",!0)])),_:1})}}},[["__scopeId","data-v-ca359237"]]);export{O as default};

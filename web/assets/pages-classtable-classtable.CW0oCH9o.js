import{B as e,X as a,C as t,r as l,o as s,c as n,w as o,a as c,b as u,t as r,k as d,m as i,F as f,O as p,h as _,Q as v,A as y,i as m,d as g,S as h,a0 as w,$ as k,D,f as b,E as S,G as x,u as C,J as T,M as I,N as z,U as O}from"./index-BSMsiDgV.js";import{_ as $,r as M,a as j,o as E,b as B}from"./uni-icons.BpK-xJsu.js";import{d as L}from"./jwt-decode.3jgMzty2.js";import{P}from"./PageLayout.MRbam6F0.js";import{L as q}from"./LoadingScreen.1b11xFXN.js";import{_ as A}from"./uni-popup.CjLFd9wq.js";const R=$({__name:"DateNavigator",props:{selectedDate:{type:String,required:!0}},emits:["dateChange"],setup(k,{expose:D,emit:b}){const S=k,x=b,C=e(7),T=e([]),I=e(null),z=a((()=>0===T.value.length?{day:"",month:"",weekday:""}:T.value[C.value]||{day:"",month:"",weekday:""})),O=a((()=>{const e=C.value,a=Math.max(0,e-5),t=Math.min(T.value.length,e+6);return T.value.slice(a,t)})),$=a((()=>{const e=C.value;return e-Math.max(0,e-5)})),E=a((()=>{const e=(new Date).toISOString().split("T")[0];return S.selectedDate===e}));function B(e=null){const a=[],t=e?new Date(e):new Date;for(let l=-7;l<=7;l++){const e=new Date(t);e.setDate(t.getDate()+l),a.push(L(e))}if(T.value=a,e){const a=T.value.findIndex((a=>a.date===e));-1!==a&&(C.value=a)}else C.value=7}function L(e){const a=e.toISOString().split("T")[0],t=(new Date).toISOString().split("T")[0];return{date:a,day:e.getDate().toString(),month:`${e.getMonth()+1}æœˆ`,weekday:`å‘¨${["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][e.getDay()]}`,isToday:a===t}}function P(e="forward",a=7){if("forward"===e){const e=new Date(T.value[T.value.length-1].date);for(let t=1;t<=a;t++){const a=new Date(e);a.setDate(e.getDate()+t),T.value.push(L(a))}}else{const e=new Date(T.value[0].date),t=[];for(let l=a;l>=1;l--){const a=new Date(e);a.setDate(e.getDate()-l),t.push(L(a))}T.value=[...t,...T.value],C.value+=a}}function q(){C.value>0?C.value--:(P("backward",7),C.value=6);const e=T.value[C.value];x("dateChange",e.date)}function A(){C.value<T.value.length-1||P("forward",7),C.value++;const e=T.value[C.value];x("dateChange",e.date)}function R(){G((new Date).toISOString().split("T")[0])}function G(e){const a=T.value.findIndex((a=>a.date===e));-1!==a?C.value=a:B(e),x("dateChange",e)}function N(){v((()=>{const e=I.value;e&&e.click()}))}function U(e){G(e.detail.value)}return t((()=>S.selectedDate),(e=>{const a=T.value.findIndex((a=>a.date===e));-1!==a?C.value=a:G(e)})),t(C,(e=>{e<=2?P("backward",7):e>=T.value.length-3&&P("forward",7)})),D({gotoToday:R}),B(),(e,a)=>{const t=M(l("uni-icons"),j),v=y,D=m,b=g,S=h,B=w;return s(),n(b,{class:"date-navigator"},{default:o((()=>[c(b,{class:"date-header"},{default:o((()=>[c(v,{class:"nav-arrow nav-arrow--prev",onClick:q},{default:o((()=>[c(t,{type:"arrow-left",size:"24",color:"#7f4515"})])),_:1}),c(b,{class:"date-display",onClick:N},{default:o((()=>[c(b,{class:"date-main"},{default:o((()=>[c(D,{class:"current-day"},{default:o((()=>[u(r(z.value.day),1)])),_:1}),c(b,{class:"date-meta"},{default:o((()=>[c(D,{class:"current-month"},{default:o((()=>[u(r(z.value.month),1)])),_:1}),c(D,{class:"current-weekday"},{default:o((()=>[u(r(z.value.weekday),1)])),_:1})])),_:1})])),_:1}),c(t,{type:"calendar",size:"20",color:"#7f4515"})])),_:1}),c(b,{class:"header-actions"},{default:o((()=>[E.value?d("",!0):(s(),n(v,{key:0,class:"today-btn",onClick:R},{default:o((()=>[c(t,{type:"home",size:"18",color:"#7f4515"}),c(D,null,{default:o((()=>[u("ä»Šæ—¥")])),_:1})])),_:1})),c(v,{class:"nav-arrow nav-arrow--next",onClick:A},{default:o((()=>[c(t,{type:"arrow-right",size:"24",color:"#7f4515"})])),_:1})])),_:1})])),_:1}),c(b,{class:"date-slider"},{default:o((()=>[c(S,{class:"date-scroll","scroll-x":"","scroll-into-view":"date-"+C.value,"scroll-with-animation":"",enhanced:"","show-scrollbar":!1},{default:o((()=>[c(b,{class:"date-list"},{default:o((()=>[(s(!0),i(f,null,p(O.value,((e,a)=>(s(),n(b,{key:e.date,id:"date-"+a,class:_(["date-option",{"date-option--active":a===$.value,"date-option--today":e.isToday}]),onClick:e=>function(e){const a=C.value,t=Math.max(0,a-5)+e;if(t>=0&&t<T.value.length){C.value=t;const e=T.value[t];x("dateChange",e.date)}}(a)},{default:o((()=>[c(D,{class:"option-day"},{default:o((()=>[u(r(e.day),1)])),_:2},1024),c(D,{class:"option-weekday"},{default:o((()=>[u(r(e.weekday.replace("å‘¨","")),1)])),_:2},1024)])),_:2},1032,["id","class","onClick"])))),128))])),_:1})])),_:1},8,["scroll-into-view"])])),_:1}),c(B,{mode:"date",value:k.selectedDate,onChange:U,start:"2020-01-01",end:"2030-12-31"},{default:o((()=>[c(b,{class:"date-picker-trigger",ref_key:"datePickerTrigger",ref:I},null,512)])),_:1},8,["value"])])),_:1})}}},[["__scopeId","data-v-bdbb0af4"]]),G=$({__name:"CourseCard",props:{course:{type:Object,default:null},isEmpty:{type:Boolean,default:!1}},setup(e){function a(e){switch(e){case"å¿…ä¿®":return"property-required";case"é€‰ä¿®":return"property-elective";case"å®è·µ":return"property-practice";default:return"property-default"}}return(t,i)=>{const f=m,p=g,v=M(l("uni-icons"),j);return s(),n(p,{class:_(["course-card",{"course-card--empty":e.isEmpty}])},{default:o((()=>[e.isEmpty?(s(),n(p,{key:1,class:"empty-content"},{default:o((()=>[c(f,{class:"empty-text"},{default:o((()=>[u("æ— è¯¾ç¨‹")])),_:1})])),_:1})):(s(),n(p,{key:0,class:"course-content"},{default:o((()=>[c(p,{class:"course-header"},{default:o((()=>[c(f,{class:"course-name"},{default:o((()=>[u(r(e.course.course_name),1)])),_:1}),c(f,{class:"course-credits"},{default:o((()=>[u(r(e.course.course_credits)+"å­¦åˆ†",1)])),_:1})])),_:1}),c(p,{class:"course-property"},{default:o((()=>[c(f,{class:_(["property-tag",a(e.course.course_property)])},{default:o((()=>[u(r(e.course.course_property),1)])),_:1},8,["class"])])),_:1}),c(p,{class:"course-time"},{default:o((()=>[c(v,{type:"clock",size:"16",color:"#7f4515"}),c(f,{class:"time-text"},{default:o((()=>[u(r(e.course.period)+"èŠ‚",1)])),_:1})])),_:1}),c(p,{class:"course-location"},{default:o((()=>[c(v,{type:"location",size:"16",color:"#7f4515"}),c(f,{class:"location-text"},{default:o((()=>[u(r(e.course.classroom),1)])),_:1})])),_:1}),e.course.class_name?(s(),n(p,{key:0,class:"course-class"},{default:o((()=>[c(f,{class:"class-text"},{default:o((()=>[u(r(e.course.class_name),1)])),_:1})])),_:1})):d("",!0)])),_:1}))])),_:1},8,["class"])}}},[["__scopeId","data-v-47c9a877"]]),N=$({__name:"ClassTableView",props:{courses:{type:Array,default:()=>[]},selectedDate:{type:String,required:!0}},setup(t){const _=t,v=e(null),h=e(null),w=a((()=>_.courses&&0!==_.courses.length?[..._.courses].sort(((e,a)=>{const t=e=>{const a=e.match(/(\d+)/);return a?parseInt(a[1]):0};return t(e.period)-t(a.period)})):[]));function k(e){if(!e)return"";const a=new Date(e),t=new Date,l=new Date(t);l.setDate(t.getDate()+1);const s=new Date(t);s.setDate(t.getDate()-1);const n=["å‘¨æ—¥","å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­"][a.getDay()];if(e===t.toISOString().split("T")[0])return`ä»Šå¤© ${n}`;if(e===l.toISOString().split("T")[0])return`æ˜å¤© ${n}`;if(e===s.toISOString().split("T")[0])return`æ˜¨å¤© ${n}`;return`${a.getMonth()+1}æœˆ${a.getDate()}æ—¥ ${n}`}function D(){var e;null==(e=v.value)||e.close(),h.value=null}return(e,a)=>{const _=m,b=g,S=M(l("uni-icons"),j),x=y,C=M(l("uni-popup"),A);return s(),n(b,{class:"classtable-view"},{default:o((()=>[t.courses&&t.courses.length>0?(s(),n(b,{key:0,class:"courses-container"},{default:o((()=>[c(b,{class:"date-header"},{default:o((()=>[c(_,{class:"date-title"},{default:o((()=>[u(r(k(t.selectedDate)),1)])),_:1}),c(_,{class:"course-count"},{default:o((()=>[u("å…± "+r(t.courses.length)+" èŠ‚è¯¾",1)])),_:1})])),_:1}),c(b,{class:"courses-list"},{default:o((()=>[(s(!0),i(f,null,p(w.value,((e,a)=>(s(),n(G,{key:a,course:e,onClick:a=>function(e){var a;h.value=e,null==(a=v.value)||a.open()}(e)},null,8,["course","onClick"])))),128))])),_:1})])),_:1})):(s(),n(b,{key:1,class:"empty-state"},{default:o((()=>[c(b,{class:"empty-icon"},{default:o((()=>[c(S,{type:"calendar",size:"80",color:"#e0e0e0"})])),_:1}),c(_,{class:"empty-title"},{default:o((()=>[u(r(k(t.selectedDate)),1)])),_:1}),c(_,{class:"empty-desc"},{default:o((()=>[u("ä»Šå¤©æ²¡æœ‰è¯¾ç¨‹å®‰æ’")])),_:1}),c(_,{class:"empty-tip"},{default:o((()=>[u("å¥½å¥½ä¼‘æ¯å§ ğŸ‰")])),_:1})])),_:1})),c(C,{ref_key:"courseDetailPopup",ref:v,type:"bottom","background-color":"#fff","z-index":1e4},{default:o((()=>[h.value?(s(),n(b,{key:0,class:"course-detail-popup"},{default:o((()=>[c(b,{class:"popup-header"},{default:o((()=>[c(_,{class:"popup-title"},{default:o((()=>[u("è¯¾ç¨‹è¯¦æƒ…")])),_:1}),c(x,{class:"close-btn",onClick:D},{default:o((()=>[c(S,{type:"close",size:"24",color:"#666"})])),_:1})])),_:1}),c(b,{class:"popup-content"},{default:o((()=>[c(b,{class:"detail-item"},{default:o((()=>[c(_,{class:"detail-label"},{default:o((()=>[u("è¯¾ç¨‹åç§°")])),_:1}),c(_,{class:"detail-value"},{default:o((()=>[u(r(h.value.course_name),1)])),_:1})])),_:1}),c(b,{class:"detail-item"},{default:o((()=>[c(_,{class:"detail-label"},{default:o((()=>[u("å­¦åˆ†")])),_:1}),c(_,{class:"detail-value"},{default:o((()=>[u(r(h.value.course_credits)+"å­¦åˆ†",1)])),_:1})])),_:1}),c(b,{class:"detail-item"},{default:o((()=>[c(_,{class:"detail-label"},{default:o((()=>[u("è¯¾ç¨‹å±æ€§")])),_:1}),c(_,{class:"detail-value"},{default:o((()=>[u(r(h.value.course_property),1)])),_:1})])),_:1}),c(b,{class:"detail-item"},{default:o((()=>[c(_,{class:"detail-label"},{default:o((()=>[u("ä¸Šè¯¾æ—¶é—´")])),_:1}),c(_,{class:"detail-value"},{default:o((()=>[u(r(h.value.class_time),1)])),_:1})])),_:1}),c(b,{class:"detail-item"},{default:o((()=>[c(_,{class:"detail-label"},{default:o((()=>[u("æ•™å®¤")])),_:1}),c(_,{class:"detail-value"},{default:o((()=>[u(r(h.value.classroom),1)])),_:1})])),_:1}),h.value.class_name?(s(),n(b,{key:0,class:"detail-item"},{default:o((()=>[c(_,{class:"detail-label"},{default:o((()=>[u("ç­çº§")])),_:1}),c(_,{class:"detail-value"},{default:o((()=>[u(r(h.value.class_name),1)])),_:1})])),_:1})):d("",!0)])),_:1})])),_:1})):d("",!0)])),_:1},512)])),_:1})}}},[["__scopeId","data-v-4306f1ce"]]),U=$({__name:"WarningModal",emits:["confirm"],setup(a,{expose:t,emit:r}){const d=r,i=e(null);function f(){var e;null==(e=i.value)||e.close()}function p(){f(),d("confirm")}return t({show:function(){var e;null==(e=i.value)||e.open()},hide:f}),(e,a)=>{const t=M(l("uni-icons"),j),r=g,d=m,f=y,_=M(l("uni-popup"),A);return s(),n(_,{ref_key:"warningPopup",ref:i,type:"center","background-color":"rgba(0, 0, 0, 0.5)","mask-click":!1},{default:o((()=>[c(r,{class:"warning-modal"},{default:o((()=>[c(r,{class:"warning-icon"},{default:o((()=>[c(t,{type:"info",size:"60",color:"#ff9500"})])),_:1}),c(r,{class:"modal-title"},{default:o((()=>[c(d,{class:"title-text"},{default:o((()=>[u("åŠŸèƒ½æµ‹è¯•æé†’")])),_:1})])),_:1}),c(r,{class:"modal-content"},{default:o((()=>[c(d,{class:"content-text"},{default:o((()=>[u(" æœ¬è¯¾ç¨‹è¡¨åŠŸèƒ½å°šæœªç»è¿‡å……åˆ†æµ‹è¯•ï¼Œå¯èƒ½å­˜åœ¨æ•°æ®ä¸å‡†ç¡®æˆ–åŠŸèƒ½ä¸ç¨³å®šçš„æƒ…å†µï¼Œè¯·å‹¿å®Œå…¨ä¾èµ–ã€‚ ")])),_:1}),c(d,{class:"content-text"},{default:o((()=>[u(" ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿éšæ—¶åé¦ˆã€‚ ")])),_:1})])),_:1}),c(r,{class:"modal-actions"},{default:o((()=>[c(f,{class:"action-btn primary-btn",onClick:p},{default:o((()=>[u(" æˆ‘å·²çŸ¥æ™“ ")])),_:1})])),_:1})])),_:1})])),_:1},512)}}},[["__scopeId","data-v-cda6aa8a"]]),F=$({__name:"classtable",setup(t){const l=e(!0),r=e((new Date).toISOString().split("T")[0]),d=e({}),i=e(null),f=e(null),p=a((()=>d.value[r.value]||[]));function _(){const e=D("token");if(!e)return b({title:"è¯·å…ˆç™»å½•",icon:"none"}),S({url:"/pages/index/index"}),!1;try{const a=L(e);return console.log("Token éªŒè¯æˆåŠŸ",a),!0}catch(a){return console.error("Token è§£æå¤±è´¥",a),x("token"),b({title:"å‡­è¯æ— æ•ˆ,è¯·é‡æ–°ç™»å½•",icon:"none"}),S({url:"/pages/index/index"}),!1}}async function v(e){r.value=e,d.value[e]||await y(e),setTimeout((()=>{h(e)}),500)}async function y(e){const a=w(e);if($.has(a))return;const t=D("token"),l=C().globalData.apiBaseURL;try{$.add(a),I({title:"åŠ è½½ä¸­..."});const{statusCode:s,data:n}=await T({url:`${l}/api/v1/classtable/week`,method:"GET",header:{Authorization:"Bearer "+t},data:{query_date:e}});200===s&&n.success?n.data&&n.data.days&&(n.data.days.forEach((e=>{d.value[e.date]=e.courses||[]})),M.add(a)):401===s?j():b({title:n.detail||n.message||"è·å–è¯¾ç¨‹è¡¨å¤±è´¥",icon:"none"})}catch(s){console.error("è·å–è¯¾ç¨‹å¤±è´¥",s),b({title:"ç½‘ç»œè¿æ¥å¤±è´¥",icon:"none"})}finally{z(),$.delete(a)}}async function h(e){const a=[],t=new Date(e);for(let s=-3;s<=3;s++){const e=new Date(t);e.setDate(t.getDate()+s);const l=e.toISOString().split("T")[0],n=w(l);M.has(n)||d.value[l]||a.push(l)}const l=[...new Set(a.map((e=>w(e))))];for(const s of l){const e=a.find((e=>w(e)===s));e&&await y(e)}}function w(e){const a=new Date(e),t=new Date(a),l=a.getDay(),s=a.getDate()-l+(0===l?-6:1);return t.setDate(s),t.toISOString().split("T")[0]}E((()=>{_()&&(k({title:"è¯¾ç¨‹è¡¨"}),setTimeout((()=>{f.value&&f.value.show()}),500),async function(){l.value=!0;const e=D("token"),a=C().globalData.apiBaseURL;try{const{statusCode:t,data:s}=await T({url:`${a}/api/v1/classtable/today`,method:"GET",header:{Authorization:"Bearer "+e}});if(200===t&&s.success){const e=s.data.date;d.value[e]=s.data.courses||[],r.value=e,M.add(w(e)),setTimeout((()=>{h(e)}),1e3)}else 401===t?j():b({title:s.detail||s.message||"è·å–è¯¾ç¨‹è¡¨å¤±è´¥",icon:"none"})}catch(t){console.error("è·å–ä»Šæ—¥è¯¾ç¨‹å¤±è´¥",t),b({title:"ç½‘ç»œè¿æ¥å¤±è´¥",icon:"none"})}finally{l.value=!1}}())})),B((()=>{_()}));const $=new Set,M=new Set;function j(){x("token"),b({title:"ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•",icon:"none"}),setTimeout((()=>S({url:"/pages/index/index"})),1500)}function A(){console.log("ç”¨æˆ·å·²ç¡®è®¤è­¦å‘Šä¿¡æ¯")}return(e,a)=>{const t=g,d=m;return s(),n(P,null,{default:o((()=>[l.value?(s(),n(q,{key:0,text:"æ­£åœ¨åŠ è½½è¯¾è¡¨æ•°æ®..."})):(s(),n(t,{key:1,class:"page-container page-rounded-container"},{default:o((()=>[c(t,{class:"background-decoration"},{default:o((()=>[c(t,{class:"circle circle-1"}),c(t,{class:"circle circle-2"}),c(t,{class:"circle circle-3"})])),_:1}),c(t,{class:"page-header"},{default:o((()=>[c(t,{class:"header-content"},{default:o((()=>[c(d,{class:"page-title"},{default:o((()=>[u("è¯¾ç¨‹è¡¨")])),_:1}),c(d,{class:"page-subtitle"},{default:o((()=>[u("Class Schedule")])),_:1})])),_:1})])),_:1}),c(t,{class:"content-wrapper"},{default:o((()=>[c(R,{ref_key:"dateNavigatorRef",ref:i,"selected-date":r.value,onDateChange:v},null,8,["selected-date"]),c(O,{name:"fade",mode:"out-in"},{default:o((()=>[(s(),n(N,{key:r.value,courses:p.value,"selected-date":r.value},null,8,["courses","selected-date"]))])),_:1})])),_:1})])),_:1})),c(U,{ref_key:"warningModalRef",ref:f,onConfirm:A},null,512)])),_:1})}}},[["__scopeId","data-v-af4ec372"]]);export{F as default};

import{Z as e,p as a,_ as l,$ as s,a0 as t,r as c,c as u,w as n,q as r,s as o,u as i,g as d,o as f,a as _,j as p,n as m,t as v,d as h,f as g,R as y,F as b,l as k,A as T,v as x,k as z,I as $,K as C}from"./index-D-qd8VPP.js";import{r as j,_ as w}from"./uni-app.es.DILbbnHK.js";import{_ as P}from"./_plugin-vue_export-helper.BCo6x5W8.js";const V=P({__name:"average-scores",setup(P){const V=e({course:"",teacher:""}),H=a({}),A=a(!1),B=a(!1),F=a("未找到相关数据"),I=a(!1),O=a(!1),U=a(!1),E=a(!1),R=l((()=>Object.keys(H.value).length>0)),q=l((()=>{const e=V.course.trim().length;return 0===e?"请输入课程名称或代码":e<3?`至少需要3个字符，当前${e}个字符`:`已输入${e}个字符`})),D=l((()=>{const e=V.teacher.trim().length;return 0===e?"":e<2?`至少需要2个字符，当前${e}个字符`:`已输入${e}个字符`})),G=l((()=>{const e=V.course.trim().length,a=V.teacher.trim().length;return e>=3&&(0===a||a>=2)}));function K(){U.value=!0}function L(){U.value=!1}function S(){E.value=!0}function Z(){E.value=!1}function J(){return!!r("token")||(o({title:"请先登录",icon:"none"}),i({url:"/pages/index/index"}),!1)}function M(){const e=V.course.trim().length;I.value=e>0&&e<3}function N(){const e=V.teacher.trim().length;O.value=e>0&&e<2}async function Q(){if(J())if(V.course.trim())if(V.course.trim().length<3)o({title:"课程名称至少需要3个字符",icon:"none"});else if(V.teacher.trim()&&V.teacher.trim().length<2)o({title:"教师姓名至少需要2个字符",icon:"none"});else{A.value=!0,B.value=!0;try{const e={course:V.course.trim()};V.teacher.trim()&&(e.teacher=V.teacher.trim());const a=await function(e){const a=k().globalData.apiBaseURL,l=r("token");if(!l)return o({title:"请先登录",icon:"none"}),void i({url:"/pages/index/index"});return new Promise(((s,t)=>{T({url:`${a}/api/v1/average-scores`,method:"GET",data:e,header:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},success:e=>{var a;if(401===e.statusCode)return x("token"),o({title:"登录已过期，请重新登录",icon:"none"}),void setTimeout((()=>{i({url:"/pages/index/index"})}),1500);200===e.statusCode?s(e.data):t(new Error(`HTTP ${e.statusCode}: ${(null==(a=e.data)?void 0:a.message)||"请求失败"}`))},fail:e=>t(e)})}))}(e);200===a.code?(H.value=a.data,R.value||(F.value="未找到相关数据")):(H.value={},F.value=a.message||"查询失败",o({title:F.value,icon:"none"}))}catch(e){console.error("查询平均分失败:",e),H.value={};let a="网络错误，请重试";e.message&&(e.message.includes("HTTP 422")?a="输入参数格式错误，请检查输入内容":e.message.includes("HTTP 400")?a="请求参数错误，请检查输入内容":e.message.includes("HTTP 500")?a="服务器内部错误，请稍后重试":e.message.includes("HTTP")&&(a=`请求失败: ${e.message}`)),F.value=a,o({title:a,icon:"none",duration:3e3})}finally{A.value=!1}}else o({title:"请输入课程名称或代码",icon:"none"})}function W(){V.course="",V.teacher="",H.value={},B.value=!1,I.value=!1,O.value=!1}return s((()=>{t({title:"平均分查询"}),J()})),(e,a)=>{const l=d,s=z,t=j(c("uni-icons"),w),r=$,o=C;return f(),u(l,{class:"page-container page-rounded-container"},{default:n((()=>[_(l,{class:"background-decoration"},{default:n((()=>[_(l,{class:"circle circle-1"}),_(l,{class:"circle circle-2"}),_(l,{class:"circle circle-3"})])),_:1}),_(l,{class:"page-header"},{default:n((()=>[_(l,{class:"header-content"},{default:n((()=>[_(s,{class:"page-title"},{default:n((()=>[p("平均分查询")])),_:1}),_(s,{class:"page-subtitle"},{default:n((()=>[p("Academic Score Analysis")])),_:1})])),_:1})])),_:1}),_(l,{class:"content-wrapper"},{default:n((()=>[_(l,{class:"search-card modern-card"},{default:n((()=>[_(l,{class:"card-header"},{default:n((()=>[_(l,{class:"header-icon"},{default:n((()=>[_(t,{type:"search",size:"24",color:"#7f4515"})])),_:1}),_(l,{class:"header-text"},{default:n((()=>[_(s,{class:"card-title"},{default:n((()=>[p("课程信息查询")])),_:1}),_(s,{class:"card-subtitle"},{default:n((()=>[p("输入课程信息开始查询")])),_:1})])),_:1})])),_:1}),_(l,{class:"form-content"},{default:n((()=>[_(l,{class:"form-group"},{default:n((()=>[_(l,{class:"input-label"},{default:n((()=>[_(t,{type:"book",size:"20",color:"#495057"}),_(s,null,{default:n((()=>[p("课程名称/代码")])),_:1})])),_:1}),_(l,{class:"input-wrapper"},{default:n((()=>[_(r,{class:m(["modern-input",{"input-error":I.value,"input-focus":U.value}]),modelValue:V.course,"onUpdate:modelValue":a[0]||(a[0]=e=>V.course=e),placeholder:"请输入课程名称或课程代码（至少3个字符）",onConfirm:Q,onInput:M,onFocus:K,onBlur:L},null,8,["class","modelValue"]),_(l,{class:m(["input-line",{active:U.value}])},null,8,["class"])])),_:1}),_(s,{class:m(["input-hint",{"hint-error":I.value}])},{default:n((()=>[p(v(q.value),1)])),_:1},8,["class"])])),_:1}),_(l,{class:"form-group"},{default:n((()=>[_(l,{class:"input-label"},{default:n((()=>[_(t,{type:"person",size:"20",color:"#495057"}),_(s,null,{default:n((()=>[p("教师姓名（选填）")])),_:1})])),_:1}),_(l,{class:"input-wrapper"},{default:n((()=>[_(r,{class:m(["modern-input",{"input-error":O.value,"input-focus":E.value}]),modelValue:V.teacher,"onUpdate:modelValue":a[1]||(a[1]=e=>V.teacher=e),placeholder:"不填则查询所有老师（至少2个字符）",onConfirm:Q,onInput:N,onFocus:S,onBlur:Z},null,8,["class","modelValue"]),_(l,{class:m(["input-line",{active:E.value}])},null,8,["class"])])),_:1}),V.teacher.trim()?(f(),u(s,{key:0,class:m(["input-hint",{"hint-error":O.value}])},{default:n((()=>[p(v(D.value),1)])),_:1},8,["class"])):h("",!0)])),_:1}),_(l,{class:"button-group"},{default:n((()=>[_(o,{class:"action-btn primary-btn",onClick:Q,loading:A.value,disabled:!G.value},{default:n((()=>[A.value?h("",!0):(f(),u(t,{key:0,type:"search",size:"20",color:"#ffffff"})),_(s,null,{default:n((()=>[p(v(A.value?"查询中...":"开始查询"),1)])),_:1})])),_:1},8,["loading","disabled"]),_(o,{class:"action-btn secondary-btn",onClick:W},{default:n((()=>[_(t,{type:"refresh",size:"20",color:"#495057"}),_(s,null,{default:n((()=>[p("重置")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),R.value?(f(),u(l,{key:0,class:"results-section"},{default:n((()=>[_(l,{class:"results-header"},{default:n((()=>[_(l,{class:"results-info"},{default:n((()=>[_(s,{class:"results-title"},{default:n((()=>[p("查询结果")])),_:1}),_(s,{class:"results-count"},{default:n((()=>[p(" 共找到 "+v(Object.keys(H.value).length)+" 门课程 ",1)])),_:1})])),_:1})])),_:1}),(f(!0),g(b,null,y(H.value,((e,a)=>(f(),u(l,{class:"course-card modern-card",key:a},{default:n((()=>[_(l,{class:"course-header"},{default:n((()=>[_(l,{class:"course-info"},{default:n((()=>[_(l,{class:"course-icon"},{default:n((()=>[_(t,{type:"book",size:"20",color:"#7f4515"})])),_:1}),_(s,{class:"course-name"},{default:n((()=>[p(v(a),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),_(l,{class:"course-content"},{default:n((()=>[(f(!0),g(b,null,y(Object.keys(e),((a,c)=>(f(),u(l,{class:"teacher-section",key:a},{default:n((()=>[_(l,{class:"teacher-header"},{default:n((()=>[_(l,{class:"teacher-info"},{default:n((()=>[_(l,{class:"teacher-avatar"},{default:n((()=>[_(t,{type:"person",size:"16",color:"#7f4515"})])),_:1}),_(s,{class:"teacher-name"},{default:n((()=>[p(v(a),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),_(l,{class:"semester-list"},{default:n((()=>[(f(!0),g(b,null,y(e[a],((e,a)=>(f(),u(l,{class:"semester-item",key:a},{default:n((()=>[_(l,{class:"semester-info"},{default:n((()=>[_(s,{class:"semester-name"},{default:n((()=>[p(v(a),1)])),_:2},1024),e.update_time?(f(),u(s,{key:0,class:"update-time"},{default:n((()=>{return[p(v((a=e.update_time,a?a.replace("T"," ").split(".")[0]:"")),1)];var a})),_:2},1024)):h("",!0)])),_:2},1024),_(l,{class:"score-info"},{default:n((()=>[_(l,{class:"score-item"},{default:n((()=>[_(s,{class:"score-label"},{default:n((()=>[p("平均分")])),_:1}),_(s,{class:"score-value primary"},{default:n((()=>[p(v(e.average_score.toFixed(2)),1)])),_:2},1024)])),_:2},1024),_(l,{class:"score-item"},{default:n((()=>[_(s,{class:"score-label"},{default:n((()=>[p("人数")])),_:1}),_(s,{class:"score-value secondary"},{default:n((()=>[p(v(e.student_count),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})):B.value&&!A.value?(f(),u(l,{key:1,class:"empty-state modern-card"},{default:n((()=>[_(l,{class:"empty-content"},{default:n((()=>[_(l,{class:"empty-icon"},{default:n((()=>[_(t,{type:"info",size:"80",color:"#adb5bd"})])),_:1}),_(s,{class:"empty-title"},{default:n((()=>[p("未找到相关数据")])),_:1}),_(s,{class:"empty-subtitle"},{default:n((()=>[p(v(F.value),1)])),_:1}),_(o,{class:"action-btn primary-btn retry-btn",onClick:W},{default:n((()=>[_(t,{type:"refresh",size:"20",color:"#ffffff"}),_(s,null,{default:n((()=>[p("重新搜索")])),_:1})])),_:1})])),_:1})])),_:1})):B.value||A.value?A.value?(f(),u(l,{key:3,class:"loading-state modern-card"},{default:n((()=>[_(l,{class:"loading-content"},{default:n((()=>[_(l,{class:"loading-spinner"},{default:n((()=>[_(t,{type:"spinner-cycle",size:"60",color:"#7f4515"})])),_:1}),_(s,{class:"loading-text"},{default:n((()=>[p("正在查询数据...")])),_:1})])),_:1})])),_:1})):h("",!0):(f(),u(l,{key:2,class:"initial-state modern-card"},{default:n((()=>[_(l,{class:"initial-content"},{default:n((()=>[_(l,{class:"initial-icon"},{default:n((()=>[_(t,{type:"search",size:"80",color:"#7f4515"})])),_:1}),_(s,{class:"initial-title"},{default:n((()=>[p("欢迎使用平均分查询")])),_:1}),_(s,{class:"initial-subtitle"},{default:n((()=>[p("请输入课程信息开始查询学术数据")])),_:1})])),_:1})])),_:1}))])),_:1})])),_:1})}}},[["__scopeId","data-v-8db9df85"]]);export{V as default};

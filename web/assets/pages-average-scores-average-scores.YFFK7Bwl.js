import{_ as e,B as a,X as t,r as s,o as l,c as n,w as c,a as r,b as u,h as o,t as i,k as d,f,d as p,i as _,I as m,A as v,m as y,F as h,O as g,L as b,$ as k,D as T,E as z,u as C,J as x,G as $}from"./index-u5bH-0W2.js";import{_ as j,r as w,a as I}from"./uni-icons.DEhYDXqH.js";const S=j({__name:"SearchForm",props:{loading:{type:Boolean,default:!1}},emits:["search","reset"],setup(y,{emit:h}){const g=h,b=e({course:"",teacher:""}),k=a(!1),T=a(!1),z=a(!1),C=a(!1),x=t((()=>{const e=b.course.trim().length;return 0===e?"请输入课程名称或代码":e<3?`至少需要3个字符，当前${e}个字符`:`已输入${e}个字符`})),$=t((()=>{const e=b.teacher.trim().length;return 0===e?"":e<2?`至少需要2个字符，当前${e}个字符`:`已输入${e}个字符`})),j=t((()=>{const e=b.course.trim().length,a=b.teacher.trim().length;return e>=3&&(0===a||a>=2)}));function S(){z.value=!0}function O(){z.value=!1}function P(){C.value=!0}function B(){C.value=!1}function D(){const e=b.course.trim().length;k.value=e>0&&e<3}function V(){const e=b.teacher.trim().length;T.value=e>0&&e<2}function F(){if(!b.course.trim())return void f({title:"请输入课程名称或代码",icon:"none"});if(b.course.trim().length<3)return void f({title:"课程名称至少需要3个字符",icon:"none"});if(b.teacher.trim()&&b.teacher.trim().length<2)return void f({title:"教师姓名至少需要2个字符",icon:"none"});const e={course:b.course.trim()};b.teacher.trim()&&(e.teacher=b.teacher.trim()),g("search",e)}function H(){b.course="",b.teacher="",k.value=!1,T.value=!1,g("reset")}return(e,a)=>{const t=w(s("uni-icons"),I),f=p,h=_,g=m,A=v;return l(),n(f,{class:"search-card modern-card"},{default:c((()=>[r(f,{class:"card-header"},{default:c((()=>[r(f,{class:"header-icon"},{default:c((()=>[r(t,{type:"search",size:"24",color:"#7f4515"})])),_:1}),r(f,{class:"header-text"},{default:c((()=>[r(h,{class:"card-title"},{default:c((()=>[u("课程信息查询")])),_:1}),r(h,{class:"card-subtitle"},{default:c((()=>[u("输入课程信息开始查询")])),_:1})])),_:1})])),_:1}),r(f,{class:"form-content"},{default:c((()=>[r(f,{class:"form-group"},{default:c((()=>[r(f,{class:"input-label"},{default:c((()=>[r(t,{type:"book",size:"20",color:"#495057"}),r(h,null,{default:c((()=>[u("课程名称/代码")])),_:1})])),_:1}),r(f,{class:"input-wrapper"},{default:c((()=>[r(g,{class:o(["modern-input",{"input-error":k.value,"input-focus":z.value}]),modelValue:b.course,"onUpdate:modelValue":a[0]||(a[0]=e=>b.course=e),placeholder:"请输入课程名称或课程代码（至少3个字符）",onConfirm:F,onInput:D,onFocus:S,onBlur:O},null,8,["class","modelValue"]),r(f,{class:o(["input-line",{active:z.value}])},null,8,["class"])])),_:1}),r(h,{class:o(["input-hint",{"hint-error":k.value}])},{default:c((()=>[u(i(x.value),1)])),_:1},8,["class"])])),_:1}),r(f,{class:"form-group"},{default:c((()=>[r(f,{class:"input-label"},{default:c((()=>[r(t,{type:"person",size:"20",color:"#495057"}),r(h,null,{default:c((()=>[u("教师姓名（选填）")])),_:1})])),_:1}),r(f,{class:"input-wrapper"},{default:c((()=>[r(g,{class:o(["modern-input",{"input-error":T.value,"input-focus":C.value}]),modelValue:b.teacher,"onUpdate:modelValue":a[1]||(a[1]=e=>b.teacher=e),placeholder:"不填则查询所有老师（至少2个字符）",onConfirm:F,onInput:V,onFocus:P,onBlur:B},null,8,["class","modelValue"]),r(f,{class:o(["input-line",{active:C.value}])},null,8,["class"])])),_:1}),b.teacher.trim()?(l(),n(h,{key:0,class:o(["input-hint",{"hint-error":T.value}])},{default:c((()=>[u(i($.value),1)])),_:1},8,["class"])):d("",!0)])),_:1}),r(f,{class:"button-group"},{default:c((()=>[r(A,{class:"action-btn primary-btn",onClick:F,loading:y.loading,disabled:!j.value},{default:c((()=>[y.loading?d("",!0):(l(),n(t,{key:0,type:"search",size:"20",color:"#ffffff"})),r(h,null,{default:c((()=>[u(i(y.loading?"查询中...":"开始查询"),1)])),_:1})])),_:1},8,["loading","disabled"]),r(A,{class:"action-btn secondary-btn",onClick:H},{default:c((()=>[r(t,{type:"refresh",size:"20",color:"#495057"}),r(h,null,{default:c((()=>[u("重置")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-6e6583d0"]]),O=j({__name:"CourseCard",props:{courseName:{type:String,required:!0},teachers:{type:Object,required:!0}},setup:e=>(a,t)=>{const o=w(s("uni-icons"),I),f=p,m=_;return l(),n(f,{class:"course-card modern-card"},{default:c((()=>[r(f,{class:"course-header"},{default:c((()=>[r(f,{class:"course-info"},{default:c((()=>[r(f,{class:"course-icon"},{default:c((()=>[r(o,{type:"book",size:"20",color:"#7f4515"})])),_:1}),r(m,{class:"course-name"},{default:c((()=>[u(i(e.courseName),1)])),_:1})])),_:1})])),_:1}),r(f,{class:"course-content"},{default:c((()=>[(l(!0),y(h,null,g(Object.keys(e.teachers),((a,t)=>(l(),n(f,{class:"teacher-section",key:a},{default:c((()=>[r(f,{class:"teacher-header"},{default:c((()=>[r(f,{class:"teacher-info"},{default:c((()=>[r(f,{class:"teacher-avatar"},{default:c((()=>[r(o,{type:"person",size:"16",color:"#7f4515"})])),_:1}),r(m,{class:"teacher-name"},{default:c((()=>[u(i(a),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),r(f,{class:"semester-list"},{default:c((()=>[(l(!0),y(h,null,g(e.teachers[a],((e,a)=>(l(),n(f,{class:"semester-item",key:a},{default:c((()=>[r(f,{class:"semester-info"},{default:c((()=>[r(m,{class:"semester-name"},{default:c((()=>[u(i(a),1)])),_:2},1024),e.update_time?(l(),n(m,{key:0,class:"update-time"},{default:c((()=>{return[u(i((a=e.update_time,a?a.replace("T"," ").split(".")[0]:"")),1)];var a})),_:2},1024)):d("",!0)])),_:2},1024),r(f,{class:"score-info"},{default:c((()=>[r(f,{class:"score-item"},{default:c((()=>[r(m,{class:"score-label"},{default:c((()=>[u("平均分")])),_:1}),r(m,{class:"score-value primary"},{default:c((()=>[u(i(e.average_score.toFixed(2)),1)])),_:2},1024)])),_:2},1024),r(f,{class:"score-item"},{default:c((()=>[r(m,{class:"score-label"},{default:c((()=>[u("人数")])),_:1}),r(m,{class:"score-value secondary"},{default:c((()=>[u(i(e.student_count),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})}},[["__scopeId","data-v-8c1c7b84"]]),P=j({__name:"ResultsSection",props:{resultData:{type:Object,default:()=>({})}},setup(e){const a=e,s=t((()=>Object.keys(a.resultData).length>0));return(a,t)=>{const o=_,f=p;return s.value?(l(),n(f,{key:0,class:"results-section"},{default:c((()=>[r(f,{class:"results-header"},{default:c((()=>[r(f,{class:"results-info"},{default:c((()=>[r(o,{class:"results-title"},{default:c((()=>[u("查询结果")])),_:1}),r(o,{class:"results-count"},{default:c((()=>[u(" 共找到 "+i(Object.keys(e.resultData).length)+" 门课程 ",1)])),_:1})])),_:1})])),_:1}),(l(!0),y(h,null,g(e.resultData,((e,a)=>(l(),n(O,{key:a,"course-name":a,teachers:e},null,8,["course-name","teachers"])))),128))])),_:1})):d("",!0)}}},[["__scopeId","data-v-cfda1fab"]]),B=j({__name:"StateComponents",props:{type:{type:String,required:!0,validator:e=>["empty","initial","loading"].includes(e)},message:{type:String,default:"未找到相关数据"}},emits:["retry"],setup:e=>(a,t)=>{const o=w(s("uni-icons"),I),f=p,m=_,y=v;return"empty"===e.type?(l(),n(f,{key:0,class:"empty-state modern-card"},{default:c((()=>[r(f,{class:"empty-content"},{default:c((()=>[r(f,{class:"empty-icon"},{default:c((()=>[r(o,{type:"info",size:"80",color:"#adb5bd"})])),_:1}),r(m,{class:"empty-title"},{default:c((()=>[u("未找到相关数据")])),_:1}),r(m,{class:"empty-subtitle"},{default:c((()=>[u(i(e.message),1)])),_:1}),r(y,{class:"action-btn primary-btn retry-btn",onClick:t[0]||(t[0]=e=>a.$emit("retry"))},{default:c((()=>[r(o,{type:"refresh",size:"20",color:"#ffffff"}),r(m,null,{default:c((()=>[u("重新搜索")])),_:1})])),_:1})])),_:1})])),_:1})):"initial"===e.type?(l(),n(f,{key:1,class:"initial-state modern-card"},{default:c((()=>[r(f,{class:"initial-content"},{default:c((()=>[r(f,{class:"initial-icon"},{default:c((()=>[r(o,{type:"search",size:"80",color:"#7f4515"})])),_:1}),r(m,{class:"initial-title"},{default:c((()=>[u("欢迎使用平均分查询")])),_:1}),r(m,{class:"initial-subtitle"},{default:c((()=>[u("请输入课程信息开始查询学术数据")])),_:1})])),_:1})])),_:1})):"loading"===e.type?(l(),n(f,{key:2,class:"loading-state modern-card"},{default:c((()=>[r(f,{class:"loading-content"},{default:c((()=>[r(f,{class:"loading-spinner"},{default:c((()=>[r(o,{type:"spinner-cycle",size:"60",color:"#7f4515"})])),_:1}),r(m,{class:"loading-text"},{default:c((()=>[u("正在查询数据...")])),_:1})])),_:1})])),_:1})):d("",!0)}},[["__scopeId","data-v-c9aeea82"]]),D=j({__name:"average-scores",setup(e){const s=a({}),o=a(!1),i=a(!1),m=a("未找到相关数据");function v(){return!!T("token")||(f({title:"请先登录",icon:"none"}),z({url:"/pages/index/index"}),!1)}const y=t((()=>Object.keys(s.value).length>0));async function h(e){if(v()){o.value=!0,i.value=!0;try{const a=await function(e){const a=C().globalData.apiBaseURL,t=T("token");return t?new Promise(((s,l)=>{x({url:`${a}/api/v1/average-scores`,method:"GET",data:e,header:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},success:e=>{var a;if(401===e.statusCode)return $("token"),f({title:"登录已过期，请重新登录",icon:"none"}),void setTimeout((()=>{z({url:"/pages/index/index"})}),1500);200===e.statusCode?s(e.data):l(new Error(`HTTP ${e.statusCode}: ${(null==(a=e.data)?void 0:a.message)||"请求失败"}`))},fail:e=>l(e)})})):(f({title:"请先登录",icon:"none"}),z({url:"/pages/index/index"}),Promise.reject(new Error("未登录")))}(e);200===a.code?(s.value=a.data,y.value||(m.value="未找到相关数据")):(s.value={},m.value=a.message||"查询失败",f({title:m.value,icon:"none"}))}catch(a){console.error("查询平均分失败:",a),s.value={};const e=function(e){let a="网络错误，请重试";return e.message&&(e.message.includes("HTTP 422")?a="输入参数格式错误，请检查输入内容":e.message.includes("HTTP 400")?a="请求参数错误，请检查输入内容":e.message.includes("HTTP 500")?a="服务器内部错误，请稍后重试":e.message.includes("HTTP")&&(a=`请求失败: ${e.message}`)),a}(a);m.value=e,f({title:e,icon:"none",duration:3e3})}finally{o.value=!1}}}function g(){s.value={},i.value=!1}return b((()=>{k({title:"平均分查询"}),v(),console.log("用户进入平均分查询页面")})),(e,a)=>{const t=p,f=_;return l(),n(t,{class:"page-container page-rounded-container"},{default:c((()=>[r(t,{class:"background-decoration"},{default:c((()=>[r(t,{class:"circle circle-1"}),r(t,{class:"circle circle-2"}),r(t,{class:"circle circle-3"})])),_:1}),r(t,{class:"page-header"},{default:c((()=>[r(t,{class:"header-content"},{default:c((()=>[r(f,{class:"page-title"},{default:c((()=>[u("平均分查询")])),_:1}),r(f,{class:"page-subtitle"},{default:c((()=>[u("Academic Score Analysis")])),_:1})])),_:1})])),_:1}),r(t,{class:"content-wrapper"},{default:c((()=>[r(S,{loading:o.value,onSearch:h,onReset:g},null,8,["loading"]),y.value?(l(),n(P,{key:0,"result-data":s.value},null,8,["result-data"])):i.value&&!o.value?(l(),n(B,{key:1,type:"empty",message:m.value,onRetry:g},null,8,["message"])):i.value||o.value?o.value?(l(),n(B,{key:3,type:"loading"})):d("",!0):(l(),n(B,{key:2,type:"initial"}))])),_:1})])),_:1})}}},[["__scopeId","data-v-7db8bb27"]]);export{D as default};

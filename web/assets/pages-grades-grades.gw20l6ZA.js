import{o as e,c as a,w as l,a as s,j as t,t as u,f as c,F as o,L as d,d as r,k as i,g as n,Z as f,r as _,n as p,N as m,O as g,_ as v,K as y,$ as C,a0 as b,l as k,A as h,q as G,v as A,s as x,u as P,p as w}from"./index-qsGqFczC.js";import{r as M,_ as N,o as j,a as $}from"./uni-app.es.Cb3wHe_V.js";import{P as R}from"./PageLayout.BYQ7MWD5.js";import{L as S,E as F}from"./EmptyState.BDA6CK7X.js";import{_ as O}from"./_plugin-vue_export-helper.BCo6x5W8.js";const T=O({__name:"GPAAnalysis",props:{gpaAnalysis:{type:Object,default:null},effectiveGpa:{type:Object,default:null},totalCourses:{type:Number,default:0},yearlyGpa:{type:Object,default:null},semesterGpa:{type:Object,default:null}},setup:f=>(_,p)=>{const m=i,g=n;return f.gpaAnalysis?(e(),a(g,{key:0,class:"analysis-container"},{default:l((()=>[s(g,{class:"main-gpa-section"},{default:l((()=>[s(g,{class:"gpa-item"},{default:l((()=>[s(m,{class:"gpa-value"},{default:l((()=>{var e,a;return[t(u((null==(a=null==(e=f.gpaAnalysis)?void 0:e.weighted_gpa)?void 0:a.toFixed(2))||"N/A"),1)]})),_:1}),s(m,{class:"gpa-label"},{default:l((()=>[t("æ€»åŠ æƒå¹³å‡GPA")])),_:1})])),_:1}),s(g,{class:"gpa-item"},{default:l((()=>[s(m,{class:"gpa-value"},{default:l((()=>{var e,a;return[t(u((null==(a=null==(e=f.effectiveGpa)?void 0:e.weighted_gpa)?void 0:a.toFixed(2))||"N/A"),1)]})),_:1}),s(m,{class:"gpa-label"},{default:l((()=>[t("æœ‰æ•ˆGPA (åŽ»é‡ä¿®)")])),_:1})])),_:1}),s(g,{class:"gpa-item"},{default:l((()=>[s(m,{class:"gpa-value"},{default:l((()=>[t(u(f.totalCourses||0),1)])),_:1}),s(m,{class:"gpa-label"},{default:l((()=>[t("æ€»è¯¾ç¨‹æ•°")])),_:1})])),_:1})])),_:1}),s(g,{class:"detailed-gpa-section"},{default:l((()=>[s(g,{class:"section-header"},{default:l((()=>[s(m,{class:"section-title"},{default:l((()=>[t("è¯¦ç»†GPAåˆ†å¸ƒ")])),_:1})])),_:1}),s(g,{class:"details-flex-container"},{default:l((()=>[f.yearlyGpa&&Object.keys(f.yearlyGpa).length>0?(e(!0),c(o,{key:0},d(f.yearlyGpa,((c,o)=>(e(),a(g,{key:o,class:"detail-item-flex"},{default:l((()=>[s(m,{class:"detail-label"},{default:l((()=>[t(u(o)+"å­¦å¹´",1)])),_:2},1024),s(m,{class:"detail-sub-info"},{default:l((()=>[t(u(c.course_count)+"é—¨ / "+u(c.total_credit.toFixed(1))+"å­¦åˆ†",1)])),_:2},1024),s(m,{class:"detail-value"},{default:l((()=>[t(u(c.weighted_gpa.toFixed(2)),1)])),_:2},1024)])),_:2},1024)))),128)):r("",!0),f.semesterGpa&&Object.keys(f.semesterGpa).length>0?(e(!0),c(o,{key:1},d(f.semesterGpa,((c,o)=>(e(),a(g,{key:o,class:"detail-item-flex"},{default:l((()=>[s(m,{class:"detail-label"},{default:l((()=>[t(u(o),1)])),_:2},1024),s(m,{class:"detail-sub-info"},{default:l((()=>[t(u(c.course_count)+"é—¨ / "+u(c.total_credit.toFixed(1))+"å­¦åˆ†",1)])),_:2},1024),s(m,{class:"detail-value"},{default:l((()=>[t(u(c.weighted_gpa.toFixed(2)),1)])),_:2},1024)])),_:2},1024)))),128)):r("",!0)])),_:1})])),_:1})])),_:1})):r("",!0)}},[["__scopeId","data-v-91db0b88"]]),B=O({__name:"CustomToggle",props:{isCustomMode:{type:Boolean,default:!1}},emits:["toggle"],setup(u,{emit:c}){const o=c,d=e=>{o("toggle",e.detail.value)};return(c,o)=>{const _=i,p=n,m=f;return e(),a(p,null,{default:l((()=>[s(p,{class:"custom-gpa-toggle-section"},{default:l((()=>[s(p,{class:"toggle-left"},{default:l((()=>[s(_,{class:"toggle-title"},{default:l((()=>[t("è‡ªå®šä¹‰GPAè®¡ç®—")])),_:1}),s(_,{class:"toggle-desc"},{default:l((()=>[t("å‹¾é€‰è¯¾ç¨‹ä»¥è®¡ç®—ç‰¹å®šGPA")])),_:1})])),_:1}),s(m,{checked:u.isCustomMode,onChange:d,color:"#7F4515"},null,8,["checked"])])),_:1}),u.isCustomMode?(e(),a(p,{key:0,class:"custom-mode-tip"},{default:l((()=>[s(p,{class:"tip-icon"},{default:l((()=>[t("ðŸ’¡")])),_:1}),s(_,{class:"tip-text"},{default:l((()=>[t("è¯·å‹¾é€‰ **éœ€è¦è®¡å…¥** GPAçš„è¯¾ç¨‹")])),_:1})])),_:1})):r("",!0)])),_:1})}}},[["__scopeId","data-v-8989b15f"]]),I=O({__name:"CourseList",props:{semesters:{type:Array,default:()=>[]},isCustomMode:{type:Boolean,default:!1},selectedCourses:{type:Array,default:()=>[]},expandedCourses:{type:Set,default:()=>new Set}},emits:["courseClick"],setup(f,{emit:v}){const y=f,C=e=>y.selectedCourses.includes(e),b=e=>y.expandedCourses.has(e),k=e=>{const a=parseFloat(e);return isNaN(a)?"score-text-grade":a>=90?"score-high":a>=75?"score-mid":a>=60?"score-low":"score-fail"};return(v,y)=>{const h=i,G=n,A=M(_("uni-icons"),N);return e(),a(G,{class:"grades-list-container"},{default:l((()=>[(e(!0),c(o,null,d(f.semesters,(i=>(e(),a(G,{key:i.semesterName,class:"semester-block"},{default:l((()=>[s(G,{class:"semester-header"},{default:l((()=>[s(h,{class:"semester-name"},{default:l((()=>[t(u(i.semesterName),1)])),_:2},1024)])),_:2},1024),s(G,{class:"courses-list"},{default:l((()=>[(e(!0),c(o,null,d(i.grades,(c=>(e(),a(G,{key:c.index,class:p(["course-card",{"is-custom-mode":f.isCustomMode,"is-selected":C(c.index)}])},{default:l((()=>[s(G,{class:"course-main",onClick:e=>v.$emit("courseClick",c)},{default:l((()=>[f.isCustomMode?(e(),a(G,{key:0,class:"course-checkbox-wrapper"},{default:l((()=>[s(G,{class:p(["checkbox-inner",{checked:C(c.index)}])},null,8,["class"])])),_:2},1024)):r("",!0),s(G,{class:"course-core-info"},{default:l((()=>[s(h,{class:"course-name"},{default:l((()=>[t(u(c.courseName),1)])),_:2},1024),s(G,{class:"course-meta"},{default:l((()=>[s(G,{class:"meta-tag credit"},{default:l((()=>[t("å­¦åˆ†: "+u(c.credit),1)])),_:2},1024),s(G,{class:"meta-tag gpa"},{default:l((()=>[t("ç»©ç‚¹: "+u(c.gpa),1)])),_:2},1024),c.courseAttribute?(e(),a(G,{key:0,class:"meta-tag attribute"},{default:l((()=>[t(u(c.courseAttribute),1)])),_:2},1024)):r("",!0)])),_:2},1024)])),_:2},1024),s(G,{class:"course-side"},{default:l((()=>[s(G,{class:"course-score"},{default:l((()=>[s(h,{class:p(["score-text",k(c.score)])},{default:l((()=>[t(u(c.score),1)])),_:2},1032,["class"]),c.scoreTag?(e(),a(h,{key:0,class:"score-tag"},{default:l((()=>[t(u(c.scoreTag),1)])),_:2},1024)):r("",!0)])),_:2},1024),s(G,{class:p(["expand-icon",{expanded:b(c.index)}])},{default:l((()=>[s(A,{type:"down",size:"16",color:"#868e96"})])),_:2},1032,["class"])])),_:2},1024)])),_:2},1032,["onClick"]),m(s(G,{class:"course-details"},{default:l((()=>[s(G,{class:"detail-grid"},{default:l((()=>[s(G,{class:"detail-item"},{default:l((()=>[s(h,{class:"detail-label"},{default:l((()=>[t("è¯¾ç¨‹ä»£ç ")])),_:1}),s(h,{class:"detail-value"},{default:l((()=>[t(u(c.courseCode),1)])),_:2},1024)])),_:2},1024),s(G,{class:"detail-item"},{default:l((()=>[s(h,{class:"detail-label"},{default:l((()=>[t("æ€»å­¦æ—¶")])),_:1}),s(h,{class:"detail-value"},{default:l((()=>[t(u(c.totalHours),1)])),_:2},1024)])),_:2},1024),s(G,{class:"detail-item"},{default:l((()=>[s(h,{class:"detail-label"},{default:l((()=>[t("è¯¾ç¨‹æ€§è´¨")])),_:1}),s(h,{class:"detail-value"},{default:l((()=>[t(u(c.courseNature),1)])),_:2},1024)])),_:2},1024),s(G,{class:"detail-item"},{default:l((()=>[s(h,{class:"detail-label"},{default:l((()=>[t("è¯¾ç¨‹ç±»åˆ«")])),_:1}),s(h,{class:"detail-value"},{default:l((()=>[t(u(c.courseCategory),1)])),_:2},1024)])),_:2},1024),s(G,{class:"detail-item"},{default:l((()=>[s(h,{class:"detail-label"},{default:l((()=>[t("è€ƒæ ¸æ–¹å¼")])),_:1}),s(h,{class:"detail-value"},{default:l((()=>[t(u(c.assessmentMethod),1)])),_:2},1024)])),_:2},1024),s(G,{class:"detail-item"},{default:l((()=>[s(h,{class:"detail-label"},{default:l((()=>[t("è€ƒè¯•ç±»åž‹")])),_:1}),s(h,{class:"detail-value"},{default:l((()=>[t(u(c.examType),1)])),_:2},1024)])),_:2},1024),c.groupName?(e(),a(G,{key:0,class:"detail-item"},{default:l((()=>[s(h,{class:"detail-label"},{default:l((()=>[t("è¯¾ç¨‹åˆ†ç»„")])),_:1}),s(h,{class:"detail-value"},{default:l((()=>[t(u(c.groupName),1)])),_:2},1024)])),_:2},1024)):r("",!0),c.retakeSemester?(e(),a(G,{key:1,class:"detail-item"},{default:l((()=>[s(h,{class:"detail-label"},{default:l((()=>[t("é‡ä¿®å­¦æœŸ")])),_:1}),s(h,{class:"detail-value"},{default:l((()=>[t(u(c.retakeSemester),1)])),_:2},1024)])),_:2},1024)):r("",!0)])),_:2},1024)])),_:2},1536),[[g,b(c.index)]])])),_:2},1032,["class"])))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})}}},[["__scopeId","data-v-11507cc6"]]),L=O({__name:"CustomFooter",props:{isCustomMode:{type:Boolean,default:!1},customGPAResult:{type:Object,default:null},selectedCourses:{type:Array,default:()=>[]},allCourses:{type:Array,default:()=>[]},isCalculating:{type:Boolean,default:!1}},emits:["clearResult","selectAll","clearSelection","calculate"],setup(c,{emit:o}){const d=c,f=v((()=>`å·²é€‰ ${d.selectedCourses.length} / ${d.allCourses.length} é—¨`)),_=v((()=>d.isCalculating||0===d.selectedCourses.length));return(o,d)=>{const p=i,m=n,g=y;return c.isCustomMode?(e(),a(m,{key:0,class:"custom-gpa-footer"},{default:l((()=>[c.customGPAResult?(e(),a(m,{key:0,class:"result-display-card"},{default:l((()=>[s(m,{class:"result-header"},{default:l((()=>[s(p,{class:"result-title"},{default:l((()=>[t("è‡ªå®šä¹‰è®¡ç®—ç»“æžœ")])),_:1}),s(p,{class:"close-result-btn",onClick:d[0]||(d[0]=e=>o.$emit("clearResult"))},{default:l((()=>[t("å…³é—­")])),_:1})])),_:1}),s(m,{class:"result-content"},{default:l((()=>[s(m,{class:"result-gpa"},{default:l((()=>[s(p,{class:"gpa-value"},{default:l((()=>{var e;return[t(u((null==(e=c.customGPAResult.weighted_gpa)?void 0:e.toFixed(2))||"0.00"),1)]})),_:1}),s(p,{class:"gpa-label"},{default:l((()=>[t("åŠ æƒå¹³å‡GPA")])),_:1})])),_:1}),s(m,{class:"result-stats"},{default:l((()=>[s(m,{class:"stat-item"},{default:l((()=>[s(p,{class:"stat-value"},{default:l((()=>[t(u(c.customGPAResult.total_credit||0),1)])),_:1}),s(p,{class:"stat-label"},{default:l((()=>[t("æ€»å­¦åˆ†")])),_:1})])),_:1}),s(m,{class:"stat-item"},{default:l((()=>[s(p,{class:"stat-value"},{default:l((()=>[t(u(c.customGPAResult.course_count||0),1)])),_:1}),s(p,{class:"stat-label"},{default:l((()=>[t("è¯¾ç¨‹æ•°")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):r("",!0),s(m,{class:"footer-actions"},{default:l((()=>[s(m,{class:"selection-info"},{default:l((()=>[s(p,{class:"info-text"},{default:l((()=>[t(u(f.value),1)])),_:1}),s(m,{class:"actions"},{default:l((()=>[s(p,{class:"action-btn",onClick:d[1]||(d[1]=e=>o.$emit("selectAll"))},{default:l((()=>[t("å…¨é€‰")])),_:1}),s(p,{class:"action-btn",onClick:d[2]||(d[2]=e=>o.$emit("clearSelection"))},{default:l((()=>[t("æ¸…ç©º")])),_:1})])),_:1})])),_:1}),s(g,{class:"calculate-btn",onClick:d[3]||(d[3]=e=>o.$emit("calculate")),disabled:_.value},{default:l((()=>[t(u(c.isCalculating?"è®¡ç®—ä¸­...":"è®¡ç®—è‡ªå®šä¹‰GPA"),1)])),_:1},8,["disabled"])])),_:1})])),_:1})):r("",!0)}}},[["__scopeId","data-v-8260bf3a"]]),z=O({__name:"NoticeModal",props:{showModal:{type:Boolean,default:!1}},emits:["close"],setup:u=>(c,o)=>{const d=i,f=n,_=y;return e(),a(b,{name:"modal"},{default:l((()=>[u.showModal?(e(),a(f,{key:0,class:"modal-overlay",onClick:o[1]||(o[1]=C((e=>c.$emit("close")),["self"]))},{default:l((()=>[s(f,{class:"modal-container"},{default:l((()=>[s(f,{class:"modal-header"},{default:l((()=>[s(d,{class:"modal-title"},{default:l((()=>[t("æˆç»©æŸ¥è¯¢ä¸ŽGPAåˆ†æžæç¤º")])),_:1})])),_:1}),s(f,{class:"modal-content"},{default:l((()=>[s(d,null,{default:l((()=>[t(" å› ä¸åŒä¸“ä¸šæˆ–ä¸åŒç›®æ ‡é™¢æ ¡çš„è¦æ±‚ä¸åŒï¼Œä¿ç ”æ‰€éœ€è¦çš„ç»©ç‚¹è¦æ±‚ä¸åŒï¼Œå¦‚æœ‰éœ€æ±‚ï¼Œè¯·å‰å¾€åº•éƒ¨è‡ªå®šä¹‰GPAè®¡ç®—è‡ªè¡Œè®¡ç®— ")])),_:1})])),_:1}),s(f,{class:"modal-footer"},{default:l((()=>[s(_,{class:"modal-btn",onClick:o[0]||(o[0]=e=>c.$emit("close"))},{default:l((()=>[t("æˆ‘å·²çŸ¥æ™“")])),_:1})])),_:1})])),_:1})])),_:1})):r("",!0)])),_:1})}},[["__scopeId","data-v-baff60ee"]]),E=O({__name:"grades",setup(t){const u=w(!0),c=w([]),o=w(null),d=w(null),r=w(null),i=w(null),f=w(0),_=w([]),p=w(!1),m=w([]),g=w(!1),y=w(null),C=w(new Set),b=w(!1),M=v((()=>0===c.value.length));v((()=>`å·²é€‰ ${m.value.length} / ${_.value.length} é—¨`)),v((()=>g.value||0===m.value.length)),j((()=>{N(),setTimeout((()=>{(c.value.length>0||!u.value)&&(b.value=!0)}),500)})),$((()=>{G("token")||(x({title:"è¯·å…ˆç™»å½•",icon:"none"}),P({url:"/pages/index/index"}))}));const N=()=>{(G("token")||(x({title:"è¯·å…ˆç™»å½•",icon:"none"}),P({url:"/pages/index/index"}),0))&&O()},O=async()=>{u.value=!0;try{const e=await(async()=>{const e=`${k().globalData.apiBaseURL}/api/v1/grades`;try{const{statusCode:a,data:l}=await h({url:e,method:"GET",header:{Authorization:"Bearer "+G("token")}});return 200===a&&l.success?{success:!0,data:{allCourses:l.data||[],gpaAnalysis:l.basic_gpa,semesterGpa:l.semester_gpa,yearlyGpa:l.yearly_gpa,effectiveGpa:l.effective_gpa}}:401===a?(A("token"),x({title:"ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•",icon:"none"}),setTimeout((()=>P({url:"/pages/index/index"})),1500),{success:!1,error:"ç™»å½•å·²è¿‡æœŸ"}):(x({title:l.detail||"èŽ·å–æˆç»©å¤±è´¥",icon:"none"}),{success:!1,error:l.detail||"èŽ·å–æˆç»©å¤±è´¥"})}catch(a){return console.error("è¯·æ±‚å¤±è´¥",a),x({title:"æœåŠ¡å™¨è¿žæŽ¥å¤±è´¥",icon:"none"}),{success:!1,error:"æœåŠ¡å™¨è¿žæŽ¥å¤±è´¥"}}})();e.success&&(_.value=e.data.allCourses,c.value=(e=>{if(!e||0===e.length)return[];const a=e.reduce(((e,a)=>((e[a.semester]=e[a.semester]||[]).push(a),e)),{});return Object.keys(a).map((e=>({semesterName:e,grades:a[e]}))).sort(((e,a)=>a.semesterName.localeCompare(e.semesterName)))})(_.value),o.value=e.data.gpaAnalysis,d.value=e.data.semesterGpa,r.value=e.data.yearlyGpa,i.value=e.data.effectiveGpa,f.value=_.value.length)}finally{u.value=!1}},E=e=>{var a;p.value?q(e.index):(a=e.index,C.value.has(a)?C.value.delete(a):C.value.add(a))},D=()=>{b.value=!1},U=e=>{p.value=e.detail.value,p.value||(K(),Z())},q=e=>{const a=m.value.indexOf(e);a>-1?m.value.splice(a,1):m.value.push(e),Z()},H=()=>{m.value=_.value.map((e=>e.index)),Z()},K=()=>{m.value=[],Z()},Z=()=>{y.value=null},J=async()=>{if(0!==m.value.length){g.value=!0;try{const e=await(async e=>{const a=`${k().globalData.apiBaseURL}/api/v1/gpa/calculate`,l={include_indices:e.map(String),remove_retakes:!0};try{const{statusCode:e,data:s}=await h({url:a,method:"POST",header:{Authorization:"Bearer "+G("token"),"Content-Type":"application/json"},data:l});return 200===e&&s.success?(x({title:"GPAè®¡ç®—å®Œæˆ",icon:"success"}),{success:!0,data:s.data}):(x({title:s.detail||"GPAè®¡ç®—å¤±è´¥",icon:"none"}),{success:!1,error:s.detail||"GPAè®¡ç®—å¤±è´¥"})}catch(s){return console.error("GPAè®¡ç®—è¯·æ±‚å¤±è´¥",s),x({title:"ç½‘ç»œè¿žæŽ¥å¤±è´¥",icon:"none"}),{success:!1,error:"ç½‘ç»œè¿žæŽ¥å¤±è´¥"}}})(m.value);e.success&&(y.value=e.data)}finally{g.value=!1}}else x({title:"è¯·è‡³å°‘é€‰æ‹©ä¸€é—¨è¯¾ç¨‹",icon:"none"})};return(t,v)=>{const k=n;return e(),a(R,null,{default:l((()=>[u.value?(e(),a(S,{key:0,text:"æ­£åœ¨ä»Žæ•™åŠ¡ç³»ç»ŸåŒæ­¥æˆç»©..."})):(e(),a(k,{key:1,class:"page-container page-rounded-container"},{default:l((()=>[s(k,{class:"background-decoration"},{default:l((()=>[s(k,{class:"circle circle-1"}),s(k,{class:"circle circle-2"}),s(k,{class:"circle circle-3"})])),_:1}),s(k,{class:"content-wrapper"},{default:l((()=>[M.value?(e(),a(F,{key:0,"icon-type":"info-filled",title:"æ²¡æœ‰æŸ¥è¯¢åˆ°ä»»ä½•æˆç»©è®°å½•",description:"è¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥æˆ–ç¨åŽé‡è¯•","show-retry":!0,onRetry:O})):(e(),a(k,{key:1},{default:l((()=>[s(T,{gpaAnalysis:o.value,effectiveGpa:i.value,totalCourses:f.value,yearlyGpa:r.value,semesterGpa:d.value},null,8,["gpaAnalysis","effectiveGpa","totalCourses","yearlyGpa","semesterGpa"]),s(B,{isCustomMode:p.value,onToggle:U},null,8,["isCustomMode"]),s(I,{semesters:c.value,isCustomMode:p.value,selectedCourses:m.value,expandedCourses:C.value,onCourseClick:E},null,8,["semesters","isCustomMode","selectedCourses","expandedCourses"])])),_:1}))])),_:1})])),_:1})),s(L,{isCustomMode:p.value,customGPAResult:y.value,selectedCourses:m.value,allCourses:_.value,isCalculating:g.value,onClearResult:Z,onSelectAll:H,onClearSelection:K,onCalculate:J},null,8,["isCustomMode","customGPAResult","selectedCourses","allCourses","isCalculating"]),s(z,{showModal:b.value,onClose:D},null,8,["showModal"])])),_:1})}}},[["__scopeId","data-v-70ffa43e"]]);export{E as default};

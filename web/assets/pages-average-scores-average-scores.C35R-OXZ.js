import{$ as e,B as a,W as t,f as s,r as l,o as r,c,w as n,a as o,b as u,h as i,t as d,k as f,d as p,i as m,I as h,A as _,m as y,F as g,N as v,Y as b,D as k,E as C,u as T,H as F,G as z,M as B,a0 as x}from"./index-CjNX0skN.js";import{_ as S,r as $,a as j}from"./uni-icons._DaO0o29.js";const E=S({props:{loading:{type:Boolean,default:!1}},emits:["search","reset"],setup(l,{emit:r}){const c=e({course:"",teacher:""}),n=a(!1),o=a(!1),u=a(!1),i=a(!1),d=t((()=>{const e=c.course.trim().length;return 0===e?"请输入课程名称或代码":e<3?`至少需要3个字符，当前${e}个字符`:`已输入${e}个字符`})),f=t((()=>{const e=c.teacher.trim().length;return 0===e?"":e<2?`至少需要2个字符，当前${e}个字符`:`已输入${e}个字符`})),p=t((()=>{const e=c.course.trim().length,a=c.teacher.trim().length;return e>=3&&(0===a||a>=2)}));return{form:c,courseError:n,teacherError:o,courseFocused:u,teacherFocused:i,courseHint:d,teacherHint:f,canSearch:p,onCourseFocus:function(){u.value=!0},onCourseBlur:function(){u.value=!1},onTeacherFocus:function(){i.value=!0},onTeacherBlur:function(){i.value=!1},validateCourse:function(){const e=c.course.trim().length;n.value=e>0&&e<3},validateTeacher:function(){const e=c.teacher.trim().length;o.value=e>0&&e<2},handleSearch:function(){if(!c.course.trim())return void s({title:"请输入课程名称或代码",icon:"none"});if(c.course.trim().length<3)return void s({title:"课程名称至少需要3个字符",icon:"none"});if(c.teacher.trim()&&c.teacher.trim().length<2)return void s({title:"教师姓名至少需要2个字符",icon:"none"});const e={course:c.course.trim()};c.teacher.trim()&&(e.teacher=c.teacher.trim()),r("search",e)},handleReset:function(){c.course="",c.teacher="",n.value=!1,o.value=!1,r("reset")}}}},[["render",function(e,a,t,s,y,g){const v=$(l("uni-icons"),j),b=p,k=m,C=h,T=_;return r(),c(b,{class:"search-card modern-card"},{default:n((()=>[o(b,{class:"card-header"},{default:n((()=>[o(b,{class:"header-icon"},{default:n((()=>[o(v,{type:"search",size:"24",color:"#7f4515"})])),_:1}),o(b,{class:"header-text"},{default:n((()=>[o(k,{class:"card-title"},{default:n((()=>[u("课程信息查询")])),_:1}),o(k,{class:"card-subtitle"},{default:n((()=>[u("输入课程信息开始查询")])),_:1})])),_:1})])),_:1}),o(b,{class:"form-content"},{default:n((()=>[o(b,{class:"form-group"},{default:n((()=>[o(b,{class:"input-label"},{default:n((()=>[o(v,{type:"book",size:"20",color:"#495057"}),o(k,null,{default:n((()=>[u("课程名称/代码")])),_:1})])),_:1}),o(b,{class:"input-wrapper"},{default:n((()=>[o(C,{class:i(["modern-input",{"input-error":e.courseError,"input-focus":e.courseFocused}]),modelValue:e.form.course,"onUpdate:modelValue":a[0]||(a[0]=a=>e.form.course=a),placeholder:"请输入课程名称或课程代码（至少3个字符）",onConfirm:e.handleSearch,onInput:e.validateCourse,onFocus:e.onCourseFocus,onBlur:e.onCourseBlur},null,8,["class","modelValue","onConfirm","onInput","onFocus","onBlur"]),o(b,{class:i(["input-line",{active:e.courseFocused}])},null,8,["class"])])),_:1}),o(k,{class:i(["input-hint",{"hint-error":e.courseError}])},{default:n((()=>[u(d(e.courseHint),1)])),_:1},8,["class"])])),_:1}),o(b,{class:"form-group"},{default:n((()=>[o(b,{class:"input-label"},{default:n((()=>[o(v,{type:"person",size:"20",color:"#495057"}),o(k,null,{default:n((()=>[u("教师姓名（选填）")])),_:1})])),_:1}),o(b,{class:"input-wrapper"},{default:n((()=>[o(C,{class:i(["modern-input",{"input-error":e.teacherError,"input-focus":e.teacherFocused}]),modelValue:e.form.teacher,"onUpdate:modelValue":a[1]||(a[1]=a=>e.form.teacher=a),placeholder:"不填则查询所有老师（至少2个字符）",onConfirm:e.handleSearch,onInput:e.validateTeacher,onFocus:e.onTeacherFocus,onBlur:e.onTeacherBlur},null,8,["class","modelValue","onConfirm","onInput","onFocus","onBlur"]),o(b,{class:i(["input-line",{active:e.teacherFocused}])},null,8,["class"])])),_:1}),e.form.teacher.trim()?(r(),c(k,{key:0,class:i(["input-hint",{"hint-error":e.teacherError}])},{default:n((()=>[u(d(e.teacherHint),1)])),_:1},8,["class"])):f("",!0)])),_:1}),o(b,{class:"button-group"},{default:n((()=>[o(T,{class:"action-btn primary-btn",onClick:e.handleSearch,loading:e.loading,disabled:!e.canSearch},{default:n((()=>[e.loading?f("",!0):(r(),c(v,{key:0,type:"search",size:"20",color:"#ffffff"})),o(k,null,{default:n((()=>[u(d(e.loading?"查询中...":"开始查询"),1)])),_:1})])),_:1},8,["onClick","loading","disabled"]),o(T,{class:"action-btn secondary-btn",onClick:e.handleReset},{default:n((()=>[o(v,{type:"refresh",size:"20",color:"#495057"}),o(k,null,{default:n((()=>[u("重置")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-9b5e6eda"]]);function H(e){return e?e.replace("T"," ").split(".")[0]:""}const I=S({components:{CourseCard:S({props:{courseName:{type:String,required:!0},teachers:{type:Object,required:!0}},setup:()=>({formatTime:H})},[["render",function(e,a,t,s,i,h){const _=$(l("uni-icons"),j),b=p,k=m;return r(),c(b,{class:"course-card modern-card"},{default:n((()=>[o(b,{class:"course-header"},{default:n((()=>[o(b,{class:"course-info"},{default:n((()=>[o(b,{class:"course-icon"},{default:n((()=>[o(_,{type:"book",size:"20",color:"#7f4515"})])),_:1}),o(k,{class:"course-name"},{default:n((()=>[u(d(e.courseName),1)])),_:1})])),_:1})])),_:1}),o(b,{class:"course-content"},{default:n((()=>[(r(!0),y(g,null,v(Object.keys(e.teachers),((a,t)=>(r(),c(b,{class:"teacher-section",key:a},{default:n((()=>[o(b,{class:"teacher-header"},{default:n((()=>[o(b,{class:"teacher-info"},{default:n((()=>[o(b,{class:"teacher-avatar"},{default:n((()=>[o(_,{type:"person",size:"16",color:"#7f4515"})])),_:1}),o(k,{class:"teacher-name"},{default:n((()=>[u(d(a),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),o(b,{class:"semester-list"},{default:n((()=>[(r(!0),y(g,null,v(e.teachers[a],((a,t)=>(r(),c(b,{class:"semester-item",key:t},{default:n((()=>[o(b,{class:"semester-info"},{default:n((()=>[o(k,{class:"semester-name"},{default:n((()=>[u(d(t),1)])),_:2},1024),a.update_time?(r(),c(k,{key:0,class:"update-time"},{default:n((()=>[u(d(e.formatTime(a.update_time)),1)])),_:2},1024)):f("",!0)])),_:2},1024),o(b,{class:"score-info"},{default:n((()=>[o(b,{class:"score-item"},{default:n((()=>[o(k,{class:"score-label"},{default:n((()=>[u("平均分")])),_:1}),o(k,{class:"score-value primary"},{default:n((()=>[u(d(a.average_score.toFixed(2)),1)])),_:2},1024)])),_:2},1024),o(b,{class:"score-item"},{default:n((()=>[o(k,{class:"score-label"},{default:n((()=>[u("人数")])),_:1}),o(k,{class:"score-value secondary"},{default:n((()=>[u(d(a.student_count),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})}],["__scopeId","data-v-846ad68e"]])},props:{resultData:{type:Object,default:()=>({})}},setup:e=>({hasResults:t((()=>Object.keys(e.resultData).length>0))})},[["render",function(e,a,t,s,l,i){const h=m,_=p,k=b("CourseCard");return e.hasResults?(r(),c(_,{key:0,class:"results-section"},{default:n((()=>[o(_,{class:"results-header"},{default:n((()=>[o(_,{class:"results-info"},{default:n((()=>[o(h,{class:"results-title"},{default:n((()=>[u("查询结果")])),_:1}),o(h,{class:"results-count"},{default:n((()=>[u(" 共找到 "+d(Object.keys(e.resultData).length)+" 门课程 ",1)])),_:1})])),_:1})])),_:1}),(r(!0),y(g,null,v(e.resultData,((e,a)=>(r(),c(k,{key:a,"course-name":a,teachers:e},null,8,["course-name","teachers"])))),128))])),_:1})):f("",!0)}],["__scopeId","data-v-67a194f3"]]);const w=S({props:{type:{type:String,required:!0,validator:e=>["empty","initial","loading"].includes(e)},message:{type:String,default:"未找到相关数据"}},emits:["retry"]},[["render",function(e,a,t,s,i,h){const y=$(l("uni-icons"),j),g=p,v=m,b=_;return"empty"===e.type?(r(),c(g,{key:0,class:"empty-state modern-card"},{default:n((()=>[o(g,{class:"empty-content"},{default:n((()=>[o(g,{class:"empty-icon"},{default:n((()=>[o(y,{type:"info",size:"80",color:"#adb5bd"})])),_:1}),o(v,{class:"empty-title"},{default:n((()=>[u("未找到相关数据")])),_:1}),o(v,{class:"empty-subtitle"},{default:n((()=>[u(d(e.message),1)])),_:1}),o(b,{class:"action-btn primary-btn retry-btn",onClick:a[0]||(a[0]=a=>e.$emit("retry"))},{default:n((()=>[o(y,{type:"refresh",size:"20",color:"#ffffff"}),o(v,null,{default:n((()=>[u("重新搜索")])),_:1})])),_:1})])),_:1})])),_:1})):"initial"===e.type?(r(),c(g,{key:1,class:"initial-state modern-card"},{default:n((()=>[o(g,{class:"initial-content"},{default:n((()=>[o(g,{class:"initial-icon"},{default:n((()=>[o(y,{type:"search",size:"80",color:"#7f4515"})])),_:1}),o(v,{class:"initial-title"},{default:n((()=>[u("欢迎使用平均分查询")])),_:1}),o(v,{class:"initial-subtitle"},{default:n((()=>[u("请输入课程信息开始查询学术数据")])),_:1})])),_:1})])),_:1})):"loading"===e.type?(r(),c(g,{key:2,class:"loading-state modern-card"},{default:n((()=>[o(g,{class:"loading-content"},{default:n((()=>[o(g,{class:"loading-spinner"},{default:n((()=>[o(y,{type:"spinner-cycle",size:"60",color:"#7f4515"})])),_:1}),o(v,{class:"loading-text"},{default:n((()=>[u("正在查询数据...")])),_:1})])),_:1})])),_:1})):f("",!0)}],["__scopeId","data-v-9590b537"]]);function P(){return!!k("token")||(s({title:"请先登录",icon:"none"}),C({url:"/pages/index/index"}),!1)}const R=S({__name:"average-scores",setup(e){const l=a({}),i=a(!1),d=a(!1),h=a("未找到相关数据"),_=t((()=>Object.keys(l.value).length>0));async function y(e){if(P()){i.value=!0,d.value=!0;try{const a=await function(e){const a=T().globalData.apiBaseURL,t=k("token");return t?new Promise(((l,r)=>{F({url:`${a}/api/v1/average-scores`,method:"GET",data:e,header:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},success:e=>{var a;if(401===e.statusCode)return z("token"),s({title:"登录已过期，请重新登录",icon:"none"}),void setTimeout((()=>{C({url:"/pages/index/index"})}),1500);200===e.statusCode?l(e.data):r(new Error(`HTTP ${e.statusCode}: ${(null==(a=e.data)?void 0:a.message)||"请求失败"}`))},fail:e=>r(e)})})):(s({title:"请先登录",icon:"none"}),C({url:"/pages/index/index"}),Promise.reject(new Error("未登录")))}(e);200===a.code?(l.value=a.data,_.value||(h.value="未找到相关数据")):(l.value={},h.value=a.message||"查询失败",s({title:h.value,icon:"none"}))}catch(a){console.error("查询平均分失败:",a),l.value={};const e=function(e){let a="网络错误，请重试";return e.message&&(e.message.includes("HTTP 422")?a="输入参数格式错误，请检查输入内容":e.message.includes("HTTP 400")?a="请求参数错误，请检查输入内容":e.message.includes("HTTP 500")?a="服务器内部错误，请稍后重试":e.message.includes("HTTP")&&(a=`请求失败: ${e.message}`)),a}(a);h.value=e,s({title:e,icon:"none",duration:3e3})}finally{i.value=!1}}}function g(){l.value={},d.value=!1}return B((()=>{x({title:"平均分查询"}),P(),console.log("用户进入平均分查询页面")})),(e,a)=>{const t=p,s=m;return r(),c(t,{class:"page-container page-rounded-container"},{default:n((()=>[o(t,{class:"background-decoration"},{default:n((()=>[o(t,{class:"circle circle-1"}),o(t,{class:"circle circle-2"}),o(t,{class:"circle circle-3"})])),_:1}),o(t,{class:"page-header"},{default:n((()=>[o(t,{class:"header-content"},{default:n((()=>[o(s,{class:"page-title"},{default:n((()=>[u("平均分查询")])),_:1}),o(s,{class:"page-subtitle"},{default:n((()=>[u("Academic Score Analysis")])),_:1})])),_:1})])),_:1}),o(t,{class:"content-wrapper"},{default:n((()=>[o(E,{loading:i.value,onSearch:y,onReset:g},null,8,["loading"]),_.value?(r(),c(I,{key:0,"result-data":l.value},null,8,["result-data"])):d.value&&!i.value?(r(),c(w,{key:1,type:"empty",message:h.value,onRetry:g},null,8,["message"])):d.value||i.value?i.value?(r(),c(w,{key:3,type:"loading"})):f("",!0):(r(),c(w,{key:2,type:"initial"}))])),_:1})])),_:1})}}},[["__scopeId","data-v-aecc46df"]]);export{R as default};

import{B as e,W as a,C as t,r as s,o as l,c,w as u,a as n,b as o,t as r,m as d,F as i,N as f,h as p,k as _,Q as v,A as y,i as m,d as g,S as h,a3 as w,a2 as D,D as k,f as S,E as b,u as C,H as x,G as T,Z as I,_ as O}from"./index-B4YcBySC.js";import{_ as z,r as $,a as E,o as j,b as B}from"./uni-icons.DQmqa_Ab.js";import{P as M}from"./PageLayout.hJbtV9J8.js";import{L as q}from"./LoadingScreen.CJHFc961.js";import{_ as L}from"./uni-popup.B21v_65b.js";const A=z({__name:"DateNavigator",props:{selectedDate:{type:String,required:!0}},emits:["dateChange"],setup(D,{emit:k}){const S=D,b=k,C=e(7),x=e([]),T=e(null),I=a((()=>0===x.value.length?{day:"",month:"",weekday:""}:x.value[C.value]||{day:"",month:"",weekday:""})),O=a((()=>{const e=C.value,a=Math.max(0,e-5),t=Math.min(x.value.length,e+6);return x.value.slice(a,t)})),z=a((()=>{const e=C.value;return e-Math.max(0,e-5)})),j=a((()=>{const e=(new Date).toISOString().split("T")[0];return S.selectedDate===e}));function B(e=null){const a=[],t=e?new Date(e):new Date;for(let s=-7;s<=7;s++){const e=new Date(t);e.setDate(t.getDate()+s),a.push(M(e))}if(x.value=a,e){const a=x.value.findIndex((a=>a.date===e));-1!==a&&(C.value=a)}else C.value=7}function M(e){const a=e.toISOString().split("T")[0],t=(new Date).toISOString().split("T")[0];return{date:a,day:e.getDate().toString(),month:`${e.getMonth()+1}æœˆ`,weekday:`å‘¨${["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][e.getDay()]}`,isToday:a===t}}function q(e="forward",a=7){if("forward"===e){const e=new Date(x.value[x.value.length-1].date);for(let t=1;t<=a;t++){const a=new Date(e);a.setDate(e.getDate()+t),x.value.push(M(a))}}else{const e=new Date(x.value[0].date),t=[];for(let s=a;s>=1;s--){const a=new Date(e);a.setDate(e.getDate()-s),t.push(M(a))}x.value=[...t,...x.value],C.value+=a}}function L(){C.value>0?C.value--:(q("backward",7),C.value=6);const e=x.value[C.value];b("dateChange",e.date)}function A(){C.value<x.value.length-1||q("forward",7),C.value++;const e=x.value[C.value];b("dateChange",e.date)}function P(){G((new Date).toISOString().split("T")[0])}function G(e){const a=x.value.findIndex((a=>a.date===e));-1!==a?C.value=a:B(e),b("dateChange",e)}function N(){v((()=>{const e=T.value;e&&e.click()}))}function R(e){G(e.detail.value)}return t((()=>S.selectedDate),(e=>{const a=x.value.findIndex((a=>a.date===e));-1!==a?C.value=a:G(e)})),t(C,(e=>{e<=2?q("backward",7):e>=x.value.length-3&&q("forward",7)})),B(),(e,a)=>{const t=$(s("uni-icons"),E),v=y,k=m,S=g,B=h,M=w;return l(),c(S,{class:"date-navigator"},{default:u((()=>[n(S,{class:"date-header"},{default:u((()=>[n(v,{class:"nav-arrow nav-arrow--prev",onClick:L},{default:u((()=>[n(t,{type:"arrowleft",size:"24",color:"#7f4515"})])),_:1}),n(S,{class:"date-display",onClick:N},{default:u((()=>[n(S,{class:"date-main"},{default:u((()=>[n(k,{class:"current-day"},{default:u((()=>[o(r(I.value.day),1)])),_:1}),n(S,{class:"date-meta"},{default:u((()=>[n(k,{class:"current-month"},{default:u((()=>[o(r(I.value.month),1)])),_:1}),n(k,{class:"current-weekday"},{default:u((()=>[o(r(I.value.weekday),1)])),_:1})])),_:1})])),_:1}),n(t,{type:"calendar",size:"20",color:"#7f4515"})])),_:1}),n(v,{class:"nav-arrow nav-arrow--next",onClick:A},{default:u((()=>[n(t,{type:"arrowright",size:"24",color:"#7f4515"})])),_:1})])),_:1}),n(S,{class:"date-slider"},{default:u((()=>[n(B,{class:"date-scroll","scroll-x":"","scroll-into-view":"date-"+C.value,"scroll-with-animation":"",enhanced:"","show-scrollbar":!1},{default:u((()=>[n(S,{class:"date-list"},{default:u((()=>[(l(!0),d(i,null,f(O.value,((e,a)=>(l(),c(S,{key:e.date,id:"date-"+a,class:p(["date-option",{"date-option--active":a===z.value,"date-option--today":e.isToday}]),onClick:e=>function(e){const a=C.value,t=Math.max(0,a-5)+e;if(t>=0&&t<x.value.length){C.value=t;const e=x.value[t];b("dateChange",e.date)}}(a)},{default:u((()=>[n(k,{class:"option-day"},{default:u((()=>[o(r(e.day),1)])),_:2},1024),n(k,{class:"option-weekday"},{default:u((()=>[o(r(e.weekday.replace("å‘¨","")),1)])),_:2},1024)])),_:2},1032,["id","class","onClick"])))),128))])),_:1})])),_:1},8,["scroll-into-view"])])),_:1}),j.value?_("",!0):(l(),c(S,{key:0,class:"quick-actions"},{default:u((()=>[n(v,{class:"today-btn",onClick:P},{default:u((()=>[n(t,{type:"home",size:"16",color:"#fff"}),n(k,null,{default:u((()=>[o("ä»Šæ—¥")])),_:1})])),_:1})])),_:1})),n(M,{mode:"date",value:D.selectedDate,onChange:R,start:"2020-01-01",end:"2030-12-31"},{default:u((()=>[n(S,{class:"date-picker-trigger",ref_key:"datePickerTrigger",ref:T},null,512)])),_:1},8,["value"])])),_:1})}}},[["__scopeId","data-v-64edc256"]]),P=z({__name:"CourseCard",props:{course:{type:Object,default:null},isEmpty:{type:Boolean,default:!1}},setup(e){function a(e){switch(e){case"å¿…ä¿®":return"property-required";case"é€‰ä¿®":return"property-elective";case"å®è·µ":return"property-practice";default:return"property-default"}}return(t,d)=>{const i=m,f=g,v=$(s("uni-icons"),E);return l(),c(f,{class:p(["course-card",{"course-card--empty":e.isEmpty}])},{default:u((()=>[e.isEmpty?(l(),c(f,{key:1,class:"empty-content"},{default:u((()=>[n(i,{class:"empty-text"},{default:u((()=>[o("æ— è¯¾ç¨‹")])),_:1})])),_:1})):(l(),c(f,{key:0,class:"course-content"},{default:u((()=>[n(f,{class:"course-header"},{default:u((()=>[n(i,{class:"course-name"},{default:u((()=>[o(r(e.course.course_name),1)])),_:1}),n(i,{class:"course-credits"},{default:u((()=>[o(r(e.course.course_credits)+"å­¦åˆ†",1)])),_:1})])),_:1}),n(f,{class:"course-property"},{default:u((()=>[n(i,{class:p(["property-tag",a(e.course.course_property)])},{default:u((()=>[o(r(e.course.course_property),1)])),_:1},8,["class"])])),_:1}),n(f,{class:"course-time"},{default:u((()=>[n(v,{type:"clock",size:"16",color:"#7f4515"}),n(i,{class:"time-text"},{default:u((()=>[o(r(e.course.period)+"èŠ‚",1)])),_:1})])),_:1}),n(f,{class:"course-location"},{default:u((()=>[n(v,{type:"location",size:"16",color:"#7f4515"}),n(i,{class:"location-text"},{default:u((()=>[o(r(e.course.classroom),1)])),_:1})])),_:1}),e.course.class_name?(l(),c(f,{key:0,class:"course-class"},{default:u((()=>[n(i,{class:"class-text"},{default:u((()=>[o(r(e.course.class_name),1)])),_:1})])),_:1})):_("",!0)])),_:1}))])),_:1},8,["class"])}}},[["__scopeId","data-v-47c9a877"]]),G=z({__name:"ClassTableView",props:{courses:{type:Array,default:()=>[]},selectedDate:{type:String,required:!0}},setup(t){const p=t,v=e(null),h=e(null),w=a((()=>p.courses&&0!==p.courses.length?[...p.courses].sort(((e,a)=>{const t=e=>{const a=e.match(/(\d+)/);return a?parseInt(a[1]):0};return t(e.period)-t(a.period)})):[]));function D(e){if(!e)return"";const a=new Date(e),t=new Date,s=new Date(t);s.setDate(t.getDate()+1);const l=new Date(t);l.setDate(t.getDate()-1);const c=["å‘¨æ—¥","å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­"][a.getDay()];if(e===t.toISOString().split("T")[0])return`ä»Šå¤© ${c}`;if(e===s.toISOString().split("T")[0])return`æ˜å¤© ${c}`;if(e===l.toISOString().split("T")[0])return`æ˜¨å¤© ${c}`;return`${a.getMonth()+1}æœˆ${a.getDate()}æ—¥ ${c}`}function k(){var e;null==(e=v.value)||e.close(),h.value=null}return(e,a)=>{const p=m,S=g,b=$(s("uni-icons"),E),C=y,x=$(s("uni-popup"),L);return l(),c(S,{class:"classtable-view"},{default:u((()=>[t.courses&&t.courses.length>0?(l(),c(S,{key:0,class:"courses-container"},{default:u((()=>[n(S,{class:"date-header"},{default:u((()=>[n(p,{class:"date-title"},{default:u((()=>[o(r(D(t.selectedDate)),1)])),_:1}),n(p,{class:"course-count"},{default:u((()=>[o("å…± "+r(t.courses.length)+" èŠ‚è¯¾",1)])),_:1})])),_:1}),n(S,{class:"courses-list"},{default:u((()=>[(l(!0),d(i,null,f(w.value,((e,a)=>(l(),c(P,{key:a,course:e,onClick:a=>function(e){var a;h.value=e,null==(a=v.value)||a.open()}(e)},null,8,["course","onClick"])))),128))])),_:1})])),_:1})):(l(),c(S,{key:1,class:"empty-state"},{default:u((()=>[n(S,{class:"empty-icon"},{default:u((()=>[n(b,{type:"calendar",size:"80",color:"#e0e0e0"})])),_:1}),n(p,{class:"empty-title"},{default:u((()=>[o(r(D(t.selectedDate)),1)])),_:1}),n(p,{class:"empty-desc"},{default:u((()=>[o("ä»Šå¤©æ²¡æœ‰è¯¾ç¨‹å®‰æ’")])),_:1}),n(p,{class:"empty-tip"},{default:u((()=>[o("å¥½å¥½ä¼‘æ¯å§ ğŸ‰")])),_:1})])),_:1})),n(x,{ref_key:"courseDetailPopup",ref:v,type:"bottom","background-color":"#fff"},{default:u((()=>[h.value?(l(),c(S,{key:0,class:"course-detail-popup"},{default:u((()=>[n(S,{class:"popup-header"},{default:u((()=>[n(p,{class:"popup-title"},{default:u((()=>[o("è¯¾ç¨‹è¯¦æƒ…")])),_:1}),n(C,{class:"close-btn",onClick:k},{default:u((()=>[n(b,{type:"close",size:"24",color:"#666"})])),_:1})])),_:1}),n(S,{class:"popup-content"},{default:u((()=>[n(S,{class:"detail-item"},{default:u((()=>[n(p,{class:"detail-label"},{default:u((()=>[o("è¯¾ç¨‹åç§°")])),_:1}),n(p,{class:"detail-value"},{default:u((()=>[o(r(h.value.course_name),1)])),_:1})])),_:1}),n(S,{class:"detail-item"},{default:u((()=>[n(p,{class:"detail-label"},{default:u((()=>[o("å­¦åˆ†")])),_:1}),n(p,{class:"detail-value"},{default:u((()=>[o(r(h.value.course_credits)+"å­¦åˆ†",1)])),_:1})])),_:1}),n(S,{class:"detail-item"},{default:u((()=>[n(p,{class:"detail-label"},{default:u((()=>[o("è¯¾ç¨‹å±æ€§")])),_:1}),n(p,{class:"detail-value"},{default:u((()=>[o(r(h.value.course_property),1)])),_:1})])),_:1}),n(S,{class:"detail-item"},{default:u((()=>[n(p,{class:"detail-label"},{default:u((()=>[o("ä¸Šè¯¾æ—¶é—´")])),_:1}),n(p,{class:"detail-value"},{default:u((()=>[o(r(h.value.class_time),1)])),_:1})])),_:1}),n(S,{class:"detail-item"},{default:u((()=>[n(p,{class:"detail-label"},{default:u((()=>[o("æ•™å®¤")])),_:1}),n(p,{class:"detail-value"},{default:u((()=>[o(r(h.value.classroom),1)])),_:1})])),_:1}),h.value.class_name?(l(),c(S,{key:0,class:"detail-item"},{default:u((()=>[n(p,{class:"detail-label"},{default:u((()=>[o("ç­çº§")])),_:1}),n(p,{class:"detail-value"},{default:u((()=>[o(r(h.value.class_name),1)])),_:1})])),_:1})):_("",!0)])),_:1})])),_:1})):_("",!0)])),_:1},512)])),_:1})}}},[["__scopeId","data-v-ed0d251a"]]),N=z({__name:"classtable",setup(t){const s=e(!0),r=e((new Date).toISOString().split("T")[0]),d=e({}),i=a((()=>d.value[r.value]||[]));function f(){return!!k("token")||(S({title:"è¯·å…ˆç™»å½•",icon:"none"}),b({url:"/pages/index/index"}),!1)}async function p(e){r.value=e,d.value[e]||await _(e),setTimeout((()=>{v(e)}),500)}async function _(e){const a=y(e);if(h.has(a))return;const t=k("token"),s=C().globalData.apiBaseURL;try{h.add(a),I({title:"åŠ è½½ä¸­..."});const{statusCode:l,data:c}=await x({url:`${s}/api/v1/classtable/week`,method:"GET",header:{Authorization:"Bearer "+t},data:{query_date:e}});200===l&&c.success?c.data&&c.data.days&&(c.data.days.forEach((e=>{d.value[e.date]=e.courses||[]})),w.add(a)):401===l?z():S({title:c.detail||c.message||"è·å–è¯¾ç¨‹è¡¨å¤±è´¥",icon:"none"})}catch(l){console.error("è·å–è¯¾ç¨‹å¤±è´¥",l),S({title:"ç½‘ç»œè¿æ¥å¤±è´¥",icon:"none"})}finally{O(),h.delete(a)}}async function v(e){const a=[],t=new Date(e);for(let l=-3;l<=3;l++){const e=new Date(t);e.setDate(t.getDate()+l);const s=e.toISOString().split("T")[0],c=y(s);w.has(c)||d.value[s]||a.push(s)}const s=[...new Set(a.map((e=>y(e))))];for(const l of s){const e=a.find((e=>y(e)===l));e&&await _(e)}}function y(e){const a=new Date(e),t=new Date(a),s=a.getDay(),l=a.getDate()-s+(0===s?-6:1);return t.setDate(l),t.toISOString().split("T")[0]}j((()=>{f()&&(D({title:"è¯¾ç¨‹è¡¨"}),async function(){s.value=!0;const e=k("token"),a=C().globalData.apiBaseURL;try{const{statusCode:t,data:l}=await x({url:`${a}/api/v1/classtable/today`,method:"GET",header:{Authorization:"Bearer "+e}});if(200===t&&l.success){const e=l.data.date;d.value[e]=l.data.courses||[],r.value=e,w.add(y(e)),setTimeout((()=>{v(e)}),1e3)}else 401===t?z():S({title:l.detail||l.message||"è·å–è¯¾ç¨‹è¡¨å¤±è´¥",icon:"none"})}catch(t){console.error("è·å–ä»Šæ—¥è¯¾ç¨‹å¤±è´¥",t),S({title:"ç½‘ç»œè¿æ¥å¤±è´¥",icon:"none"})}finally{s.value=!1}}())})),B((()=>{f()}));const h=new Set,w=new Set;function z(){T("token"),S({title:"ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•",icon:"none"}),setTimeout((()=>b({url:"/pages/index/index"})),1500)}return(e,a)=>{const t=g,d=m;return l(),c(M,null,{default:u((()=>[s.value?(l(),c(q,{key:0,text:"æ­£åœ¨åŠ è½½è¯¾è¡¨æ•°æ®..."})):(l(),c(t,{key:1,class:"page-container page-rounded-container"},{default:u((()=>[n(t,{class:"background-decoration"},{default:u((()=>[n(t,{class:"circle circle-1"}),n(t,{class:"circle circle-2"}),n(t,{class:"circle circle-3"})])),_:1}),n(t,{class:"page-header"},{default:u((()=>[n(t,{class:"header-content"},{default:u((()=>[n(d,{class:"page-title"},{default:u((()=>[o("è¯¾ç¨‹è¡¨")])),_:1}),n(d,{class:"page-subtitle"},{default:u((()=>[o("Class Schedule")])),_:1})])),_:1})])),_:1}),n(t,{class:"content-wrapper"},{default:u((()=>[n(A,{"selected-date":r.value,onDateChange:p},null,8,["selected-date"]),n(G,{courses:i.value,"selected-date":r.value},null,8,["courses","selected-date"])])),_:1})])),_:1}))])),_:1})}}},[["__scopeId","data-v-96d461eb"]]);export{N as default};

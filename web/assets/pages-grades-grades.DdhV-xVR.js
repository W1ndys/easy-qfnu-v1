import{p as e,q as a,s as l,u as s,A as t,l as u,v as c,r as d,c as i,w as o,o as n,a as r,j as f,t as _,f as v,R as m,F as g,d as p,Y as k,Z as y,g as h,k as b,_ as x,K as A,n as P,M as C,N as w}from"./index-Bbpz7pwA.js";import{o as G,a as N,r as j,_ as F}from"./uni-app.es.C9D5hcIt.js";import{P as T}from"./PageLayout.mGC888cf.js";import{L as O,E as S}from"./EmptyState.D8fY7xgH.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";const L=B({__name:"grades",setup(B){const L=e(!0),R=e([]),z=e(null),E=e(null),D=e(null),M=e(null),U=e(0),$=e([]),q=e(!1),H=e([]),I=e(!1),K=e(null),Y=e(new Set);G((()=>Z())),N((()=>{a("token")||(l({title:"è¯·å…ˆç™»å½•",icon:"none"}),s({url:"/pages/index/index"}))}));const Z=()=>{if(!a("token"))return l({title:"è¯·å…ˆç™»å½•",icon:"none"}),void s({url:"/pages/index/index"});J()},J=async()=>{var e;L.value=!0;try{const{statusCode:d,data:i}=await t({url:`${u().globalData.apiBaseURL}/api/v1/grades`,method:"GET",header:{Authorization:"Bearer "+a("token")}});200===d&&i.success?($.value=i.data||[],R.value=Q($.value),z.value=null==(e=i.gpa_analysis)?void 0:e.basic_gpa,E.value=i.semester_gpa,D.value=i.yearly_gpa,M.value=i.effective_gpa,U.value=i.total_courses):401===d?(c("token"),l({title:"ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•",icon:"none"}),setTimeout((()=>s({url:"/pages/index/index"})),1500)):l({title:i.detail||"èŽ·å–æˆç»©å¤±è´¥",icon:"none"})}catch(d){console.error("è¯·æ±‚å¤±è´¥",d),l({title:"æœåŠ¡å™¨è¿žæŽ¥å¤±è´¥",icon:"none"})}finally{L.value=!1}},Q=e=>{if(!e||0===e.length)return[];const a=e.reduce(((e,a)=>((e[a.semester]=e[a.semester]||[]).push(a),e)),{});return Object.keys(a).map((e=>({semesterName:e,grades:a[e]}))).sort(((e,a)=>a.semesterName.localeCompare(e.semesterName)))},V=e=>H.value.includes(e),W=e=>Y.value.has(e),X=e=>{var a;q.value?le(e.index):(a=e.index,Y.value.has(a)?Y.value.delete(a):Y.value.add(a))},ee=e=>{const a=parseFloat(e);return isNaN(a)?"score-text-grade":a>=90?"score-high":a>=75?"score-mid":a>=60?"score-low":"score-fail"},ae=e=>{q.value=e.detail.value,q.value||(te(),ue())},le=e=>{const a=H.value.indexOf(e);a>-1?H.value.splice(a,1):H.value.push(e),ue()},se=()=>{H.value=$.value.map((e=>e.index)),ue()},te=()=>{H.value=[],ue()},ue=()=>{K.value=null},ce=async()=>{if(0===H.value.length)return void l({title:"è¯·è‡³å°‘é€‰æ‹©ä¸€é—¨è¯¾ç¨‹",icon:"none"});I.value=!0;const e={include_indices:H.value,remove_retakes:!0};try{const{statusCode:s,data:c}=await t({url:`${u().globalData.apiBaseURL}/api/v1/gpa/calculate`,method:"POST",header:{Authorization:"Bearer "+a("token"),"Content-Type":"application/json"},data:e});200===s&&c.success?(K.value=c.data,l({title:"GPAè®¡ç®—å®Œæˆ",icon:"success"})):l({title:c.detail||"GPAè®¡ç®—å¤±è´¥",icon:"none"})}catch(s){console.error("GPAè®¡ç®—è¯·æ±‚å¤±è´¥",s),l({title:"ç½‘ç»œè¿žæŽ¥å¤±è´¥",icon:"none"})}finally{I.value=!1}},de=e(!1);G((()=>{Z(),setTimeout((()=>{de.value=!0}),500)}));const ie=()=>{de.value=!1};return(e,a)=>{const l=h,s=b,t=x,u=j(d("uni-icons"),F),c=A;return n(),i(T,null,{default:o((()=>[L.value?(n(),i(O,{key:0,text:"æ­£åœ¨ä»Žæ•™åŠ¡ç³»ç»ŸåŒæ­¥æˆç»©..."})):(n(),i(l,{key:1,class:"page-container page-rounded-container"},{default:o((()=>[r(l,{class:"background-decoration"},{default:o((()=>[r(l,{class:"circle circle-1"}),r(l,{class:"circle circle-2"}),r(l,{class:"circle circle-3"})])),_:1}),r(l,{class:"content-wrapper"},{default:o((()=>[0===R.value.length?(n(),i(S,{key:0,"icon-type":"info-filled",title:"æ²¡æœ‰æŸ¥è¯¢åˆ°ä»»ä½•æˆç»©è®°å½•",description:"è¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥æˆ–ç¨åŽé‡è¯•","show-retry":!0,onRetry:J})):(n(),i(l,{key:1},{default:o((()=>[z.value?(n(),i(l,{key:0,class:"analysis-container"},{default:o((()=>[r(l,{class:"main-gpa-section"},{default:o((()=>[r(l,{class:"gpa-item"},{default:o((()=>[r(s,{class:"gpa-value"},{default:o((()=>{var e,a;return[f(_((null==(a=null==(e=z.value)?void 0:e.weighted_gpa)?void 0:a.toFixed(2))||"N/A"),1)]})),_:1}),r(s,{class:"gpa-label"},{default:o((()=>[f("æ€»åŠ æƒå¹³å‡GPA")])),_:1})])),_:1}),r(l,{class:"gpa-item"},{default:o((()=>[r(s,{class:"gpa-value"},{default:o((()=>{var e,a;return[f(_((null==(a=null==(e=M.value)?void 0:e.weighted_gpa)?void 0:a.toFixed(2))||"N/A"),1)]})),_:1}),r(s,{class:"gpa-label"},{default:o((()=>[f("æœ‰æ•ˆGPA (åŽ»é‡ä¿®)")])),_:1})])),_:1}),r(l,{class:"gpa-item"},{default:o((()=>[r(s,{class:"gpa-value"},{default:o((()=>[f(_(U.value||0),1)])),_:1}),r(s,{class:"gpa-label"},{default:o((()=>[f("æ€»è¯¾ç¨‹æ•°")])),_:1})])),_:1})])),_:1}),r(l,{class:"detailed-gpa-section"},{default:o((()=>[r(l,{class:"section-header"},{default:o((()=>[r(s,{class:"section-title"},{default:o((()=>[f("è¯¦ç»†GPAåˆ†å¸ƒ")])),_:1})])),_:1}),r(l,{class:"details-flex-container"},{default:o((()=>[D.value&&Object.keys(D.value).length>0?(n(!0),v(g,{key:0},m(D.value,((e,a)=>(n(),i(l,{key:a,class:"detail-item-flex"},{default:o((()=>[r(s,{class:"detail-label"},{default:o((()=>[f(_(a)+"å­¦å¹´",1)])),_:2},1024),r(s,{class:"detail-sub-info"},{default:o((()=>[f(_(e.course_count)+"é—¨ / "+_(e.total_credit.toFixed(1))+"å­¦åˆ†",1)])),_:2},1024),r(s,{class:"detail-value"},{default:o((()=>[f(_(e.weighted_gpa.toFixed(2)),1)])),_:2},1024)])),_:2},1024)))),128)):p("",!0),E.value&&Object.keys(E.value).length>0?(n(!0),v(g,{key:1},m(E.value,((e,a)=>(n(),i(l,{key:a,class:"detail-item-flex"},{default:o((()=>[r(s,{class:"detail-label"},{default:o((()=>[f(_(a),1)])),_:2},1024),r(s,{class:"detail-sub-info"},{default:o((()=>[f(_(e.course_count)+"é—¨ / "+_(e.total_credit.toFixed(1))+"å­¦åˆ†",1)])),_:2},1024),r(s,{class:"detail-value"},{default:o((()=>[f(_(e.weighted_gpa.toFixed(2)),1)])),_:2},1024)])),_:2},1024)))),128)):p("",!0)])),_:1})])),_:1})])),_:1})):p("",!0),r(l,{class:"custom-gpa-toggle-section"},{default:o((()=>[r(l,{class:"toggle-left"},{default:o((()=>[r(s,{class:"toggle-title"},{default:o((()=>[f("è‡ªå®šä¹‰GPAè®¡ç®—")])),_:1}),r(s,{class:"toggle-desc"},{default:o((()=>[f("å‹¾é€‰è¯¾ç¨‹ä»¥è®¡ç®—ç‰¹å®šGPA")])),_:1})])),_:1}),r(t,{checked:q.value,onChange:ae,color:"#7F4515"},null,8,["checked"])])),_:1}),q.value?(n(),i(l,{key:1,class:"custom-mode-tip"},{default:o((()=>[r(l,{class:"tip-icon"},{default:o((()=>[f("ðŸ’¡")])),_:1}),r(s,{class:"tip-text"},{default:o((()=>[f("è¯·å‹¾é€‰ **éœ€è¦è®¡å…¥** GPAçš„è¯¾ç¨‹")])),_:1})])),_:1})):p("",!0),r(l,{class:"grades-list-container"},{default:o((()=>[(n(!0),v(g,null,m(R.value,(e=>(n(),i(l,{key:e.semesterName,class:"semester-block"},{default:o((()=>[r(l,{class:"semester-header"},{default:o((()=>[r(s,{class:"semester-name"},{default:o((()=>[f(_(e.semesterName),1)])),_:2},1024)])),_:2},1024),r(l,{class:"courses-list"},{default:o((()=>[(n(!0),v(g,null,m(e.grades,(e=>(n(),i(l,{key:e.index,class:P(["course-card",{"is-custom-mode":q.value,"is-selected":V(e.index)}])},{default:o((()=>[r(l,{class:"course-main",onClick:a=>X(e)},{default:o((()=>[q.value?(n(),i(l,{key:0,class:"course-checkbox-wrapper"},{default:o((()=>[r(l,{class:P(["checkbox-inner",{checked:V(e.index)}])},null,8,["class"])])),_:2},1024)):p("",!0),r(l,{class:"course-core-info"},{default:o((()=>[r(s,{class:"course-name"},{default:o((()=>[f(_(e.courseName),1)])),_:2},1024),r(l,{class:"course-meta"},{default:o((()=>[r(l,{class:"meta-tag credit"},{default:o((()=>[f("å­¦åˆ†: "+_(e.credit),1)])),_:2},1024),r(l,{class:"meta-tag gpa"},{default:o((()=>[f("ç»©ç‚¹: "+_(e.gpa),1)])),_:2},1024),e.courseAttribute?(n(),i(l,{key:0,class:"meta-tag attribute"},{default:o((()=>[f(_(e.courseAttribute),1)])),_:2},1024)):p("",!0)])),_:2},1024)])),_:2},1024),r(l,{class:"course-side"},{default:o((()=>[r(l,{class:"course-score"},{default:o((()=>[r(s,{class:P(["score-text",ee(e.score)])},{default:o((()=>[f(_(e.score),1)])),_:2},1032,["class"]),e.scoreTag?(n(),i(s,{key:0,class:"score-tag"},{default:o((()=>[f(_(e.scoreTag),1)])),_:2},1024)):p("",!0)])),_:2},1024),r(l,{class:P(["expand-icon",{expanded:W(e.index)}])},{default:o((()=>[r(u,{type:"down",size:"16",color:"#868e96"})])),_:2},1032,["class"])])),_:2},1024)])),_:2},1032,["onClick"]),C(r(l,{class:"course-details"},{default:o((()=>[r(l,{class:"detail-grid"},{default:o((()=>[r(l,{class:"detail-item"},{default:o((()=>[r(s,{class:"detail-label"},{default:o((()=>[f("è¯¾ç¨‹ä»£ç ")])),_:1}),r(s,{class:"detail-value"},{default:o((()=>[f(_(e.courseCode),1)])),_:2},1024)])),_:2},1024),r(l,{class:"detail-item"},{default:o((()=>[r(s,{class:"detail-label"},{default:o((()=>[f("æ€»å­¦æ—¶")])),_:1}),r(s,{class:"detail-value"},{default:o((()=>[f(_(e.totalHours),1)])),_:2},1024)])),_:2},1024),r(l,{class:"detail-item"},{default:o((()=>[r(s,{class:"detail-label"},{default:o((()=>[f("è¯¾ç¨‹æ€§è´¨")])),_:1}),r(s,{class:"detail-value"},{default:o((()=>[f(_(e.courseNature),1)])),_:2},1024)])),_:2},1024),r(l,{class:"detail-item"},{default:o((()=>[r(s,{class:"detail-label"},{default:o((()=>[f("è¯¾ç¨‹ç±»åˆ«")])),_:1}),r(s,{class:"detail-value"},{default:o((()=>[f(_(e.courseCategory),1)])),_:2},1024)])),_:2},1024),r(l,{class:"detail-item"},{default:o((()=>[r(s,{class:"detail-label"},{default:o((()=>[f("è€ƒæ ¸æ–¹å¼")])),_:1}),r(s,{class:"detail-value"},{default:o((()=>[f(_(e.assessmentMethod),1)])),_:2},1024)])),_:2},1024),r(l,{class:"detail-item"},{default:o((()=>[r(s,{class:"detail-label"},{default:o((()=>[f("è€ƒè¯•ç±»åž‹")])),_:1}),r(s,{class:"detail-value"},{default:o((()=>[f(_(e.examType),1)])),_:2},1024)])),_:2},1024),e.groupName?(n(),i(l,{key:0,class:"detail-item"},{default:o((()=>[r(s,{class:"detail-label"},{default:o((()=>[f("è¯¾ç¨‹åˆ†ç»„")])),_:1}),r(s,{class:"detail-value"},{default:o((()=>[f(_(e.groupName),1)])),_:2},1024)])),_:2},1024)):p("",!0),e.retakeSemester?(n(),i(l,{key:1,class:"detail-item"},{default:o((()=>[r(s,{class:"detail-label"},{default:o((()=>[f("é‡ä¿®å­¦æœŸ")])),_:1}),r(s,{class:"detail-value"},{default:o((()=>[f(_(e.retakeSemester),1)])),_:2},1024)])),_:2},1024)):p("",!0)])),_:2},1024)])),_:2},1536),[[w,W(e.index)]])])),_:2},1032,["class"])))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}))])),_:1})])),_:1})),q.value?(n(),i(l,{key:2,class:"custom-gpa-footer"},{default:o((()=>[K.value?(n(),i(l,{key:0,class:"result-display-card"},{default:o((()=>[r(l,{class:"result-header"},{default:o((()=>[r(s,{class:"result-title"},{default:o((()=>[f("è‡ªå®šä¹‰è®¡ç®—ç»“æžœ")])),_:1}),r(s,{class:"close-result-btn",onClick:ue},{default:o((()=>[f("å…³é—­")])),_:1})])),_:1}),r(l,{class:"result-content"},{default:o((()=>[r(l,{class:"result-gpa"},{default:o((()=>[r(s,{class:"gpa-value"},{default:o((()=>{var e;return[f(_((null==(e=K.value.weighted_gpa)?void 0:e.toFixed(2))||"0.00"),1)]})),_:1}),r(s,{class:"gpa-label"},{default:o((()=>[f("åŠ æƒå¹³å‡GPA")])),_:1})])),_:1}),r(l,{class:"result-stats"},{default:o((()=>[r(l,{class:"stat-item"},{default:o((()=>[r(s,{class:"stat-value"},{default:o((()=>[f(_(K.value.total_credit||0),1)])),_:1}),r(s,{class:"stat-label"},{default:o((()=>[f("æ€»å­¦åˆ†")])),_:1})])),_:1}),r(l,{class:"stat-item"},{default:o((()=>[r(s,{class:"stat-value"},{default:o((()=>[f(_(K.value.course_count||0),1)])),_:1}),r(s,{class:"stat-label"},{default:o((()=>[f("è¯¾ç¨‹æ•°")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):p("",!0),r(l,{class:"footer-actions"},{default:o((()=>[r(l,{class:"selection-info"},{default:o((()=>[r(s,{class:"info-text"},{default:o((()=>[f("å·²é€‰ "+_(H.value.length)+" / "+_($.value.length)+" é—¨",1)])),_:1}),r(l,{class:"actions"},{default:o((()=>[r(s,{class:"action-btn",onClick:se},{default:o((()=>[f("å…¨é€‰")])),_:1}),r(s,{class:"action-btn",onClick:te},{default:o((()=>[f("æ¸…ç©º")])),_:1})])),_:1})])),_:1}),r(c,{class:"calculate-btn",onClick:ce,disabled:I.value||0===H.value.length},{default:o((()=>[f(_(I.value?"è®¡ç®—ä¸­...":"è®¡ç®—è‡ªå®šä¹‰GPA"),1)])),_:1},8,["disabled"])])),_:1})])),_:1})):p("",!0),r(y,{name:"modal"},{default:o((()=>[de.value?(n(),i(l,{key:0,class:"modal-overlay",onClick:k(ie,["self"])},{default:o((()=>[r(l,{class:"modal-container"},{default:o((()=>[r(l,{class:"modal-header"},{default:o((()=>[r(s,{class:"modal-title"},{default:o((()=>[f("æˆç»©æŸ¥è¯¢ä¸ŽGPAåˆ†æžæç¤º")])),_:1})])),_:1}),r(l,{class:"modal-content"},{default:o((()=>[r(s,null,{default:o((()=>[f(" å› ä¸åŒä¸“ä¸šæˆ–ä¸åŒç›®æ ‡é™¢æ ¡çš„è¦æ±‚ä¸åŒï¼Œä¿ç ”æ‰€éœ€è¦çš„ç»©ç‚¹è¦æ±‚ä¸åŒï¼Œå¦‚æœ‰éœ€æ±‚ï¼Œè¯·å‰å¾€åº•éƒ¨è‡ªå®šä¹‰GPAè®¡ç®—è‡ªè¡Œè®¡ç®— ")])),_:1})])),_:1}),r(l,{class:"modal-footer"},{default:o((()=>[r(c,{class:"modal-btn",onClick:ie},{default:o((()=>[f("æˆ‘å·²çŸ¥æ™“")])),_:1})])),_:1})])),_:1})])),_:1})):p("",!0)])),_:1})])),_:1})}}},[["__scopeId","data-v-9e3236af"]]);export{L as default};

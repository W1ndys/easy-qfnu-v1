import{B as e,W as a,C as t,r as l,o as s,c as n,w as c,a as o,b as u,t as r,m as d,F as i,N as f,h as p,Q as _,A as v,i as y,d as m,S as g,a3 as w,k as h,a2 as D,D as k,f as b,E as S,u as x,H as C,G as T,Z as I,_ as z}from"./index-DcrouHsO.js";import{_ as O,r as $,a as M,o as E,b as j}from"./uni-icons.CHXDxywe.js";import{P as B}from"./PageLayout.DmxG76Xg.js";import{L}from"./LoadingScreen.DFk9L_lM.js";import{_ as P}from"./uni-popup.BTXsHfw1.js";const q=O({__name:"DateNavigator",props:{selectedDate:{type:String,required:!0}},emits:["dateChange"],setup(h,{expose:D,emit:k}){const b=h,S=k,x=e(7),C=e([]),T=e(null),I=a((()=>0===C.value.length?{day:"",month:"",weekday:""}:C.value[x.value]||{day:"",month:"",weekday:""})),z=a((()=>{const e=x.value,a=Math.max(0,e-5),t=Math.min(C.value.length,e+6);return C.value.slice(a,t)})),O=a((()=>{const e=x.value;return e-Math.max(0,e-5)}));function E(e=null){const a=[],t=e?new Date(e):new Date;for(let l=-7;l<=7;l++){const e=new Date(t);e.setDate(t.getDate()+l),a.push(j(e))}if(C.value=a,e){const a=C.value.findIndex((a=>a.date===e));-1!==a&&(x.value=a)}else x.value=7}function j(e){const a=e.toISOString().split("T")[0],t=(new Date).toISOString().split("T")[0];return{date:a,day:e.getDate().toString(),month:`${e.getMonth()+1}æœˆ`,weekday:`å‘¨${["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][e.getDay()]}`,isToday:a===t}}function B(e="forward",a=7){if("forward"===e){const e=new Date(C.value[C.value.length-1].date);for(let t=1;t<=a;t++){const a=new Date(e);a.setDate(e.getDate()+t),C.value.push(j(a))}}else{const e=new Date(C.value[0].date),t=[];for(let l=a;l>=1;l--){const a=new Date(e);a.setDate(e.getDate()-l),t.push(j(a))}C.value=[...t,...C.value],x.value+=a}}function L(){x.value>0?x.value--:(B("backward",7),x.value=6);const e=C.value[x.value];S("dateChange",e.date)}function P(){x.value<C.value.length-1||B("forward",7),x.value++;const e=C.value[x.value];S("dateChange",e.date)}function q(e){const a=C.value.findIndex((a=>a.date===e));-1!==a?x.value=a:E(e),S("dateChange",e)}function A(){_((()=>{const e=T.value;e&&e.click()}))}function R(e){q(e.detail.value)}return a((()=>{const e=(new Date).toISOString().split("T")[0];return b.selectedDate===e})),t((()=>b.selectedDate),(e=>{const a=C.value.findIndex((a=>a.date===e));-1!==a?x.value=a:q(e)})),t(x,(e=>{e<=2?B("backward",7):e>=C.value.length-3&&B("forward",7)})),D({gotoToday:function(){q((new Date).toISOString().split("T")[0])}}),E(),(e,a)=>{const t=$(l("uni-icons"),M),_=v,D=y,k=m,b=g,E=w;return s(),n(k,{class:"date-navigator"},{default:c((()=>[o(k,{class:"date-header"},{default:c((()=>[o(_,{class:"nav-arrow nav-arrow--prev",onClick:L},{default:c((()=>[o(t,{type:"arrowleft",size:"24",color:"#7f4515"})])),_:1}),o(k,{class:"date-display",onClick:A},{default:c((()=>[o(k,{class:"date-main"},{default:c((()=>[o(D,{class:"current-day"},{default:c((()=>[u(r(I.value.day),1)])),_:1}),o(k,{class:"date-meta"},{default:c((()=>[o(D,{class:"current-month"},{default:c((()=>[u(r(I.value.month),1)])),_:1}),o(D,{class:"current-weekday"},{default:c((()=>[u(r(I.value.weekday),1)])),_:1})])),_:1})])),_:1}),o(t,{type:"calendar",size:"20",color:"#7f4515"})])),_:1}),o(_,{class:"nav-arrow nav-arrow--next",onClick:P},{default:c((()=>[o(t,{type:"arrowright",size:"24",color:"#7f4515"})])),_:1})])),_:1}),o(k,{class:"date-slider"},{default:c((()=>[o(b,{class:"date-scroll","scroll-x":"","scroll-into-view":"date-"+x.value,"scroll-with-animation":"",enhanced:"","show-scrollbar":!1},{default:c((()=>[o(k,{class:"date-list"},{default:c((()=>[(s(!0),d(i,null,f(z.value,((e,a)=>(s(),n(k,{key:e.date,id:"date-"+a,class:p(["date-option",{"date-option--active":a===O.value,"date-option--today":e.isToday}]),onClick:e=>function(e){const a=x.value,t=Math.max(0,a-5)+e;if(t>=0&&t<C.value.length){x.value=t;const e=C.value[t];S("dateChange",e.date)}}(a)},{default:c((()=>[o(D,{class:"option-day"},{default:c((()=>[u(r(e.day),1)])),_:2},1024),o(D,{class:"option-weekday"},{default:c((()=>[u(r(e.weekday.replace("å‘¨","")),1)])),_:2},1024)])),_:2},1032,["id","class","onClick"])))),128))])),_:1})])),_:1},8,["scroll-into-view"])])),_:1}),o(E,{mode:"date",value:h.selectedDate,onChange:R,start:"2020-01-01",end:"2030-12-31"},{default:c((()=>[o(k,{class:"date-picker-trigger",ref_key:"datePickerTrigger",ref:T},null,512)])),_:1},8,["value"])])),_:1})}}},[["__scopeId","data-v-9bfc6441"]]),A=O({__name:"CourseCard",props:{course:{type:Object,default:null},isEmpty:{type:Boolean,default:!1}},setup(e){function a(e){switch(e){case"å¿…ä¿®":return"property-required";case"é€‰ä¿®":return"property-elective";case"å®è·µ":return"property-practice";default:return"property-default"}}return(t,d)=>{const i=y,f=m,_=$(l("uni-icons"),M);return s(),n(f,{class:p(["course-card",{"course-card--empty":e.isEmpty}])},{default:c((()=>[e.isEmpty?(s(),n(f,{key:1,class:"empty-content"},{default:c((()=>[o(i,{class:"empty-text"},{default:c((()=>[u("æ— è¯¾ç¨‹")])),_:1})])),_:1})):(s(),n(f,{key:0,class:"course-content"},{default:c((()=>[o(f,{class:"course-header"},{default:c((()=>[o(i,{class:"course-name"},{default:c((()=>[u(r(e.course.course_name),1)])),_:1}),o(i,{class:"course-credits"},{default:c((()=>[u(r(e.course.course_credits)+"å­¦åˆ†",1)])),_:1})])),_:1}),o(f,{class:"course-property"},{default:c((()=>[o(i,{class:p(["property-tag",a(e.course.course_property)])},{default:c((()=>[u(r(e.course.course_property),1)])),_:1},8,["class"])])),_:1}),o(f,{class:"course-time"},{default:c((()=>[o(_,{type:"clock",size:"16",color:"#7f4515"}),o(i,{class:"time-text"},{default:c((()=>[u(r(e.course.period)+"èŠ‚",1)])),_:1})])),_:1}),o(f,{class:"course-location"},{default:c((()=>[o(_,{type:"location",size:"16",color:"#7f4515"}),o(i,{class:"location-text"},{default:c((()=>[u(r(e.course.classroom),1)])),_:1})])),_:1}),e.course.class_name?(s(),n(f,{key:0,class:"course-class"},{default:c((()=>[o(i,{class:"class-text"},{default:c((()=>[u(r(e.course.class_name),1)])),_:1})])),_:1})):h("",!0)])),_:1}))])),_:1},8,["class"])}}},[["__scopeId","data-v-47c9a877"]]),R=O({__name:"ClassTableView",props:{courses:{type:Array,default:()=>[]},selectedDate:{type:String,required:!0}},setup(t){const p=t,_=e(null),g=e(null),w=a((()=>p.courses&&0!==p.courses.length?[...p.courses].sort(((e,a)=>{const t=e=>{const a=e.match(/(\d+)/);return a?parseInt(a[1]):0};return t(e.period)-t(a.period)})):[]));function D(e){if(!e)return"";const a=new Date(e),t=new Date,l=new Date(t);l.setDate(t.getDate()+1);const s=new Date(t);s.setDate(t.getDate()-1);const n=["å‘¨æ—¥","å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­"][a.getDay()];if(e===t.toISOString().split("T")[0])return`ä»Šå¤© ${n}`;if(e===l.toISOString().split("T")[0])return`æ˜å¤© ${n}`;if(e===s.toISOString().split("T")[0])return`æ˜¨å¤© ${n}`;return`${a.getMonth()+1}æœˆ${a.getDate()}æ—¥ ${n}`}function k(){var e;null==(e=_.value)||e.close(),g.value=null}return(e,a)=>{const p=y,b=m,S=$(l("uni-icons"),M),x=v,C=$(l("uni-popup"),P);return s(),n(b,{class:"classtable-view"},{default:c((()=>[t.courses&&t.courses.length>0?(s(),n(b,{key:0,class:"courses-container"},{default:c((()=>[o(b,{class:"date-header"},{default:c((()=>[o(p,{class:"date-title"},{default:c((()=>[u(r(D(t.selectedDate)),1)])),_:1}),o(p,{class:"course-count"},{default:c((()=>[u("å…± "+r(t.courses.length)+" èŠ‚è¯¾",1)])),_:1})])),_:1}),o(b,{class:"courses-list"},{default:c((()=>[(s(!0),d(i,null,f(w.value,((e,a)=>(s(),n(A,{key:a,course:e,onClick:a=>function(e){var a;g.value=e,null==(a=_.value)||a.open()}(e)},null,8,["course","onClick"])))),128))])),_:1})])),_:1})):(s(),n(b,{key:1,class:"empty-state"},{default:c((()=>[o(b,{class:"empty-icon"},{default:c((()=>[o(S,{type:"calendar",size:"80",color:"#e0e0e0"})])),_:1}),o(p,{class:"empty-title"},{default:c((()=>[u(r(D(t.selectedDate)),1)])),_:1}),o(p,{class:"empty-desc"},{default:c((()=>[u("ä»Šå¤©æ²¡æœ‰è¯¾ç¨‹å®‰æ’")])),_:1}),o(p,{class:"empty-tip"},{default:c((()=>[u("å¥½å¥½ä¼‘æ¯å§ ğŸ‰")])),_:1})])),_:1})),o(C,{ref_key:"courseDetailPopup",ref:_,type:"bottom","background-color":"#fff","z-index":1e4},{default:c((()=>[g.value?(s(),n(b,{key:0,class:"course-detail-popup"},{default:c((()=>[o(b,{class:"popup-header"},{default:c((()=>[o(p,{class:"popup-title"},{default:c((()=>[u("è¯¾ç¨‹è¯¦æƒ…")])),_:1}),o(x,{class:"close-btn",onClick:k},{default:c((()=>[o(S,{type:"close",size:"24",color:"#666"})])),_:1})])),_:1}),o(b,{class:"popup-content"},{default:c((()=>[o(b,{class:"detail-item"},{default:c((()=>[o(p,{class:"detail-label"},{default:c((()=>[u("è¯¾ç¨‹åç§°")])),_:1}),o(p,{class:"detail-value"},{default:c((()=>[u(r(g.value.course_name),1)])),_:1})])),_:1}),o(b,{class:"detail-item"},{default:c((()=>[o(p,{class:"detail-label"},{default:c((()=>[u("å­¦åˆ†")])),_:1}),o(p,{class:"detail-value"},{default:c((()=>[u(r(g.value.course_credits)+"å­¦åˆ†",1)])),_:1})])),_:1}),o(b,{class:"detail-item"},{default:c((()=>[o(p,{class:"detail-label"},{default:c((()=>[u("è¯¾ç¨‹å±æ€§")])),_:1}),o(p,{class:"detail-value"},{default:c((()=>[u(r(g.value.course_property),1)])),_:1})])),_:1}),o(b,{class:"detail-item"},{default:c((()=>[o(p,{class:"detail-label"},{default:c((()=>[u("ä¸Šè¯¾æ—¶é—´")])),_:1}),o(p,{class:"detail-value"},{default:c((()=>[u(r(g.value.class_time),1)])),_:1})])),_:1}),o(b,{class:"detail-item"},{default:c((()=>[o(p,{class:"detail-label"},{default:c((()=>[u("æ•™å®¤")])),_:1}),o(p,{class:"detail-value"},{default:c((()=>[u(r(g.value.classroom),1)])),_:1})])),_:1}),g.value.class_name?(s(),n(b,{key:0,class:"detail-item"},{default:c((()=>[o(p,{class:"detail-label"},{default:c((()=>[u("ç­çº§")])),_:1}),o(p,{class:"detail-value"},{default:c((()=>[u(r(g.value.class_name),1)])),_:1})])),_:1})):h("",!0)])),_:1})])),_:1})):h("",!0)])),_:1},512)])),_:1})}}},[["__scopeId","data-v-4306f1ce"]]),G=O({__name:"WarningModal",emits:["confirm"],setup(a,{expose:t,emit:r}){const d=r,i=e(null);function f(){var e;null==(e=i.value)||e.close()}function p(){f(),d("confirm")}return t({show:function(){var e;null==(e=i.value)||e.open()},hide:f}),(e,a)=>{const t=$(l("uni-icons"),M),r=m,d=y,f=v,_=$(l("uni-popup"),P);return s(),n(_,{ref_key:"warningPopup",ref:i,type:"center","background-color":"rgba(0, 0, 0, 0.5)","mask-click":!1},{default:c((()=>[o(r,{class:"warning-modal"},{default:c((()=>[o(r,{class:"warning-icon"},{default:c((()=>[o(t,{type:"info",size:"60",color:"#ff9500"})])),_:1}),o(r,{class:"modal-title"},{default:c((()=>[o(d,{class:"title-text"},{default:c((()=>[u("åŠŸèƒ½æµ‹è¯•æé†’")])),_:1})])),_:1}),o(r,{class:"modal-content"},{default:c((()=>[o(d,{class:"content-text"},{default:c((()=>[u(" æœ¬è¯¾ç¨‹è¡¨åŠŸèƒ½å°šæœªç»è¿‡å……åˆ†æµ‹è¯•ï¼Œå¯èƒ½å­˜åœ¨æ•°æ®ä¸å‡†ç¡®æˆ–åŠŸèƒ½ä¸ç¨³å®šçš„æƒ…å†µï¼Œè¯·å‹¿å®Œå…¨ä¾èµ–ã€‚ ")])),_:1}),o(d,{class:"content-text"},{default:c((()=>[u(" ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿éšæ—¶åé¦ˆã€‚ ")])),_:1})])),_:1}),o(r,{class:"modal-actions"},{default:c((()=>[o(f,{class:"action-btn primary-btn",onClick:p},{default:c((()=>[u(" æˆ‘å·²çŸ¥æ™“ ")])),_:1})])),_:1})])),_:1})])),_:1},512)}}},[["__scopeId","data-v-cda6aa8a"]]),N=O({__name:"classtable",setup(t){const r=e(!0),d=e((new Date).toISOString().split("T")[0]),i=e({}),f=e(null),p=e(null),_=a((()=>i.value[d.value]||[])),v=a((()=>{const e=(new Date).toISOString().split("T")[0];return d.value===e}));function g(){return!!k("token")||(b({title:"è¯·å…ˆç™»å½•",icon:"none"}),S({url:"/pages/index/index"}),!1)}async function w(e){d.value=e,i.value[e]||await O(e),setTimeout((()=>{P(e)}),500)}async function O(e){const a=A(e);if(N.has(a))return;const t=k("token"),l=x().globalData.apiBaseURL;try{N.add(a),I({title:"åŠ è½½ä¸­..."});const{statusCode:s,data:n}=await C({url:`${l}/api/v1/classtable/week`,method:"GET",header:{Authorization:"Bearer "+t},data:{query_date:e}});200===s&&n.success?n.data&&n.data.days&&(n.data.days.forEach((e=>{i.value[e.date]=e.courses||[]})),U.add(a)):401===s?W():b({title:n.detail||n.message||"è·å–è¯¾ç¨‹è¡¨å¤±è´¥",icon:"none"})}catch(s){console.error("è·å–è¯¾ç¨‹å¤±è´¥",s),b({title:"ç½‘ç»œè¿æ¥å¤±è´¥",icon:"none"})}finally{z(),N.delete(a)}}async function P(e){const a=[],t=new Date(e);for(let s=-3;s<=3;s++){const e=new Date(t);e.setDate(t.getDate()+s);const l=e.toISOString().split("T")[0],n=A(l);U.has(n)||i.value[l]||a.push(l)}const l=[...new Set(a.map((e=>A(e))))];for(const s of l){const e=a.find((e=>A(e)===s));e&&await O(e)}}function A(e){const a=new Date(e),t=new Date(a),l=a.getDay(),s=a.getDate()-l+(0===l?-6:1);return t.setDate(s),t.toISOString().split("T")[0]}E((()=>{g()&&(D({title:"è¯¾ç¨‹è¡¨"}),setTimeout((()=>{p.value&&p.value.show()}),500),async function(){r.value=!0;const e=k("token"),a=x().globalData.apiBaseURL;try{const{statusCode:t,data:l}=await C({url:`${a}/api/v1/classtable/today`,method:"GET",header:{Authorization:"Bearer "+e}});if(200===t&&l.success){const e=l.data.date;i.value[e]=l.data.courses||[],d.value=e,U.add(A(e)),setTimeout((()=>{P(e)}),1e3)}else 401===t?W():b({title:l.detail||l.message||"è·å–è¯¾ç¨‹è¡¨å¤±è´¥",icon:"none"})}catch(t){console.error("è·å–ä»Šæ—¥è¯¾ç¨‹å¤±è´¥",t),b({title:"ç½‘ç»œè¿æ¥å¤±è´¥",icon:"none"})}finally{r.value=!1}}())})),j((()=>{g()}));const N=new Set,U=new Set;function W(){T("token"),b({title:"ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•",icon:"none"}),setTimeout((()=>S({url:"/pages/index/index"})),1500)}function F(){f.value&&f.value.gotoToday()}function H(){console.log("ç”¨æˆ·å·²ç¡®è®¤è­¦å‘Šä¿¡æ¯")}return(e,a)=>{const t=m,i=y,g=$(l("uni-icons"),M);return s(),n(B,null,{default:c((()=>[r.value?(s(),n(L,{key:0,text:"æ­£åœ¨åŠ è½½è¯¾è¡¨æ•°æ®..."})):(s(),n(t,{key:1,class:"page-container page-rounded-container"},{default:c((()=>[o(t,{class:"background-decoration"},{default:c((()=>[o(t,{class:"circle circle-1"}),o(t,{class:"circle circle-2"}),o(t,{class:"circle circle-3"})])),_:1}),o(t,{class:"page-header"},{default:c((()=>[o(t,{class:"header-content"},{default:c((()=>[o(i,{class:"page-title"},{default:c((()=>[u("è¯¾ç¨‹è¡¨")])),_:1}),o(i,{class:"page-subtitle"},{default:c((()=>[u("Class Schedule")])),_:1})])),_:1})])),_:1}),o(t,{class:"content-wrapper"},{default:c((()=>[o(q,{ref_key:"dateNavigatorRef",ref:f,"selected-date":d.value,onDateChange:w},null,8,["selected-date"]),o(R,{courses:_.value,"selected-date":d.value},null,8,["courses","selected-date"])])),_:1})])),_:1})),v.value?h("",!0):(s(),n(t,{key:2,class:"floating-today-btn",onClick:F},{default:c((()=>[o(g,{type:"home",size:"24",color:"#fff"}),o(i,{class:"today-text"},{default:c((()=>[u("ä»Šæ—¥")])),_:1})])),_:1})),o(G,{ref_key:"warningModalRef",ref:p,onConfirm:H},null,512)])),_:1})}}},[["__scopeId","data-v-6485bd06"]]);export{N as default};

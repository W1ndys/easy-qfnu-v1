import{M as e,o as a,c as t,w as o,a as l,h as n,L as s,b as c,t as r,g as i,d,i as u,r as p,m as f,F as _,N as m,k as g,A as h,B as C,O as y,J as b,e as v,f as k,n as x,q,G as L,E as w,D as I,P as E,Q as z}from"./index-DCaUqO-K.js";import{P as M}from"./PageLayout.ueqtfe8A.js";import{M as P}from"./ModernCard.BvGpclc6.js";import{u as F,P as S}from"./ProfileCard.DViROts3.js";import{_ as j,r as R,a as A,o as D,b as N}from"./uni-icons.CykNNyZE.js";import{_ as B}from"./uni-popup.DehUHpRV.js";import{d as Q}from"./jwt-decode.C5lGqWoE.js";const U=j({__name:"ProfileCard",setup(p,{expose:f}){const{profile:_,loading:m,fetchProfile:g,refreshProfile:h,initProfile:C}=F();return e((()=>{C()})),f({refreshProfile:h,fetchProfile:g,profile:_}),(e,p)=>{const f=i,g=d,h=u;return a(),t(P,{class:"profile-card",highlight:""},{default:o((()=>[l(g,{class:n(["profile-content",{loading:s(m)}])},{default:o((()=>[l(g,{class:"identity-section"},{default:o((()=>[l(g,{class:"avatar-wrapper"},{default:o((()=>[l(f,{class:"avatar",src:"https://pic1.zhimg.com/80/v2-82c1c70c69720aadac79594ea50ed4a7.png",mode:"aspectFit"}),l(g,{class:n(["status-indicator",{"loading-pulse":s(m)}])},null,8,["class"])])),_:1}),l(g,{class:"identity-info"},{default:o((()=>[l(h,{class:"welcome-text"},{default:o((()=>[c("欢迎回来~")])),_:1}),l(h,{class:"user-name"},{default:o((()=>[c(r(s(_).student_name),1)])),_:1}),l(h,{class:"user-id"},{default:o((()=>[c(r(s(_).student_id),1)])),_:1})])),_:1})])),_:1}),l(g,{class:"details-section"},{default:o((()=>[l(g,{class:"detail-item"},{default:o((()=>[l(h,{class:"detail-label"},{default:o((()=>[c("学院")])),_:1}),l(h,{class:"detail-value"},{default:o((()=>[c(r(s(_).college),1)])),_:1})])),_:1}),l(g,{class:"detail-item"},{default:o((()=>[l(h,{class:"detail-label"},{default:o((()=>[c("专业")])),_:1}),l(h,{class:"detail-value"},{default:o((()=>[c(r(s(_).major),1)])),_:1})])),_:1}),l(g,{class:"detail-item"},{default:o((()=>[l(h,{class:"detail-label"},{default:o((()=>[c("班级")])),_:1}),l(h,{class:"detail-value"},{default:o((()=>[c(r(s(_).class_name),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["class"])])),_:1})}}},[["__scopeId","data-v-cf48cf8d"]]),G=j({__name:"NoticeBar",props:{noticeData:{type:Object,required:!0,default:()=>({title:"重要通知：请加用户群防走丢！"})}},emits:["click"],setup(e,{emit:n}){const s=n,i=()=>{s("click")};return(n,s)=>{const f=R(p("uni-icons"),A),_=u,m=d;return a(),t(m,{class:"notice-bar",onClick:i},{default:o((()=>[l(f,{class:"notice-icon",type:"sound",size:"20",color:"#FF6B35"}),l(_,{class:"notice-text"},{default:o((()=>[c(r(e.noticeData.title),1)])),_:1}),l(f,{type:"right",size:"16",color:"#C0C4CC"})])),_:1})}}},[["__scopeId","data-v-7eeda709"]]),T=j({__name:"FeatureGrid",props:{features:{type:Array,required:!0,default:()=>[]}},emits:["navigate"],setup(e,{emit:s}){const i=s;return(s,h)=>{const C=d,y=R(p("uni-icons"),A),b=u;return a(),t(P,{class:"grid-card"},{default:o((()=>[l(C,{class:"grid-title"},{default:o((()=>[c("核心功能")])),_:1}),l(C,{class:"grid-2x2"},{default:o((()=>[(a(!0),f(_,null,m(e.features,((e,s)=>(a(),t(C,{key:s,class:n(["grid-cell",{disabled:!e.url}]),onClick:e=>(e=>{i("navigate",e)})(s)},{default:o((()=>[l(C,{class:"cell-icon"},{default:o((()=>[l(y,{type:e.icon,size:"30",color:e.url?"#7F4515":"#C0C6CF"},null,8,["type","color"])])),_:2},1024),l(b,{class:"cell-title"},{default:o((()=>[c(r(e.text),1)])),_:2},1024),e.description?(a(),t(b,{key:0,class:"cell-desc"},{default:o((()=>[c(r(e.description),1)])),_:2},1024)):g("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})}}},[["__scopeId","data-v-08e31d93"]]),O=j({__name:"SystemActions",emits:["refresh","logout","userAgreement","clearCache","changelog","contact","feedback","sponsorList","shareSite"],setup(e,{emit:n}){const s=n,r=()=>s("refresh"),i=()=>s("logout"),f=()=>s("userAgreement"),_=()=>s("clearCache"),m=()=>s("changelog"),g=()=>s("contact"),C=()=>s("feedback"),y=()=>s("sponsorList"),b=()=>s("shareSite");return(e,n)=>{const s=R(p("uni-icons"),A),v=u,k=h,x=d;return a(),t(P,{title:"系统操作"},{default:o((()=>[l(x,{class:"quick-actions"},{default:o((()=>[l(k,{class:"action-btn btn-primary",onClick:r},{default:o((()=>[l(s,{type:"refresh",size:"20"}),l(v,null,{default:o((()=>[c("刷新数据")])),_:1})])),_:1}),l(k,{class:"action-btn btn-danger",onClick:i},{default:o((()=>[l(s,{type:"closeempty",size:"20"}),l(v,null,{default:o((()=>[c("退出登录")])),_:1})])),_:1}),l(k,{class:"action-btn btn-secondary",onClick:f},{default:o((()=>[l(s,{type:"paperplane",size:"20"}),l(v,null,{default:o((()=>[c("用户协议")])),_:1})])),_:1}),l(k,{class:"action-btn btn-danger",onClick:_},{default:o((()=>[l(s,{type:"trash",size:"20"}),l(v,null,{default:o((()=>[c("清除缓存")])),_:1})])),_:1}),l(k,{class:"action-btn btn-secondary",onClick:m},{default:o((()=>[l(s,{type:"list",size:"20"}),l(v,null,{default:o((()=>[c("更新日志")])),_:1})])),_:1}),l(k,{class:"action-btn btn-secondary",onClick:g},{default:o((()=>[l(s,{type:"chatbubble",size:"20"}),l(v,null,{default:o((()=>[c("联系作者")])),_:1})])),_:1}),l(k,{class:"action-btn btn-secondary",onClick:C},{default:o((()=>[l(s,{type:"compose",size:"20"}),l(v,null,{default:o((()=>[c("意见建议")])),_:1})])),_:1}),l(k,{class:"action-btn btn-secondary",onClick:y},{default:o((()=>[l(s,{type:"heart",size:"20"}),l(v,null,{default:o((()=>[c("赞赏名单")])),_:1})])),_:1}),l(k,{class:"action-btn btn-secondary",onClick:b},{default:o((()=>[l(s,{type:"redo",size:"20"}),l(v,null,{default:o((()=>[c("分享本站")])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-85bc15ff"]]),J=j({__name:"SupportCard",emits:["imageError","imageLoad"],setup(e,{emit:n}){const s=n,r=()=>{s("imageError")},p=()=>{s("imageLoad")};return(e,n)=>{const s=u,f=d,_=i;return a(),t(P,{title:"支持开发",class:"support-card"},{default:o((()=>[l(f,{class:"support-content"},{default:o((()=>[l(f,{class:"support-text"},{default:o((()=>[l(s,{class:"support-title"},{default:o((()=>[c("助力项目发展")])),_:1}),l(s,{class:"support-desc"},{default:o((()=>[c("本服务完全免费使用，服务器每日支出约为7元左右（选课高峰期翻2-3倍），以及前期服务器设备等支出几百依赖作者个人支出。如果想支持作者助力开发维护，欢迎赞赏~")])),_:1})])),_:1}),l(f,{class:"qr-code-container"},{default:o((()=>[l(_,{class:"qr-code",src:"https://picx.zhimg.com/80/v2-076422270c197b0031c609e47be2e36c_720w.png?source=d16d100b",mode:"aspectFit",onError:r,onLoad:p}),l(s,{class:"qr-code-label"},{default:o((()=>[c("微信赞赏")])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-170d8c99"]]),Y=j({__name:"NoticeModal",props:{noticeData:{type:Object,required:!0,default:()=>({content:"",version:"1"})}},emits:["close","popupChange"],setup(e,{expose:n,emit:s}){const r=s,i=C(null),f=()=>{i.value&&i.value.close()},_=e=>{r("popupChange",e)},m=()=>{window.open("https://qm.qq.com/q/jKCk6GtL1e","_blank")},g=()=>{window.open("https://qm.qq.com/q/BBYFdHBDEc","_blank")};return n({openModal:()=>{i.value&&i.value.open()},closeNoticeModal:f}),(n,s)=>{const r=u,C=R(p("uni-icons"),A),b=d,v=y,k=h,x=R(p("uni-popup"),B);return a(),t(x,{ref_key:"noticePopup",ref:i,type:"center",onChange:_},{default:o((()=>[l(b,{class:"popup-content"},{default:o((()=>[l(b,{class:"popup-header"},{default:o((()=>[l(r,{class:"popup-title"},{default:o((()=>[c("公告详情")])),_:1}),l(b,{class:"popup-close-btn",onClick:f},{default:o((()=>[l(C,{type:"closeempty",size:"22",color:"#909399"})])),_:1})])),_:1}),l(b,{class:"popup-body"},{default:o((()=>[l(v,{class:"status-text",nodes:e.noticeData.content},null,8,["nodes"]),l(b,{class:"community-content-wrapper"},{default:o((()=>[l(b,{class:"community-groups"},{default:o((()=>[l(b,{class:"group-item"},{default:o((()=>[l(b,{class:"group-info"},{default:o((()=>[l(b,{class:"group-name"},{default:o((()=>[l(C,{type:"sound",size:"20",color:"#7F4515"}),l(r,{class:"group-title"},{default:o((()=>[c("官方消息群")])),_:1})])),_:1}),l(r,{class:"group-desc"},{default:o((()=>[c("获取最新消息和通知")])),_:1})])),_:1}),l(k,{class:"popup-action-btn",onClick:m},{default:o((()=>[l(C,{type:"copy",size:"16",color:"#7F4515"}),l(r,null,{default:o((()=>[c("加入群聊")])),_:1})])),_:1})])),_:1}),l(b,{class:"group-item"},{default:o((()=>[l(b,{class:"group-info"},{default:o((()=>[l(b,{class:"group-name"},{default:o((()=>[l(C,{type:"star",size:"20",color:"#7F4515"}),l(r,{class:"group-title"},{default:o((()=>[c("开发交流群")])),_:1})])),_:1}),l(r,{class:"group-desc"},{default:o((()=>[c("建议反馈、开发想法交流")])),_:1})])),_:1}),l(k,{class:"popup-action-btn",onClick:g},{default:o((()=>[l(C,{type:"copy",size:"16",color:"#7F4515"}),l(r,null,{default:o((()=>[c("加入群聊")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},512)}}},[["__scopeId","data-v-f17932aa"]]),$=j({__name:"CalendarModal",emits:["imageError","imageLoad"],setup(e,{expose:n,emit:s}){const r=s,f=C(null),_=()=>{f.value&&f.value.close()},m=()=>{r("imageError")},g=()=>{r("imageLoad")};return n({openModal:()=>{f.value&&f.value.open()},closeCalendarModal:_}),(e,n)=>{const s=u,r=R(p("uni-icons"),A),h=d,C=i,y=R(p("uni-popup"),B);return a(),t(y,{ref_key:"calendarPopup",ref:f,type:"center"},{default:o((()=>[l(h,{class:"popup-content calendar-popup"},{default:o((()=>[l(h,{class:"popup-header"},{default:o((()=>[l(s,{class:"popup-title"},{default:o((()=>[c("校历")])),_:1}),l(h,{class:"popup-close-btn",onClick:_},{default:o((()=>[l(r,{type:"closeempty",size:"22",color:"#909399"})])),_:1})])),_:1}),l(h,{class:"popup-body"},{default:o((()=>[l(C,{class:"calendar-image",src:"https://picx.zhimg.com/80/v2-1c7d66141af0cd26e90ab42dda86acee.png",mode:"widthFix",onError:m,onLoad:g})])),_:1})])),_:1})])),_:1},512)}}},[["__scopeId","data-v-88342372"]]);function H(){const e=C(null),a=C(null),t=C({version:"6",title:"重要通知：请加用户群防走丢！",content:'<div style="line-height: 1.6;">\n            <p style="margin-bottom: 16rpx;">我们新增了用户QQ群，欢迎加入</p>\n            <p style="margin-bottom: 16rpx;">后期很有可能会推出QQ号强绑定，需要加群使用，请尽快加群，群额度有限</p>\n            <p style="margin-bottom: 16rpx; color: red;">仪表盘下方新增了分享本站功能，欢迎分享给朋友</p>\n            <p style="margin-bottom: 16rpx;">开发者今天心情糟糕，看见代码就烦了哈哈哈。本网站即将面临四个月的暂停开发，2025年12月后左右恢复开发进度</p>\n            <p style="margin-bottom: 16rpx; color: red;">开学快乐！</p>\n        </div>',timestamp:Date.now(),forceShow:!1}),o="notice_read_version",l=()=>{e.value&&e.value.openModal()},n=C(null),s=C([{text:"今日课表",description:"实时查看今日课表",icon:"calendar",url:"/pages/classtable/classtable"},{text:"成绩分析",description:"查看成绩与GPA分析",icon:"paperplane",url:"/pages/grades/grades"},{text:"平均分查询",description:"查看课程平均分数据",icon:"bars",url:"/pages/average-scores/average-scores"},{text:"选课推荐",description:"智能推荐选课方案",icon:"star",url:"https://doc.easy-qfnu.top/EasySelectCourse/CourseSelectionRecommendation/",external:!0},{text:"培养方案",description:"查看模块完成进度",icon:"list",url:"/pages/course-plan/course-plan"},{text:"选课查询",description:"支持选课模块探测",icon:"checkmarkempty",url:"/pages/pre-select-course/pre-select-course"},{text:"查看校历",description:"查看最新校历",icon:"calendar",url:"calendar",external:!1},{text:"排名查询",description:"即将推出",icon:"medal",url:""},{text:"更多功能",description:"敬请期待",icon:"gear",url:""}]),c=()=>{const e=I("token");if(!e)return k({title:"请先登录",icon:"none"}),void w({url:"/pages/index/index"});try{const a=Q(e);console.log("Token验证成功",a)}catch(a){return console.error("Token解析失败",a),L("token"),k({title:"凭证无效,请重新登录",icon:"none"}),void w({url:"/pages/index/index"})}},r=(e,a)=>{"undefined"!=typeof window?window.open(a,"_blank"):"undefined"!=typeof plus?plus.runtime.openURL(a):v({data:a,success:()=>k({title:"外链已复制,请在浏览器中打开",icon:"success",duration:3e3})})};return{noticeModalRef:e,calendarModalRef:a,profileCardRef:n,noticeData:t,features:s,openNoticeModal:l,handleNoticePopupChange:e=>{e.show||(b(o,t.value.version),console.log(`公告版本 ${t.value.version} 已通过关闭操作标记为已读。`))},handleNavigate:e=>{const t=s.value[e];t.url?"calendar"===t.url?a.value&&a.value.openModal():t.external?"undefined"!=typeof window?window.open(t.url,"_blank"):"undefined"!=typeof plus?plus.runtime.openURL(t.url):v({data:t.url,success:()=>k({title:"外链已复制,请在浏览器中打开",icon:"success",duration:3e3})}):x({url:t.url}):k({title:"功能正在开发中...",icon:"none"})},handleRefresh:()=>{n.value&&n.value.refreshProfile?n.value.refreshProfile():k({title:"刷新功能暂不可用",icon:"none"})},handleLogout:()=>{q({title:"确认退出",content:"确定要退出登录吗？",confirmColor:"#7F4515",success:e=>{e.confirm&&(L("token"),S.clearAllProfiles(),k({title:"已退出登录",icon:"success"}),setTimeout((()=>{w({url:"/pages/index/index"})}),1e3))}})},handleUserAgreement:()=>{r("用户协议","https://cq4hqujcxu3.feishu.cn/docx/EYE6d5ufAoQt5Axx7MFc4XMrnAf")},handleClearCache:()=>{q({title:"清除缓存",content:"确定要清除所有本地缓存数据吗？这将清除除登录凭证外的所有本地数据。",confirmText:"清除",cancelText:"取消",confirmColor:"#ff4d4f",success:e=>{if(e.confirm)try{const e=I("token");E(),e&&(b("token",e),S.clearProfile()),k({title:"缓存已清除",icon:"success",duration:2e3})}catch(a){k({title:"清除缓存失败",icon:"error"})}}})},handleChangelog:()=>{r("更新日志","https://cq4hqujcxu3.feishu.cn/docx/BO2od7OI8omtmTxGkB0cn305nFl")},handleContact:()=>{r("添加QQ好友","https://qm.qq.com/q/WBCJEU82A2")},handleFeedback:()=>{r("意见建议反馈","https://cq4hqujcxu3.feishu.cn/share/base/form/shrcnojLq3xgJ5m5Gzn5V87poHZ")},handleSponsorList:()=>{r("赞赏名单","https://cq4hqujcxu3.feishu.cn/docx/DE9Ed1l5iofB0exEYZncwMeenvd")},handleShareSite:()=>{v({data:"我发现一个超级好用的曲师大教务工具，你也来看看吧\n多维度成绩分析、历史平均分查询、选课推荐、培养方案解析、选课查询，各种功能~\n地址：https://easy-qfnu.top",success:()=>{k({title:"分享内容已复制到剪贴板",icon:"success",duration:2e3})},fail:()=>{k({title:"复制失败，请手动复制",icon:"none"})}})},handleImageError:()=>{k({title:"赞赏码加载失败",icon:"none"})},handleImageLoad:()=>{console.log("赞赏码加载成功")},handleCalendarImageError:()=>{k({title:"校历图片加载失败",icon:"none"})},handleCalendarImageLoad:()=>{console.log("校历图片加载成功")},initDashboard:()=>{D((()=>{c(),(()=>{const e=t.value,a=I(o);console.log(`当前公告版本: ${e.version}, 已读版本: ${a}`),(e.version!==a||e.forceShow)&&(console.log("检测到新公告或强制公告，准备弹窗。"),z((()=>{l()})))})(),console.log("用户进入仪表盘页面")})),N((()=>{I("token")&&c()}))}}}const Z=j({__name:"dashboard",setup(e){const{noticeModalRef:n,calendarModalRef:c,profileCardRef:r,noticeData:i,features:u,openNoticeModal:p,handleNoticePopupChange:f,handleNavigate:_,handleRefresh:m,handleLogout:g,handleUserAgreement:h,handleClearCache:C,handleChangelog:y,handleContact:b,handleFeedback:v,handleSponsorList:k,handleShareSite:x,handleImageError:q,handleImageLoad:L,handleCalendarImageError:w,handleCalendarImageLoad:I,initDashboard:E}=H();return E(),(e,E)=>{const z=d;return a(),t(z,{class:"user-profile-page-wrapper"},{default:o((()=>[l(M,null,{default:o((()=>[l(z,{class:"page-rounded-container"},{default:o((()=>[l(U,{ref_key:"profileCardRef",ref:r},null,512),l(G,{"notice-data":s(i),onClick:s(p)},null,8,["notice-data","onClick"]),l(T,{features:s(u),onNavigate:s(_)},null,8,["features","onNavigate"]),l(O,{onRefresh:s(m),onLogout:s(g),onUserAgreement:s(h),onClearCache:s(C),onChangelog:s(y),onContact:s(b),onFeedback:s(v),onSponsorList:s(k),onShareSite:s(x)},null,8,["onRefresh","onLogout","onUserAgreement","onClearCache","onChangelog","onContact","onFeedback","onSponsorList","onShareSite"]),l(J,{onImageError:s(q),onImageLoad:s(L)},null,8,["onImageError","onImageLoad"])])),_:1})])),_:1}),l(Y,{ref_key:"noticeModalRef",ref:n,"notice-data":s(i),onPopupChange:s(f)},null,8,["notice-data","onPopupChange"]),l($,{ref_key:"calendarModalRef",ref:c,onImageError:s(w),onImageLoad:s(I)},null,8,["onImageError","onImageLoad"])])),_:1})}}},[["__scopeId","data-v-f411414a"]]);export{Z as default};

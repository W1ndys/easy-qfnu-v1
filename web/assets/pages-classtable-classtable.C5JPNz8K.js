import{Z as e,r as t,o as a,c as s,w as l,a as c,b as r,t as n,k as u,h as o,q as i,f as d,i as f,d as _,A as y,m as p,F as k,N as g,j as b,H as m,u as w,D as v,G as h,E as D,B as $,a4 as j}from"./index-IhNxAD7G.js";import{_ as x,r as C,a as z,o as I,b as q}from"./uni-icons.By34-GEG.js";import{P as O}from"./PageLayout.Bgrs46Iu.js";import{L as S,E as M}from"./EmptyState.BudcrqLB.js";import{M as E}from"./ModernCard.CKE8hxFp.js";function B(e){e instanceof Date||(e=new Date(e));return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function T(e){const[t,a,s]=e.split("-").map(Number);return new Date(t,a-1,s)}function Y(){return B(new Date)}function A(e,t){const a=T(e);return a.setDate(a.getDate()+t),B(a)}function L(e){return e===Y()}const F={name:"DatePicker"},P=x(Object.assign(F,{props:{currentDate:{type:String,required:!0},weekInfo:{type:Object,default:null}},emits:["date-change"],setup(p,{emit:k}){const g=p,b=k,m=e((()=>{const e=new Date(g.currentDate);return`${e.getFullYear()}å¹´${e.getMonth()+1}æœˆ${e.getDate()}æ—¥ å‘¨${["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][e.getDay()]}`})),w=e((()=>L(g.currentDate)));function v(){i({title:"é€‰æ‹©æ—¥æœŸ",content:"ç‚¹å‡»ç¡®å®šæ‰“å¼€æ—¥æœŸé€‰æ‹©å™¨",success:e=>{e.confirm&&i({title:"è¾“å…¥æ—¥æœŸ",content:"è¯·è¾“å…¥æ—¥æœŸ(YYYY-MM-DDæ ¼å¼)",editable:!0,placeholderText:g.currentDate,success:e=>{if(e.confirm&&e.content){/^\d{4}-\d{2}-\d{2}$/.test(e.content)?b("date-change",e.content):d({title:"æ—¥æœŸæ ¼å¼é”™è¯¯",icon:"none"})}}})}})}function h(){b("date-change",Y())}function D(){const e=A(g.currentDate,-7);b("date-change",e)}function $(){const e=A(g.currentDate,7);b("date-change",e)}return(e,i)=>{const d=f,k=_,g=C(t("uni-icons"),z),b=y;return a(),s(E,{title:"ğŸ“… æ—¥æœŸé€‰æ‹©"},{default:l((()=>[c(k,{class:"date-picker-container"},{default:l((()=>[p.weekInfo?(a(),s(k,{key:0,class:"week-info"},{default:l((()=>[c(k,{class:"week-display"},{default:l((()=>[c(d,{class:"week-label"},{default:l((()=>[r("ç¬¬")])),_:1}),c(d,{class:"week-number"},{default:l((()=>[r(n(p.weekInfo.current_week),1)])),_:1}),c(d,{class:"week-label"},{default:l((()=>[r("å‘¨")])),_:1}),c(d,{class:"week-total"},{default:l((()=>[r("/"+n(p.weekInfo.total_weeks)+"å‘¨",1)])),_:1})])),_:1})])),_:1})):u("",!0),c(k,{class:"date-selector"},{default:l((()=>[c(k,{class:"date-display",onClick:v},{default:l((()=>[c(g,{type:"calendar",size:"20",color:"#7f4515"}),c(d,{class:"selected-date"},{default:l((()=>[r(n(m.value),1)])),_:1}),c(g,{type:"arrowdown",size:"16",color:"#999"})])),_:1}),c(k,{class:"quick-actions"},{default:l((()=>[c(b,{class:o(["quick-btn",{active:w.value}]),onClick:h},{default:l((()=>[c(g,{type:"location",size:"16",color:"#7f4515"}),c(d,null,{default:l((()=>[r("ä»Šå¤©")])),_:1})])),_:1},8,["class"]),c(b,{class:"quick-btn",onClick:D},{default:l((()=>[c(g,{type:"arrowleft",size:"16",color:"#666"}),c(d,null,{default:l((()=>[r("ä¸Šå‘¨")])),_:1})])),_:1}),c(b,{class:"quick-btn",onClick:$},{default:l((()=>[c(g,{type:"arrowright",size:"16",color:"#666"}),c(d,null,{default:l((()=>[r("ä¸‹å‘¨")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-a6602dc5"]]),G={name:"StatsCard"},H=x(Object.assign(G,{props:{stats:{type:Object,required:!0,default:()=>({total_courses:0,total_hours:0,courses_by_day:{}})}},setup(i){const d=i,y=e((()=>{if(!d.stats.total_courses)return 0;const e=Object.keys(d.stats.courses_by_day||{}).length;return e>0?Math.round(d.stats.total_courses/e*10)/10:0})),m=e((()=>d.stats.total_courses>0)),w=e((()=>{if(!d.stats.courses_by_day)return null;const e=Object.entries(d.stats.courses_by_day);if(0===e.length)return null;const t=e.reduce(((e,t)=>t[1]>e[1]?t:e));return t[1]>0?t[0]:null})),v=e((()=>{if(!d.stats.courses_by_day)return null;const e=Object.entries(d.stats.courses_by_day);if(0===e.length)return null;const t=e.reduce(((e,t)=>t[1]<e[1]?t:e));return 0===t[1]?t[0]:null})),h=e((()=>{if(!m.value)return null;const e=d.stats.total_courses;return e<=10?"è¯¾ç¨‹å®‰æ’è¾ƒè½»æ¾ ğŸ˜Š":e<=20?"è¯¾ç¨‹å®‰æ’é€‚ä¸­ ğŸ“š":"è¯¾ç¨‹å®‰æ’è¾ƒç´§å¯†ï¼Œæ³¨æ„ä¼‘æ¯ ğŸ’ª"}));function D(e){if(!d.stats.courses_by_day)return 0;const t=Math.max(...Object.values(d.stats.courses_by_day));if(0===t)return 0;return 20+e/t*100}return(e,d)=>{const $=C(t("uni-icons"),z),j=_,x=f;return a(),s(E,{title:"ğŸ“Š æœ¬å‘¨ç»Ÿè®¡"},{default:l((()=>[c(j,{class:"stats-container"},{default:l((()=>[c(j,{class:"stats-overview"},{default:l((()=>[c(j,{class:"stat-item"},{default:l((()=>[c(j,{class:"stat-icon"},{default:l((()=>[c($,{type:"calendar-filled",size:"24",color:"#7f4515"})])),_:1}),c(j,{class:"stat-content"},{default:l((()=>[c(x,{class:"stat-value"},{default:l((()=>[r(n(i.stats.total_courses),1)])),_:1}),c(x,{class:"stat-label"},{default:l((()=>[r("æ€»è¯¾ç¨‹æ•°")])),_:1})])),_:1})])),_:1}),c(j,{class:"stat-item"},{default:l((()=>[c(j,{class:"stat-icon"},{default:l((()=>[c($,{type:"clock-filled",size:"24",color:"#e74c3c"})])),_:1}),c(j,{class:"stat-content"},{default:l((()=>[c(x,{class:"stat-value"},{default:l((()=>[r(n(i.stats.total_hours),1)])),_:1}),c(x,{class:"stat-label"},{default:l((()=>[r("æ€»è¯¾æ—¶")])),_:1})])),_:1})])),_:1}),c(j,{class:"stat-item"},{default:l((()=>[c(j,{class:"stat-icon"},{default:l((()=>[c($,{type:"heart-filled",size:"24",color:"#27ae60"})])),_:1}),c(j,{class:"stat-content"},{default:l((()=>[c(x,{class:"stat-value"},{default:l((()=>[r(n(y.value),1)])),_:1}),c(x,{class:"stat-label"},{default:l((()=>[r("æ—¥å‡è¯¾ç¨‹")])),_:1})])),_:1})])),_:1})])),_:1}),i.stats.courses_by_day?(a(),s(j,{key:0,class:"daily-distribution"},{default:l((()=>[c(x,{class:"section-title"},{default:l((()=>[r("ğŸ“… æ¯æ—¥è¯¾ç¨‹åˆ†å¸ƒ")])),_:1}),c(j,{class:"daily-chart"},{default:l((()=>[(a(!0),p(k,null,g(i.stats.courses_by_day,((e,t)=>(a(),s(j,{key:t,class:"daily-bar-container"},{default:l((()=>[c(j,{class:"day-label"},{default:l((()=>{return[r(n((e=t,{"æ˜ŸæœŸä¸€":"ä¸€","æ˜ŸæœŸäºŒ":"äºŒ","æ˜ŸæœŸä¸‰":"ä¸‰","æ˜ŸæœŸå››":"å››","æ˜ŸæœŸäº”":"äº”","æ˜ŸæœŸå…­":"å…­","æ˜ŸæœŸæ—¥":"æ—¥"}[e]||e)),1)];var e})),_:2},1024),c(j,{class:"bar-wrapper"},{default:l((()=>[c(j,{class:o(["daily-bar",{"has-course":e>0}]),style:b({height:D(e)+"rpx"})},null,8,["style","class"])])),_:2},1024),c(x,{class:"course-count"},{default:l((()=>[r(n(e),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):u("",!0),m.value?(a(),s(j,{key:1,class:"time-tips"},{default:l((()=>[c(x,{class:"tips-title"},{default:l((()=>[r("ğŸ’¡ æ—¶é—´åˆ†å¸ƒæç¤º")])),_:1}),c(j,{class:"tips-content"},{default:l((()=>[w.value?(a(),s(x,{key:0,class:"tip-item"},{default:l((()=>[r("æœ€å¿™ç¢Œï¼š"+n(w.value),1)])),_:1})):u("",!0),v.value?(a(),s(x,{key:1,class:"tip-item"},{default:l((()=>[r("æœ€æ¸…é—²ï¼š"+n(v.value),1)])),_:1})):u("",!0),h.value?(a(),s(x,{key:2,class:"tip-item"},{default:l((()=>[r(n(h.value),1)])),_:1})):u("",!0)])),_:1})])),_:1})):u("",!0)])),_:1})])),_:1})}}}),[["__scopeId","data-v-6993c31f"]]),N={name:"CourseCard"},R=x(Object.assign(N,{props:{course:{type:Object,required:!0},compact:{type:Boolean,default:!1},showBadges:{type:Boolean,default:!0}},emits:["course-click","course-long-press"],setup(o,{emit:i}){const d=o,y=i,p=e((()=>{var e,t;const a={backgroundColor:(null==(e=d.course.style)?void 0:e.color)||"#3498db",borderLeft:`4rpx solid ${(null==(t=d.course.style)?void 0:t.color)||"#3498db"}`};return d.compact&&(a.padding="8rpx",a.minHeight="60rpx"),a})),k=e((()=>{var e;return h(null==(e=d.course.style)?void 0:e.color)?"#666":"rgba(255,255,255,0.8)"}));e((()=>{var e;return h(null==(e=d.course.style)?void 0:e.color)?"#333":"#fff"}));const g=e((()=>d.course.weeks&&d.course.weeks.length>1));function m(){y("course-click",d.course)}function w(){y("course-long-press",d.course)}function v(){if(!d.course.weeks)return"";const e=d.course.weeks;return e.length<=3?`ç¬¬${e.join(",")}å‘¨`:`ç¬¬${e[0]}-${e[e.length-1]}å‘¨`}function h(e){if(!e)return!0;const t=e.replace("#","");return(299*parseInt(t.substr(0,2),16)+587*parseInt(t.substr(2,2),16)+114*parseInt(t.substr(4,2),16))/1e3>128}return(e,i)=>{const d=f,y=C(t("uni-icons"),z),h=_;return a(),s(h,{class:"course-card",style:b(p.value),onClick:m,onLongpress:w},{default:l((()=>[c(d,{class:"course-name"},{default:l((()=>[r(n(o.course.name),1)])),_:1}),c(h,{class:"course-info"},{default:l((()=>[o.course.teacher?(a(),s(h,{key:0,class:"info-row"},{default:l((()=>[c(y,{type:"person",size:"12",color:k.value},null,8,["color"]),c(d,{class:"info-text"},{default:l((()=>[r(n(o.course.teacher),1)])),_:1})])),_:1})):u("",!0),o.course.location?(a(),s(h,{key:1,class:"info-row"},{default:l((()=>[c(y,{type:"location",size:"12",color:k.value},null,8,["color"]),c(d,{class:"info-text"},{default:l((()=>{return[r(n((e=o.course.location,e?e.replace(/å®éªŒå®¤/g,"å®¤").substring(0,8):"")),1)];var e})),_:1})])),_:1})):u("",!0),o.course.time_info?(a(),s(h,{key:2,class:"info-row"},{default:l((()=>[c(y,{type:"clock",size:"12",color:k.value},null,8,["color"]),c(d,{class:"info-text"},{default:l((()=>[r(n(o.course.time_info.start_time)+"-"+n(o.course.time_info.end_time),1)])),_:1})])),_:1})):u("",!0)])),_:1}),o.showBadges?(a(),s(h,{key:0,class:"course-badges"},{default:l((()=>{return[o.course.course_type?(a(),s(d,{key:0,class:"course-badge type-badge",style:b({background:(e=o.course.course_type,{"å¿…ä¿®":"#e74c3c","é€‰ä¿®":"#3498db","ä»»é€‰":"#27ae60","é™é€‰":"#f39c12","å®è·µ":"#9b59b6"}[e]||"#95a5a6")})},{default:l((()=>[r(n(o.course.course_type),1)])),_:1},8,["style"])):u("",!0),o.course.credits?(a(),s(d,{key:1,class:"course-badge credits-badge"},{default:l((()=>[r(n(o.course.credits)+"å­¦åˆ† ",1)])),_:1})):u("",!0)];var e})),_:1})):u("",!0),g.value?(a(),s(h,{key:1,class:"week-indicator"},{default:l((()=>[c(d,{class:"week-text"},{default:l((()=>[r(n(v()),1)])),_:1})])),_:1})):u("",!0)])),_:1},8,["style"])}}}),[["__scopeId","data-v-3b72fdf3"]]),U={name:"WeeklyTable"},W=x(Object.assign(U,{props:{timeSlots:{type:Array,required:!0,default:()=>[]},weekdays:{type:Array,required:!0,default:()=>[]},courses:{type:Array,required:!0,default:()=>[]},currentDate:{type:String,default:()=>Y()}},emits:["course-click"],setup(i,{emit:d}){const y=i,b=d,m=e((()=>y.courses.length>0)),w=e((()=>function(e){const t=T(e),a=t.getDay(),s=new Date(t);s.setDate(t.getDate()-(0===a?6:a-1));const l=[];for(let c=0;c<7;c++){const e=new Date(s);e.setDate(s.getDate()+c),l.push(B(e))}return l}(y.currentDate)));function v(e){const t=new Date;return e===(0===t.getDay()?7:t.getDay())&&L(y.currentDate)}function h(e){if(!w.value||0===w.value.length)return"";const t=e-1;if(t<0||t>=w.value.length)return"";const a=new Date(w.value[t]);return`${a.getMonth()+1}/${a.getDate()}`}function D(e){b("course-click",e)}return(e,d)=>{const b=_,w=f,$=C(t("uni-icons"),z);return a(),s(E,{title:"ğŸ“š æœ¬å‘¨è¯¾ç¨‹è¡¨"},{default:l((()=>[c(b,{class:"weekly-table-container"},{default:l((()=>[c(b,{class:"table-header"},{default:l((()=>[c(b,{class:"time-column-header"},{default:l((()=>[r("æ—¶é—´")])),_:1}),c(b,{class:"weekday-headers"},{default:l((()=>[(a(!0),p(k,null,g(i.weekdays,(e=>(a(),s(b,{key:e.id,class:o(["weekday-header",{today:v(e.id)}])},{default:l((()=>[c(w,{class:"weekday-name"},{default:l((()=>[r(n(e.short),1)])),_:2},1024),c(w,{class:"weekday-date"},{default:l((()=>[r(n(h(e.id)),1)])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1})])),_:1}),c(b,{class:"table-body"},{default:l((()=>[(a(!0),p(k,null,g(i.timeSlots,(e=>(a(),s(b,{key:e.period,class:"time-row"},{default:l((()=>[c(b,{class:"time-column"},{default:l((()=>[c(w,{class:"period-name"},{default:l((()=>[r(n(e.name),1)])),_:2},1024),c(w,{class:"time-range"},{default:l((()=>[r(n(e.time),1)])),_:2},1024)])),_:2},1024),c(b,{class:"course-columns"},{default:l((()=>[(a(!0),p(k,null,g(i.weekdays,(t=>(a(),s(b,{key:`${e.period}-${t.id}`,class:o(["course-cell",{today:v(t.id)}])},{default:l((()=>{return[(a(!0),p(k,null,g((l=e.period,c=t.id,y.courses.filter((e=>e.time_info.period===l&&e.time_info.weekday===c))),(e=>(a(),s(R,{key:e.id,course:e,onCourseClick:D},null,8,["course"])))),128))];var l,c})),_:2},1032,["class"])))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1}),m.value?u("",!0):(a(),s(b,{key:0,class:"empty-table"},{default:l((()=>[c($,{type:"calendar",size:"48",color:"#ccc"}),c(w,{class:"empty-text"},{default:l((()=>[r("æœ¬å‘¨æš‚æ— è¯¾ç¨‹å®‰æ’")])),_:1})])),_:1}))])),_:1})])),_:1})}}}),[["__scopeId","data-v-aa1a22dc"]]);const Z=new class{async getClassTable(e=null){const t=v("token");if(!t)throw new Error("æœªç™»å½•");const a=`${w().globalData.apiBaseURL}/api/v1/classtable${e?`?date=${e}`:""}`;try{const{statusCode:e,data:s}=await m({url:a,method:"GET",header:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});return function(e,t){if(200!==e||!t.success&&200!==t.code)throw 401===e?(h("token"),d({title:"ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•",icon:"none"}),setTimeout((()=>D({url:"/pages/index/index"})),1500),new Error("ç™»å½•å·²è¿‡æœŸ")):new Error(t.detail||t.message||"è¯·æ±‚å¤±è´¥");return t.data}(e,s)}catch(s){throw console.error("è·å–è¯¾ç¨‹è¡¨å¤±è´¥:",s),new Error(s.message||"ç½‘ç»œè¿æ¥å¤±è´¥")}}},J=x({__name:"classtable",setup(t){const n=$(!0),u=$(null),o=$(B(new Date)),i=e((()=>!!u.value));function y(){return!!v("token")||(d({title:"è¯·å…ˆç™»å½•",icon:"none"}),D({url:"/pages/index/index"}),!1)}async function p(e=o.value){n.value=!0;try{const t=await Z.getClassTable(e);u.value=t}catch(t){console.error("è·å–è¯¾ç¨‹è¡¨å¤±è´¥",t),d({title:t.message||"è·å–è¯¾ç¨‹è¡¨å¤±è´¥",icon:"none"}),u.value=null}finally{n.value=!1}}function k(e){o.value=e,p(e)}return I((()=>{y()&&(j({title:"è¯¾ç¨‹è¡¨"}),p())})),q((()=>{y()})),(e,t)=>{const d=_,y=f;return a(),s(O,null,{default:l((()=>[n.value?(a(),s(S,{key:0,text:"æ­£åœ¨åŠ è½½è¯¾ç¨‹è¡¨..."})):(a(),s(d,{key:1,class:"page-container page-rounded-container"},{default:l((()=>[c(d,{class:"background-decoration"},{default:l((()=>[c(d,{class:"circle circle-1"}),c(d,{class:"circle circle-2"}),c(d,{class:"circle circle-3"})])),_:1}),c(d,{class:"page-header"},{default:l((()=>[c(d,{class:"header-content"},{default:l((()=>[c(y,{class:"page-title"},{default:l((()=>[r("è¯¾ç¨‹è¡¨")])),_:1}),c(y,{class:"page-subtitle"},{default:l((()=>[r("Class Schedule")])),_:1})])),_:1})])),_:1}),c(d,{class:"content-wrapper"},{default:l((()=>[i.value?(a(),s(d,{key:1},{default:l((()=>[c(P,{"current-date":o.value,"week-info":u.value.week_info,onDateChange:k},null,8,["current-date","week-info"]),c(H,{stats:u.value.stats},null,8,["stats"]),c(W,{"time-slots":u.value.time_slots,weekdays:u.value.weekdays,courses:u.value.courses},null,8,["time-slots","weekdays","courses"])])),_:1})):(a(),s(M,{key:0,"icon-type":"calendar",title:"æš‚æ— è¯¾ç¨‹è¡¨æ•°æ®",description:"è¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åé‡è¯•","show-retry":!0,onRetry:p}))])),_:1})])),_:1}))])),_:1})}}},[["__scopeId","data-v-166a3ce7"]]);export{J as default};

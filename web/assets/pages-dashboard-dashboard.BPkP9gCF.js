import{B as e,L as a,o as t,c as s,w as l,a as o,h as n,b as c,t as r,D as u,u as i,J as d,f as p,G as f,E as _,M as m,N as g,g as v,d as y,i as h,r as b,m as x,F as k,O as C,k as q,A as w,P as z,Q as j,K as P,n as E,q as L,R as A,e as F}from"./index-D8yv_xul.js";import{_ as M,r as I,a as B,o as S,b as D}from"./uni-icons.BY9klwmG.js";import{d as R}from"./jwt-decode.B4TtOsy8.js";import{P as G}from"./PageLayout.CXkp7fYO.js";import{M as Q}from"./ModernCard.BUm7qDRD.js";import{P as N}from"./ProfileAPI.B09f8lO9.js";import{_ as O}from"./uni-popup.BBLr9W1q.js";const T=M({__name:"ProfileCard",setup(b,{expose:x}){const k=e({student_name:"W1ndys",student_id:"加载中...",college:"曲奇学院",major:"曲奇专业",class_name:"22曲奇班"}),C=e(!1),q=async()=>{const e=u("token");if(!e)return void console.warn("未找到登录凭证");C.value=!0;const a=i().globalData.apiBaseURL;try{const t=await new Promise(((t,s)=>{d({url:`${a}/api/v1/profile`,method:"GET",header:{Authorization:`Bearer ${e}`},success:t,fail:s})}));if(200===t.statusCode&&t.data.success){const a=t.data.data,s=a.student_id||(()=>{try{return R(e).sub}catch(a){return console.error("Token解析失败",a),k.value.student_id}})();k.value={student_name:a.student_name||k.value.student_name,student_id:s,college:a.college||k.value.college,major:a.major||k.value.major,class_name:a.class_name||k.value.class_name},N.save(k.value),console.log("用户资料获取成功",k.value)}else{const e=t.data.message||`获取信息失败 (${t.statusCode})`;console.error("获取用户资料失败",e),p({title:e,icon:"none"}),401===t.statusCode&&(f("token"),setTimeout((()=>{_({url:"/pages/index/index"})}),1500))}}catch(t){console.error("获取个人信息请求失败",t),p({title:"网络请求失败，请稍后重试",icon:"none"})}finally{C.value=!1}},w=()=>{if(!u("token"))return void N.clearAll();N.isValid()||N.clear();(()=>{const e=N.get();return!!e&&(k.value={...e},!0)})()?"W1ndys"!==k.value.student_name&&"加载中..."!==k.value.student_id||(console.log("缓存数据不完整，从服务器重新获取"),q()):(console.log("缓存不可用，从服务器获取个人信息"),q())};return a((()=>{w()})),x({refreshProfile:async()=>{m({title:"正在刷新..."});try{await q(),p({title:"资料已刷新",icon:"success"})}finally{g()}},fetchProfile:q,profile:k,clearProfile:N.clear,clearAllProfiles:N.clearAll}),(e,a)=>{const u=v,i=y,d=h;return t(),s(Q,{class:"profile-card",highlight:""},{default:l((()=>[o(i,{class:n(["profile-content",{loading:C.value}])},{default:l((()=>[o(i,{class:"identity-section"},{default:l((()=>[o(i,{class:"avatar-wrapper"},{default:l((()=>[o(u,{class:"avatar",src:"https://pic1.zhimg.com/80/v2-82c1c70c69720aadac79594ea50ed4a7.png",mode:"aspectFit"}),o(i,{class:n(["status-indicator",{"loading-pulse":C.value}])},null,8,["class"])])),_:1}),o(i,{class:"identity-info"},{default:l((()=>[o(d,{class:"welcome-text"},{default:l((()=>[c("欢迎回来~")])),_:1}),o(d,{class:"user-name"},{default:l((()=>[c(r(k.value.student_name),1)])),_:1}),o(d,{class:"user-id"},{default:l((()=>[c(r(k.value.student_id),1)])),_:1})])),_:1})])),_:1}),o(i,{class:"details-section"},{default:l((()=>[o(i,{class:"detail-item"},{default:l((()=>[o(d,{class:"detail-label"},{default:l((()=>[c("学院")])),_:1}),o(d,{class:"detail-value"},{default:l((()=>[c(r(k.value.college),1)])),_:1})])),_:1}),o(i,{class:"detail-item"},{default:l((()=>[o(d,{class:"detail-label"},{default:l((()=>[c("专业")])),_:1}),o(d,{class:"detail-value"},{default:l((()=>[c(r(k.value.major),1)])),_:1})])),_:1}),o(i,{class:"detail-item"},{default:l((()=>[o(d,{class:"detail-label"},{default:l((()=>[c("班级")])),_:1}),o(d,{class:"detail-value"},{default:l((()=>[c(r(k.value.class_name),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["class"])])),_:1})}}},[["__scopeId","data-v-321b1fb2"]]),U=M({__name:"NoticeBar",props:{noticeData:{type:Object,required:!0,default:()=>({title:"重要通知：请加用户群防走丢！"})}},emits:["click"],setup(e,{emit:a}){const n=a,u=()=>{n("click")};return(a,n)=>{const i=I(b("uni-icons"),B),d=h,p=y;return t(),s(p,{class:"notice-bar",onClick:u},{default:l((()=>[o(i,{class:"notice-icon",type:"sound",size:"20",color:"#FF6B35"}),o(d,{class:"notice-text"},{default:l((()=>[c(r(e.noticeData.title),1)])),_:1}),o(i,{type:"right",size:"16",color:"#C0C4CC"})])),_:1})}}},[["__scopeId","data-v-54a5bb78"]]),J=M({__name:"FeatureGrid",props:{features:{type:Array,required:!0,default:()=>[]}},emits:["navigate"],setup(e,{emit:a}){const u=a;return(a,i)=>{const d=y,p=I(b("uni-icons"),B),f=h;return t(),s(Q,{class:"grid-card"},{default:l((()=>[o(d,{class:"grid-title"},{default:l((()=>[c("核心功能")])),_:1}),o(d,{class:"grid-2x2"},{default:l((()=>[(t(!0),x(k,null,C(e.features,((e,a)=>(t(),s(d,{key:a,class:n(["grid-cell",{disabled:!e.url}]),onClick:e=>(e=>{u("navigate",e)})(a)},{default:l((()=>[o(d,{class:"cell-icon"},{default:l((()=>[o(p,{type:e.icon,size:"30",color:e.url?"#7F4515":"#C0C6CF"},null,8,["type","color"])])),_:2},1024),o(f,{class:"cell-title"},{default:l((()=>[c(r(e.text),1)])),_:2},1024),e.description?(t(),s(f,{key:0,class:"cell-desc"},{default:l((()=>[c(r(e.description),1)])),_:2},1024)):q("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})}}},[["__scopeId","data-v-24c1381c"]]),W=M({__name:"SystemActions",emits:["refresh","logout","userAgreement","clearCache","changelog","contact","feedback","sponsorList","shareSite"],setup(e,{emit:a}){const n=a,r=()=>n("refresh"),u=()=>n("logout"),i=()=>n("userAgreement"),d=()=>n("clearCache"),p=()=>n("changelog"),f=()=>n("contact"),_=()=>n("feedback"),m=()=>n("sponsorList"),g=()=>n("shareSite");return(e,a)=>{const n=I(b("uni-icons"),B),v=h,x=w,k=y;return t(),s(Q,{title:"系统操作"},{default:l((()=>[o(k,{class:"quick-actions"},{default:l((()=>[o(x,{class:"action-btn btn-primary",onClick:r},{default:l((()=>[o(n,{type:"refresh",size:"20"}),o(v,null,{default:l((()=>[c("刷新数据")])),_:1})])),_:1}),o(x,{class:"action-btn btn-danger",onClick:u},{default:l((()=>[o(n,{type:"closeempty",size:"20"}),o(v,null,{default:l((()=>[c("退出登录")])),_:1})])),_:1}),o(x,{class:"action-btn btn-secondary",onClick:i},{default:l((()=>[o(n,{type:"paperplane",size:"20"}),o(v,null,{default:l((()=>[c("用户协议")])),_:1})])),_:1}),o(x,{class:"action-btn btn-danger",onClick:d},{default:l((()=>[o(n,{type:"trash",size:"20"}),o(v,null,{default:l((()=>[c("清除缓存")])),_:1})])),_:1}),o(x,{class:"action-btn btn-secondary",onClick:p},{default:l((()=>[o(n,{type:"list",size:"20"}),o(v,null,{default:l((()=>[c("更新日志")])),_:1})])),_:1}),o(x,{class:"action-btn btn-secondary",onClick:f},{default:l((()=>[o(n,{type:"chatbubble",size:"20"}),o(v,null,{default:l((()=>[c("联系作者")])),_:1})])),_:1}),o(x,{class:"action-btn btn-secondary",onClick:_},{default:l((()=>[o(n,{type:"compose",size:"20"}),o(v,null,{default:l((()=>[c("意见建议")])),_:1})])),_:1}),o(x,{class:"action-btn btn-secondary",onClick:m},{default:l((()=>[o(n,{type:"heart",size:"20"}),o(v,null,{default:l((()=>[c("赞赏名单")])),_:1})])),_:1}),o(x,{class:"action-btn btn-secondary",onClick:g},{default:l((()=>[o(n,{type:"redo",size:"20"}),o(v,null,{default:l((()=>[c("分享本站")])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-85bc15ff"]]),Y=M({__name:"SupportCard",emits:["imageError","imageLoad"],setup(e,{emit:a}){const n=a,r=()=>{n("imageError")},u=()=>{n("imageLoad")};return(e,a)=>{const n=h,i=y,d=v;return t(),s(Q,{title:"支持开发",class:"support-card"},{default:l((()=>[o(i,{class:"support-content"},{default:l((()=>[o(i,{class:"support-text"},{default:l((()=>[o(n,{class:"support-title"},{default:l((()=>[c("助力项目发展")])),_:1}),o(n,{class:"support-desc"},{default:l((()=>[c("本服务完全免费使用，服务器每日支出约为7元左右（选课高峰期翻2-3倍），以及前期服务器设备等支出几百依赖作者个人支出。如果想支持作者助力开发维护，欢迎赞赏~")])),_:1})])),_:1}),o(i,{class:"qr-code-container"},{default:l((()=>[o(d,{class:"qr-code",src:"https://picx.zhimg.com/80/v2-076422270c197b0031c609e47be2e36c_720w.png?source=d16d100b",mode:"aspectFit",onError:r,onLoad:u}),o(n,{class:"qr-code-label"},{default:l((()=>[c("微信赞赏")])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-8bf29636"]]),$=M({__name:"NoticeModal",props:{noticeData:{type:Object,required:!0,default:()=>({content:"",version:"1"})}},emits:["close","popupChange"],setup(a,{expose:n,emit:r}){const u=r,i=e(null),d=()=>{i.value&&i.value.close()},p=e=>{u("popupChange",e)},f=()=>{window.open("https://qm.qq.com/q/jKCk6GtL1e","_blank")},_=()=>{window.open("https://qm.qq.com/q/BBYFdHBDEc","_blank")};return n({openModal:()=>{i.value&&i.value.open()},closeNoticeModal:d}),(e,n)=>{const r=h,u=I(b("uni-icons"),B),m=y,g=z,v=w,x=I(b("uni-popup"),O);return t(),s(x,{ref_key:"noticePopup",ref:i,type:"center",onChange:p},{default:l((()=>[o(m,{class:"popup-content"},{default:l((()=>[o(m,{class:"popup-header"},{default:l((()=>[o(r,{class:"popup-title"},{default:l((()=>[c("公告详情")])),_:1}),o(m,{class:"popup-close-btn",onClick:d},{default:l((()=>[o(u,{type:"closeempty",size:"22",color:"#909399"})])),_:1})])),_:1}),o(m,{class:"popup-body"},{default:l((()=>[o(g,{class:"status-text",nodes:a.noticeData.content},null,8,["nodes"]),o(m,{class:"community-content-wrapper"},{default:l((()=>[o(m,{class:"community-groups"},{default:l((()=>[o(m,{class:"group-item"},{default:l((()=>[o(m,{class:"group-info"},{default:l((()=>[o(m,{class:"group-name"},{default:l((()=>[o(u,{type:"sound",size:"20",color:"#7F4515"}),o(r,{class:"group-title"},{default:l((()=>[c("官方消息群")])),_:1})])),_:1}),o(r,{class:"group-desc"},{default:l((()=>[c("获取最新消息和通知")])),_:1})])),_:1}),o(v,{class:"popup-action-btn",onClick:f},{default:l((()=>[o(u,{type:"copy",size:"16",color:"#7F4515"}),o(r,null,{default:l((()=>[c("加入群聊")])),_:1})])),_:1})])),_:1}),o(m,{class:"group-item"},{default:l((()=>[o(m,{class:"group-info"},{default:l((()=>[o(m,{class:"group-name"},{default:l((()=>[o(u,{type:"star",size:"20",color:"#7F4515"}),o(r,{class:"group-title"},{default:l((()=>[c("开发交流群")])),_:1})])),_:1}),o(r,{class:"group-desc"},{default:l((()=>[c("建议反馈、开发想法交流")])),_:1})])),_:1}),o(v,{class:"popup-action-btn",onClick:_},{default:l((()=>[o(u,{type:"copy",size:"16",color:"#7F4515"}),o(r,null,{default:l((()=>[c("加入群聊")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},512)}}},[["__scopeId","data-v-1f2ce7a2"]]),H=M({__name:"CalendarModal",emits:["imageError","imageLoad"],setup(a,{expose:n,emit:r}){const u=r,i=e(null),d=()=>{i.value&&i.value.close()},p=()=>{u("imageError")},f=()=>{u("imageLoad")};return n({openModal:()=>{i.value&&i.value.open()},closeCalendarModal:d}),(e,a)=>{const n=h,r=I(b("uni-icons"),B),u=y,_=v,m=I(b("uni-popup"),O);return t(),s(m,{ref_key:"calendarPopup",ref:i,type:"center"},{default:l((()=>[o(u,{class:"popup-content calendar-popup"},{default:l((()=>[o(u,{class:"popup-header"},{default:l((()=>[o(n,{class:"popup-title"},{default:l((()=>[c("校历")])),_:1}),o(u,{class:"popup-close-btn",onClick:d},{default:l((()=>[o(r,{type:"closeempty",size:"22",color:"#909399"})])),_:1})])),_:1}),o(u,{class:"popup-body"},{default:l((()=>[o(_,{class:"calendar-image",src:"https://picx.zhimg.com/80/v2-1c7d66141af0cd26e90ab42dda86acee.png",mode:"widthFix",onError:p,onLoad:f})])),_:1})])),_:1})])),_:1},512)}}},[["__scopeId","data-v-ae9d0b01"]]),K=M({__name:"dashboard",setup(a){const n=e(null),c=e(null),r=e(null),i=e({version:"7",title:"重要通知：请加用户群防走丢！",content:'<div style="line-height: 1.6;">\n            <p style="margin-bottom: 16rpx;">我们新增了用户QQ群，欢迎加入</p>\n            <p style="margin-bottom: 16rpx;">后期很有可能会推出QQ号强绑定，需要加群使用，请尽快加群，群额度有限</p>\n            <p style="margin-bottom: 16rpx; color: red;">仪表盘下方新增了分享本站功能，欢迎分享给朋友</p>\n            <p style="margin-bottom: 16rpx;">时间紧张，本网站即将面临四个月的暂停开发，2025年12月后左右恢复开发进度</p>\n            <p style="margin-bottom: 16rpx; color: red;">开学快乐！</p>\n        </div>',timestamp:Date.now(),forceShow:!1}),d=()=>{n.value&&n.value.openModal()},m=e=>{e.show||P("notice_read_version",i.value.version)},g=e([{text:"今日课表",description:"实时查看今日课表",icon:"calendar",url:"/pages/classtable/classtable"},{text:"成绩分析",description:"查看成绩与GPA分析",icon:"paperplane",url:"/pages/grades/grades"},{text:"平均分查询",description:"查看课程平均分数据",icon:"bars",url:"/pages/average-scores/average-scores"},{text:"选课推荐",description:"智能推荐选课方案",icon:"star",url:"https://doc.easy-qfnu.top/EasySelectCourse/CourseSelectionRecommendation/",external:!0},{text:"培养方案",description:"查看模块完成进度",icon:"list",url:"/pages/course-plan/course-plan"},{text:"选课查询",description:"支持选课模块探测",icon:"checkmarkempty",url:"/pages/pre-select-course/pre-select-course"},{text:"查看校历",description:"查看最新校历",icon:"calendar",url:"calendar",external:!1},{text:"无课教室",description:"查询空闲教室",icon:"home",url:""},{text:"无考教室",description:"查询无考试教室",icon:"compose",url:""},{text:"排名查询",description:"即将推出",icon:"medal",url:""},{text:"更多功能",description:"敬请期待",icon:"gear",url:""}]),v=()=>{const e=u("token");if(e)try{R(e)}catch(a){f("token"),_({url:"/pages/index/index"})}else _({url:"/pages/index/index"})},h=e=>{const a=g.value[e];"calendar"===a.url?c.value.openModal():a.external?C(a.url):a.url?E({url:a.url}):p({title:"功能正在开发中...",icon:"none"})},b=()=>{r.value&&r.value.refreshProfile()},x=()=>{L({title:"确认退出",content:"确定要退出登录吗？",success:e=>{e.confirm&&(f("token"),r.value&&r.value.clearAllProfiles(),_({url:"/pages/index/index"}))}})},k=()=>{L({title:"清除缓存",content:"确定要清除所有本地缓存数据吗？",success:e=>{if(e.confirm){const e=u("token");A(),e&&P("token",e),r.value&&r.value.clearProfile(),p({title:"缓存已清除",icon:"success"})}}})},C=e=>{"undefined"!=typeof window?window.open(e,"_blank"):"undefined"!=typeof plus?plus.runtime.openURL(e):F({data:e,success:()=>{p({title:"外链已复制,请在浏览器中打开",icon:"success",duration:3e3})}})},q=()=>C("https://cq4hqujcxu3.feishu.cn/docx/EYE6d5ufAoQt5Axx7MFc4XMrnAf"),w=()=>C("https://cq4hqujcxu3.feishu.cn/docx/BO2od7OI8omtmTxGkB0cn305nFl"),z=()=>C("https://qm.qq.com/q/WBCJEU82A2"),M=()=>C("https://cq4hqujcxu3.feishu.cn/share/base/form/shrcnojLq3xgJ5m5Gzn5V87poHZ"),I=()=>C("https://cq4hqujcxu3.feishu.cn/docx/DE9Ed1l5iofB0exEYZncwMeenvd"),B=()=>{F({data:"我发现一个超级好用的曲师大教务工具... https://easy-qfnu.top"})},Q=()=>{},N=()=>{},O=()=>{},K=()=>{};return S((()=>{v(),(()=>{const e=i.value,a=u("notice_read_version");(e.version!==a||e.forceShow)&&j((()=>d()))})()})),D((()=>{v()})),(e,a)=>{const u=y;return t(),s(u,{class:"user-profile-page-wrapper"},{default:l((()=>[o(G,null,{default:l((()=>[o(u,{class:"page-rounded-container"},{default:l((()=>[o(T,{ref_key:"profileCardRef",ref:r},null,512),o(U,{"notice-data":i.value,onClick:d},null,8,["notice-data"]),o(J,{features:g.value,onNavigate:h},null,8,["features"]),o(W,{onRefresh:b,onLogout:x,onUserAgreement:q,onClearCache:k,onChangelog:w,onContact:z,onFeedback:M,onSponsorList:I,onShareSite:B}),o(Y,{onImageError:Q,onImageLoad:N})])),_:1})])),_:1}),o($,{ref_key:"noticeModalRef",ref:n,"notice-data":i.value,onPopupChange:m},null,8,["notice-data"]),o(H,{ref_key:"calendarModalRef",ref:c,onImageError:O,onImageLoad:K},null,512)])),_:1})}}},[["__scopeId","data-v-1df7ba85"]]);export{K as default};

import{B as e,W as a,C as t,r as s,o as l,c,w as o,a as n,b as u,t as r,m as d,F as i,N as f,h as p,Q as _,A as v,i as y,d as g,S as m,a3 as h,k as w,a2 as D,D as k,f as S,E as b,u as C,H as x,G as T,Z as I,_ as O}from"./index-DRRtI3zw.js";import{_ as z,r as $,a as E,o as j,b as B}from"./uni-icons.Duv91yTK.js";import{P as M}from"./PageLayout.BKoCp8Cn.js";import{L}from"./LoadingScreen.BL2JI6Cd.js";import{_ as q}from"./uni-popup.V88Gx6qN.js";const A=z({__name:"DateNavigator",props:{selectedDate:{type:String,required:!0}},emits:["dateChange"],setup(w,{expose:D,emit:k}){const S=w,b=k,C=e(7),x=e([]),T=e(null),I=a((()=>0===x.value.length?{day:"",month:"",weekday:""}:x.value[C.value]||{day:"",month:"",weekday:""})),O=a((()=>{const e=C.value,a=Math.max(0,e-5),t=Math.min(x.value.length,e+6);return x.value.slice(a,t)})),z=a((()=>{const e=C.value;return e-Math.max(0,e-5)}));function j(e=null){const a=[],t=e?new Date(e):new Date;for(let s=-7;s<=7;s++){const e=new Date(t);e.setDate(t.getDate()+s),a.push(B(e))}if(x.value=a,e){const a=x.value.findIndex((a=>a.date===e));-1!==a&&(C.value=a)}else C.value=7}function B(e){const a=e.toISOString().split("T")[0],t=(new Date).toISOString().split("T")[0];return{date:a,day:e.getDate().toString(),month:`${e.getMonth()+1}æœˆ`,weekday:`å‘¨${["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][e.getDay()]}`,isToday:a===t}}function M(e="forward",a=7){if("forward"===e){const e=new Date(x.value[x.value.length-1].date);for(let t=1;t<=a;t++){const a=new Date(e);a.setDate(e.getDate()+t),x.value.push(B(a))}}else{const e=new Date(x.value[0].date),t=[];for(let s=a;s>=1;s--){const a=new Date(e);a.setDate(e.getDate()-s),t.push(B(a))}x.value=[...t,...x.value],C.value+=a}}function L(){C.value>0?C.value--:(M("backward",7),C.value=6);const e=x.value[C.value];b("dateChange",e.date)}function q(){C.value<x.value.length-1||M("forward",7),C.value++;const e=x.value[C.value];b("dateChange",e.date)}function A(e){const a=x.value.findIndex((a=>a.date===e));-1!==a?C.value=a:j(e),b("dateChange",e)}function P(){_((()=>{const e=T.value;e&&e.click()}))}function G(e){A(e.detail.value)}return a((()=>{const e=(new Date).toISOString().split("T")[0];return S.selectedDate===e})),t((()=>S.selectedDate),(e=>{const a=x.value.findIndex((a=>a.date===e));-1!==a?C.value=a:A(e)})),t(C,(e=>{e<=2?M("backward",7):e>=x.value.length-3&&M("forward",7)})),D({gotoToday:function(){A((new Date).toISOString().split("T")[0])}}),j(),(e,a)=>{const t=$(s("uni-icons"),E),_=v,D=y,k=g,S=m,j=h;return l(),c(k,{class:"date-navigator"},{default:o((()=>[n(k,{class:"date-header"},{default:o((()=>[n(_,{class:"nav-arrow nav-arrow--prev",onClick:L},{default:o((()=>[n(t,{type:"arrowleft",size:"24",color:"#7f4515"})])),_:1}),n(k,{class:"date-display",onClick:P},{default:o((()=>[n(k,{class:"date-main"},{default:o((()=>[n(D,{class:"current-day"},{default:o((()=>[u(r(I.value.day),1)])),_:1}),n(k,{class:"date-meta"},{default:o((()=>[n(D,{class:"current-month"},{default:o((()=>[u(r(I.value.month),1)])),_:1}),n(D,{class:"current-weekday"},{default:o((()=>[u(r(I.value.weekday),1)])),_:1})])),_:1})])),_:1}),n(t,{type:"calendar",size:"20",color:"#7f4515"})])),_:1}),n(_,{class:"nav-arrow nav-arrow--next",onClick:q},{default:o((()=>[n(t,{type:"arrowright",size:"24",color:"#7f4515"})])),_:1})])),_:1}),n(k,{class:"date-slider"},{default:o((()=>[n(S,{class:"date-scroll","scroll-x":"","scroll-into-view":"date-"+C.value,"scroll-with-animation":"",enhanced:"","show-scrollbar":!1},{default:o((()=>[n(k,{class:"date-list"},{default:o((()=>[(l(!0),d(i,null,f(O.value,((e,a)=>(l(),c(k,{key:e.date,id:"date-"+a,class:p(["date-option",{"date-option--active":a===z.value,"date-option--today":e.isToday}]),onClick:e=>function(e){const a=C.value,t=Math.max(0,a-5)+e;if(t>=0&&t<x.value.length){C.value=t;const e=x.value[t];b("dateChange",e.date)}}(a)},{default:o((()=>[n(D,{class:"option-day"},{default:o((()=>[u(r(e.day),1)])),_:2},1024),n(D,{class:"option-weekday"},{default:o((()=>[u(r(e.weekday.replace("å‘¨","")),1)])),_:2},1024)])),_:2},1032,["id","class","onClick"])))),128))])),_:1})])),_:1},8,["scroll-into-view"])])),_:1}),n(j,{mode:"date",value:w.selectedDate,onChange:G,start:"2020-01-01",end:"2030-12-31"},{default:o((()=>[n(k,{class:"date-picker-trigger",ref_key:"datePickerTrigger",ref:T},null,512)])),_:1},8,["value"])])),_:1})}}},[["__scopeId","data-v-9bfc6441"]]),P=z({__name:"CourseCard",props:{course:{type:Object,default:null},isEmpty:{type:Boolean,default:!1}},setup(e){function a(e){switch(e){case"å¿…ä¿®":return"property-required";case"é€‰ä¿®":return"property-elective";case"å®è·µ":return"property-practice";default:return"property-default"}}return(t,d)=>{const i=y,f=g,_=$(s("uni-icons"),E);return l(),c(f,{class:p(["course-card",{"course-card--empty":e.isEmpty}])},{default:o((()=>[e.isEmpty?(l(),c(f,{key:1,class:"empty-content"},{default:o((()=>[n(i,{class:"empty-text"},{default:o((()=>[u("æ— è¯¾ç¨‹")])),_:1})])),_:1})):(l(),c(f,{key:0,class:"course-content"},{default:o((()=>[n(f,{class:"course-header"},{default:o((()=>[n(i,{class:"course-name"},{default:o((()=>[u(r(e.course.course_name),1)])),_:1}),n(i,{class:"course-credits"},{default:o((()=>[u(r(e.course.course_credits)+"å­¦åˆ†",1)])),_:1})])),_:1}),n(f,{class:"course-property"},{default:o((()=>[n(i,{class:p(["property-tag",a(e.course.course_property)])},{default:o((()=>[u(r(e.course.course_property),1)])),_:1},8,["class"])])),_:1}),n(f,{class:"course-time"},{default:o((()=>[n(_,{type:"clock",size:"16",color:"#7f4515"}),n(i,{class:"time-text"},{default:o((()=>[u(r(e.course.period)+"èŠ‚",1)])),_:1})])),_:1}),n(f,{class:"course-location"},{default:o((()=>[n(_,{type:"location",size:"16",color:"#7f4515"}),n(i,{class:"location-text"},{default:o((()=>[u(r(e.course.classroom),1)])),_:1})])),_:1}),e.course.class_name?(l(),c(f,{key:0,class:"course-class"},{default:o((()=>[n(i,{class:"class-text"},{default:o((()=>[u(r(e.course.class_name),1)])),_:1})])),_:1})):w("",!0)])),_:1}))])),_:1},8,["class"])}}},[["__scopeId","data-v-47c9a877"]]),G=z({__name:"ClassTableView",props:{courses:{type:Array,default:()=>[]},selectedDate:{type:String,required:!0}},setup(t){const p=t,_=e(null),m=e(null),h=a((()=>p.courses&&0!==p.courses.length?[...p.courses].sort(((e,a)=>{const t=e=>{const a=e.match(/(\d+)/);return a?parseInt(a[1]):0};return t(e.period)-t(a.period)})):[]));function D(e){if(!e)return"";const a=new Date(e),t=new Date,s=new Date(t);s.setDate(t.getDate()+1);const l=new Date(t);l.setDate(t.getDate()-1);const c=["å‘¨æ—¥","å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­"][a.getDay()];if(e===t.toISOString().split("T")[0])return`ä»Šå¤© ${c}`;if(e===s.toISOString().split("T")[0])return`æ˜å¤© ${c}`;if(e===l.toISOString().split("T")[0])return`æ˜¨å¤© ${c}`;return`${a.getMonth()+1}æœˆ${a.getDate()}æ—¥ ${c}`}function k(){var e;null==(e=_.value)||e.close(),m.value=null}return(e,a)=>{const p=y,S=g,b=$(s("uni-icons"),E),C=v,x=$(s("uni-popup"),q);return l(),c(S,{class:"classtable-view"},{default:o((()=>[t.courses&&t.courses.length>0?(l(),c(S,{key:0,class:"courses-container"},{default:o((()=>[n(S,{class:"date-header"},{default:o((()=>[n(p,{class:"date-title"},{default:o((()=>[u(r(D(t.selectedDate)),1)])),_:1}),n(p,{class:"course-count"},{default:o((()=>[u("å…± "+r(t.courses.length)+" èŠ‚è¯¾",1)])),_:1})])),_:1}),n(S,{class:"courses-list"},{default:o((()=>[(l(!0),d(i,null,f(h.value,((e,a)=>(l(),c(P,{key:a,course:e,onClick:a=>function(e){var a;m.value=e,null==(a=_.value)||a.open()}(e)},null,8,["course","onClick"])))),128))])),_:1})])),_:1})):(l(),c(S,{key:1,class:"empty-state"},{default:o((()=>[n(S,{class:"empty-icon"},{default:o((()=>[n(b,{type:"calendar",size:"80",color:"#e0e0e0"})])),_:1}),n(p,{class:"empty-title"},{default:o((()=>[u(r(D(t.selectedDate)),1)])),_:1}),n(p,{class:"empty-desc"},{default:o((()=>[u("ä»Šå¤©æ²¡æœ‰è¯¾ç¨‹å®‰æ’")])),_:1}),n(p,{class:"empty-tip"},{default:o((()=>[u("å¥½å¥½ä¼‘æ¯å§ ğŸ‰")])),_:1})])),_:1})),n(x,{ref_key:"courseDetailPopup",ref:_,type:"bottom","background-color":"#fff","z-index":1e4},{default:o((()=>[m.value?(l(),c(S,{key:0,class:"course-detail-popup"},{default:o((()=>[n(S,{class:"popup-header"},{default:o((()=>[n(p,{class:"popup-title"},{default:o((()=>[u("è¯¾ç¨‹è¯¦æƒ…")])),_:1}),n(C,{class:"close-btn",onClick:k},{default:o((()=>[n(b,{type:"close",size:"24",color:"#666"})])),_:1})])),_:1}),n(S,{class:"popup-content"},{default:o((()=>[n(S,{class:"detail-item"},{default:o((()=>[n(p,{class:"detail-label"},{default:o((()=>[u("è¯¾ç¨‹åç§°")])),_:1}),n(p,{class:"detail-value"},{default:o((()=>[u(r(m.value.course_name),1)])),_:1})])),_:1}),n(S,{class:"detail-item"},{default:o((()=>[n(p,{class:"detail-label"},{default:o((()=>[u("å­¦åˆ†")])),_:1}),n(p,{class:"detail-value"},{default:o((()=>[u(r(m.value.course_credits)+"å­¦åˆ†",1)])),_:1})])),_:1}),n(S,{class:"detail-item"},{default:o((()=>[n(p,{class:"detail-label"},{default:o((()=>[u("è¯¾ç¨‹å±æ€§")])),_:1}),n(p,{class:"detail-value"},{default:o((()=>[u(r(m.value.course_property),1)])),_:1})])),_:1}),n(S,{class:"detail-item"},{default:o((()=>[n(p,{class:"detail-label"},{default:o((()=>[u("ä¸Šè¯¾æ—¶é—´")])),_:1}),n(p,{class:"detail-value"},{default:o((()=>[u(r(m.value.class_time),1)])),_:1})])),_:1}),n(S,{class:"detail-item"},{default:o((()=>[n(p,{class:"detail-label"},{default:o((()=>[u("æ•™å®¤")])),_:1}),n(p,{class:"detail-value"},{default:o((()=>[u(r(m.value.classroom),1)])),_:1})])),_:1}),m.value.class_name?(l(),c(S,{key:0,class:"detail-item"},{default:o((()=>[n(p,{class:"detail-label"},{default:o((()=>[u("ç­çº§")])),_:1}),n(p,{class:"detail-value"},{default:o((()=>[u(r(m.value.class_name),1)])),_:1})])),_:1})):w("",!0)])),_:1})])),_:1})):w("",!0)])),_:1},512)])),_:1})}}},[["__scopeId","data-v-4306f1ce"]]),N=z({__name:"classtable",setup(t){const r=e(!0),d=e((new Date).toISOString().split("T")[0]),i=e({}),f=e(null),p=a((()=>i.value[d.value]||[])),_=a((()=>{const e=(new Date).toISOString().split("T")[0];return d.value===e}));function v(){return!!k("token")||(S({title:"è¯·å…ˆç™»å½•",icon:"none"}),b({url:"/pages/index/index"}),!1)}async function m(e){d.value=e,i.value[e]||await h(e),setTimeout((()=>{z(e)}),500)}async function h(e){const a=q(e);if(P.has(a))return;const t=k("token"),s=C().globalData.apiBaseURL;try{P.add(a),I({title:"åŠ è½½ä¸­..."});const{statusCode:l,data:c}=await x({url:`${s}/api/v1/classtable/week`,method:"GET",header:{Authorization:"Bearer "+t},data:{query_date:e}});200===l&&c.success?c.data&&c.data.days&&(c.data.days.forEach((e=>{i.value[e.date]=e.courses||[]})),N.add(a)):401===l?R():S({title:c.detail||c.message||"è·å–è¯¾ç¨‹è¡¨å¤±è´¥",icon:"none"})}catch(l){console.error("è·å–è¯¾ç¨‹å¤±è´¥",l),S({title:"ç½‘ç»œè¿æ¥å¤±è´¥",icon:"none"})}finally{O(),P.delete(a)}}async function z(e){const a=[],t=new Date(e);for(let l=-3;l<=3;l++){const e=new Date(t);e.setDate(t.getDate()+l);const s=e.toISOString().split("T")[0],c=q(s);N.has(c)||i.value[s]||a.push(s)}const s=[...new Set(a.map((e=>q(e))))];for(const l of s){const e=a.find((e=>q(e)===l));e&&await h(e)}}function q(e){const a=new Date(e),t=new Date(a),s=a.getDay(),l=a.getDate()-s+(0===s?-6:1);return t.setDate(l),t.toISOString().split("T")[0]}j((()=>{v()&&(D({title:"è¯¾ç¨‹è¡¨"}),async function(){r.value=!0;const e=k("token"),a=C().globalData.apiBaseURL;try{const{statusCode:t,data:s}=await x({url:`${a}/api/v1/classtable/today`,method:"GET",header:{Authorization:"Bearer "+e}});if(200===t&&s.success){const e=s.data.date;i.value[e]=s.data.courses||[],d.value=e,N.add(q(e)),setTimeout((()=>{z(e)}),1e3)}else 401===t?R():S({title:s.detail||s.message||"è·å–è¯¾ç¨‹è¡¨å¤±è´¥",icon:"none"})}catch(t){console.error("è·å–ä»Šæ—¥è¯¾ç¨‹å¤±è´¥",t),S({title:"ç½‘ç»œè¿æ¥å¤±è´¥",icon:"none"})}finally{r.value=!1}}())})),B((()=>{v()}));const P=new Set,N=new Set;function R(){T("token"),S({title:"ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•",icon:"none"}),setTimeout((()=>b({url:"/pages/index/index"})),1500)}function U(){f.value&&f.value.gotoToday()}return(e,a)=>{const t=g,i=y,v=$(s("uni-icons"),E);return l(),c(M,null,{default:o((()=>[r.value?(l(),c(L,{key:0,text:"æ­£åœ¨åŠ è½½è¯¾è¡¨æ•°æ®..."})):(l(),c(t,{key:1,class:"page-container page-rounded-container"},{default:o((()=>[n(t,{class:"background-decoration"},{default:o((()=>[n(t,{class:"circle circle-1"}),n(t,{class:"circle circle-2"}),n(t,{class:"circle circle-3"})])),_:1}),n(t,{class:"page-header"},{default:o((()=>[n(t,{class:"header-content"},{default:o((()=>[n(i,{class:"page-title"},{default:o((()=>[u("è¯¾ç¨‹è¡¨")])),_:1}),n(i,{class:"page-subtitle"},{default:o((()=>[u("Class Schedule")])),_:1})])),_:1})])),_:1}),n(t,{class:"content-wrapper"},{default:o((()=>[n(A,{ref_key:"dateNavigatorRef",ref:f,"selected-date":d.value,onDateChange:m},null,8,["selected-date"]),n(G,{courses:p.value,"selected-date":d.value},null,8,["courses","selected-date"])])),_:1})])),_:1})),_.value?w("",!0):(l(),c(t,{key:2,class:"floating-today-btn",onClick:U},{default:o((()=>[n(v,{type:"home",size:"24",color:"#fff"}),n(i,{class:"today-text"},{default:o((()=>[u("ä»Šæ—¥")])),_:1})])),_:1}))])),_:1})}}},[["__scopeId","data-v-0e9ba77b"]]);export{N as default};

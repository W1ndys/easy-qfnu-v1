import{p as e,P as t,q as s,s as a,u as l,x as r,z as o,l as u,v as c,r as n,c as i,w as d,o as f,a as m,j as _,n as p,t as v,d as h,b,f as y,K as x,F as g,Q as k,k as N,g as w,J as C,R as j,T as M,B as q}from"./index-CQlUSE66.js";import{_ as $,o as z,b as E,c as T,r as A,a as B}from"./uni-app.es.BxkoSt8v.js";import{P as F,M as R}from"./ModernCard.B0MZPj1q.js";import{L as I,E as L}from"./EmptyState.CYfP0U8W.js";const O=$({__name:"index",setup($){const O=e(!0),P=e([]),S=e([]),D=e(!1),G=t((()=>[...P.value].sort(((e,t)=>{const s=W(e),a=W(t);return s&&!a?-1:!s&&a?1:0})).map((e=>{const t=W(e);return{...e,courses:[...e.courses||[]].sort(((e,s)=>{const a=H(e),l=H(s);if(t){if(!a&&l)return-1;if(a&&!l)return 1;if(!a&&!l){const t=V(e),a=V(s);if(t&&!a)return-1;if(!t&&a)return 1}}else{if(a&&!l)return-1;if(!a&&l)return 1}const r=Number(e.semester)||0,o=Number(s.semester)||0;return r!==o?o-r:0}))}}))));z((()=>{J()})),E((()=>{if(!s("token"))return a({title:"请先登录",icon:"none"}),void l({url:"/pages/index/index"})})),T((async()=>{if(!s("token"))return a({title:"请先登录",icon:"none"}),l({url:"/pages/index/index"}),void r();await K(),r()}));const J=()=>{if(!s("token"))return a({title:"请先登录",icon:"none"}),void l({url:"/pages/index/index"});K()},K=async()=>{var e,t,r;const n=s("token");if(!n)return a({title:"请先登录",icon:"none"}),void l({url:"/pages/index/index"});O.value=!0;try{const s=await o({url:`${u().globalData.apiBaseURL}/api/v1/course-plan`,method:"GET",header:{Authorization:"Bearer "+n}});let i=null;if(200!==s.statusCode){if(401===s.statusCode)return console.error("身份验证失败，请重新登录"),c("token"),a({title:"登录已过期，请重新登录",icon:"none"}),void setTimeout((()=>{l({url:"/pages/index/index"})}),1500);if(404===s.statusCode)return console.error("未找到培养方案数据"),void a({title:"未找到培养方案数据",icon:"none"});{const e=(null==(t=s.data)?void 0:t.detail)||(null==(r=s.data)?void 0:r.message)||"未知错误";throw console.error(`请求错误：${s.statusCode}`,s.data,e),new Error(`请求错误：${s.statusCode} - ${e}`)}}if(i=(null==(e=s.data)?void 0:e.success)?s.data.data:s.data,console.log("培养方案数据获取成功",i),!i)throw new Error("无有效数据");if(!Array.isArray(i.modules))return console.warn("返回的培养方案格式异常",i),a({title:"培养方案格式异常",icon:"none"}),void(P.value=[]);P.value=i.modules,console.log(`成功加载了${P.value.length}个培养方案模块`),S.value=P.value.map((()=>!1)),0===P.value.length?a({title:"暂无培养方案数据",icon:"none"}):Q()}catch(i){console.error("获取培养方案失败",i),a({title:i.message||"获取培养方案失败，请稍后重试",icon:"none",duration:2e3})}finally{O.value=!1}},Q=()=>{setTimeout((()=>{D.value=!0}),500)},U=e=>P.value.findIndex((t=>t.module_name===e.module_name)),H=e=>!!e.completion_status&&e.completion_status.includes("已修"),V=e=>{if(!e.semester)return!1;const t=Number(e.semester);return t<=7&&t%2==1},W=e=>{const t=Number(null==e?void 0:e.required_credits)||0;return(Number(null==e?void 0:e.completed_credits)||0)<t},X=e=>{const t=Number(null==e?void 0:e.required_credits)||0,s=Number(null==e?void 0:e.completed_credits)||0;if(t<=0)return 0;return Math.min(100,Math.max(0,Math.round(s/t*100)))},Y=e=>{if(!e.courses||0===e.courses.length)return{total:0};return e.courses.filter(H).reduce(((e,t)=>{if(t.hours&&"object"==typeof t.hours)for(const[s,a]of Object.entries(t.hours))e[s]=(e[s]||0)+(Number(a)||0);return e}),{})},Z=e=>{if(!e||"object"!=typeof e)return[];const t={lecture:"讲授",practice:"实践",seminar:"研讨",experiment:"实验",design:"设计",computer:"上机",discussion:"讨论",extracurricular:"课外",online:"在线"};return Object.entries(e).filter((([e,t])=>"total"!==e&&Number(t)>0)).map((([e,s])=>`${t[e]||e}: ${s}`))},ee=e=>{const t=Number(e);return Number.isNaN(t)?"0":t%1==0?String(t):t.toFixed(1)},te=t((()=>P.value.reduce(((e,t)=>e+(Number(t.required_credits)||0)),0))),se=t((()=>P.value.reduce(((e,t)=>e+(Number(t.completed_credits)||0)),0))),ae=t((()=>{if(te.value<=0)return 0;return Math.min(100,Math.max(0,Math.round(se.value/te.value*100)))})),le=t((()=>se.value<te.value)),re=()=>{D.value=!1},oe=()=>{D.value=!1};return(e,t)=>{const s=N,l=w,r=A(n("uni-icons"),B),o=C;return f(),i(F,null,{default:d((()=>[O.value?(f(),i(I,{key:0,text:"正在获取培养方案..."})):(f(),i(l,{key:1,class:"page-rounded-container"},{default:d((()=>[0===P.value.length?(f(),i(L,{key:0,"icon-type":"info-filled",title:"暂无培养方案数据",description:"请稍后重试或下拉刷新","show-retry":!0,onRetry:K})):(f(),i(l,{key:1},{default:d((()=>[m(R,{title:"总学分进度",class:"total-progress-card"},{default:d((()=>[m(l,{class:"total-progress-container"},{default:d((()=>[m(l,{class:"total-header"},{default:d((()=>[m(l,{class:"total-title-section"},{default:d((()=>[m(s,{class:"total-title"},{default:d((()=>[_("培养方案总进度")])),_:1}),m(l,{class:p(["status-chip",le.value?"chip-module-incomplete":"chip-module-complete"])},{default:d((()=>[m(s,null,{default:d((()=>[_(v(le.value?"未修满":"已修满"),1)])),_:1})])),_:1},8,["class"])])),_:1}),m(l,{class:"total-credits-info"},{default:d((()=>[m(s,{class:"total-credits-text"},{default:d((()=>[_(v(ee(se.value))+"/"+v(ee(te.value))+" 学分",1)])),_:1}),le.value?(f(),i(s,{key:0,class:"total-shortage-text"},{default:d((()=>[_("差 "+v(ee(te.value-se.value))+" 学分",1)])),_:1})):h("",!0),m(s,{class:"total-hint-text"},{default:d((()=>[_(" (相对于系统内方案，实际差值要看总学分要求，大部分专业是少几分的) ")])),_:1})])),_:1}),m(l,{class:"total-progress-bar-container"},{default:d((()=>[m(l,{class:"progress-bar total-progress-bar"},{default:d((()=>[m(l,{class:p(["progress-fill",{danger:le.value}]),style:b({width:ae.value+"%"})},null,8,["style","class"])])),_:1}),m(s,{class:"progress-text total-progress-text"},{default:d((()=>[_(v(ae.value)+"%",1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),m(R,{title:"培养方案模块"},{default:d((()=>[m(l,{class:"modules-list"},{default:d((()=>[(f(!0),y(g,null,x(G.value,((e,t)=>(f(),i(l,{key:e.module_name,class:p(["module-card",{incomplete:W(e),expanded:S.value[U(e)]}])},{default:d((()=>[m(l,{class:"module-header",onClick:t=>{return s=U(e),void(S.value[s]=!S.value[s]);var s}},{default:d((()=>[m(l,{class:"header-info"},{default:d((()=>[m(l,{class:"header-top"},{default:d((()=>[m(s,{class:"module-title"},{default:d((()=>[_(v(e.module_name),1)])),_:2},1024),m(l,{class:p(["status-chip",W(e)?"chip-module-incomplete":"chip-module-complete"])},{default:d((()=>[m(s,null,{default:d((()=>[_(v(W(e)?"未修满":"已修满"),1)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024),m(l,{class:"header-middle"},{default:d((()=>[m(l,{class:"credits-info"},{default:d((()=>[m(s,{class:"credits-text"},{default:d((()=>[_(v(ee(e.completed_credits))+"/"+v(ee(e.required_credits))+" 学分",1)])),_:2},1024),W(e)?(f(),i(s,{key:0,class:"shortage-text"},{default:d((()=>[_("差 "+v(ee(Number(e.required_credits)-Number(e.completed_credits)))+" 学分",1)])),_:2},1024)):h("",!0)])),_:2},1024),m(l,{class:"expand-action"},{default:d((()=>[S.value[U(e)]?(f(),i(s,{key:1,class:"hint-text"},{default:d((()=>[_("点击收起")])),_:1})):(f(),i(s,{key:0,class:"hint-text"},{default:d((()=>[_("点击展开")])),_:1})),m(r,{class:p(["chevron-icon",{expanded:S.value[U(e)]}]),type:"arrowdown",size:"20",color:"#7F4515"},null,8,["class"])])),_:2},1024)])),_:2},1024),m(l,{class:"progress-container"},{default:d((()=>[m(l,{class:"progress-bar"},{default:d((()=>[m(l,{class:p(["progress-fill",{danger:W(e)}]),style:b({width:X(e)+"%"})},null,8,["style","class"])])),_:2},1024),m(s,{class:"progress-text"},{default:d((()=>[_(v(X(e))+"%",1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"]),j(m(l,{class:"course-details"},{default:d((()=>[e.subtotal?(f(),i(l,{key:0,class:"module-subtotal"},{default:d((()=>[m(s,{class:"subtotal-title"},{default:d((()=>[_("模块要求小计")])),_:1}),m(s,{class:"subtotal-credits"},{default:d((()=>[_("要求学分 "+v(e.subtotal.total_credits),1)])),_:2},1024),m(s,{class:"subtotal-hours"},{default:d((()=>{var t;return[_("要求总学时 "+v((null==(t=e.subtotal.hours)?void 0:t.total)||0),1)]})),_:2},1024),m(l,{class:"subtotal-divider"}),m(s,{class:"subtotal-title"},{default:d((()=>[_("已修课程小计")])),_:1}),m(l,{class:"subtotal-completed-group"},{default:d((()=>[m(s,{class:"subtotal-hours"},{default:d((()=>[_(" 已修总学时 "+v(Y(e).total||0),1)])),_:2},1024),(f(!0),y(g,null,x(Z(Y(e)),(e=>(f(),i(s,{key:e,class:"subtotal-meta"},{default:d((()=>[_(v(e),1)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)):h("",!0),m(l,{class:"course-sort-hint"},{default:d((()=>[m(s,{class:"sort-hint-text"},{default:d((()=>[m(r,{type:"info",size:"16",color:"#666"}),_(" "+v(W(e)?"未修课程已置顶显示，本学期课程优先":"已修课程已置顶显示"),1)])),_:2},1024)])),_:2},1024),m(l,{class:"course-list"},{default:d((()=>[(f(!0),y(g,null,x(e.courses||[],(e=>(f(),i(l,{key:(e.course_code||"")+(e.course_name||""),class:p(["course-item",{completed:H(e)}])},{default:d((()=>[m(l,{class:"course-main"},{default:d((()=>[m(l,{class:"course-title-section"},{default:d((()=>[m(l,{class:"course-name-wrapper"},{default:d((()=>[m(s,{class:"course-name"},{default:d((()=>[_(v(e.course_name),1)])),_:2},1024),V(e)&&!H(e)?(f(),i(s,{key:0,class:"current-semester-tag"},{default:d((()=>[_("本学期可选")])),_:1})):h("",!0)])),_:2},1024),e.course_code?(f(),i(s,{key:0,class:"course-code",onClick:k((t=>{var s;(s=e.course_code)&&q({data:s,success:()=>{a({title:"课程代码已复制",icon:"none"})}})}),["stop"])},{default:d((()=>[_("代码: "+v(e.course_code),1)])),_:2},1032,["onClick"])):h("",!0)])),_:2},1024),m(l,{class:"chips"},{default:d((()=>[m(s,{class:p(["chip completion-chip",H(e)?"chip-completed":"chip-incomplete"])},{default:d((()=>[_(v(e.completion_status||"未修"),1)])),_:2},1032,["class"]),e.course_nature?(f(),i(s,{key:0,class:"chip chip-neutral"},{default:d((()=>[_(v(e.course_nature),1)])),_:2},1024)):h("",!0),e.course_attribute?(f(),i(s,{key:1,class:"chip chip-neutral"},{default:d((()=>[_(v(e.course_attribute),1)])),_:2},1024)):h("",!0)])),_:2},1024)])),_:2},1024),m(l,{class:"course-meta"},{default:d((()=>{var t;return[m(s,{class:"meta"},{default:d((()=>[_("学分 "+v(e.credits),1)])),_:2},1024),e.semester?(f(),i(s,{key:0,class:"meta"},{default:d((()=>[_("学期 "+v(e.semester),1)])),_:2},1024)):h("",!0),(null==(t=e.hours)?void 0:t.total)?(f(),i(s,{key:1,class:"meta"},{default:d((()=>[_("总学时 "+v(e.hours.total),1)])),_:2},1024)):h("",!0),(f(!0),y(g,null,x(Z(e.hours),(e=>(f(),i(s,{key:e,class:"meta"},{default:d((()=>[_(v(e),1)])),_:2},1024)))),128))]})),_:2},1024)])),_:2},1032,["class"])))),128))])),_:2},1024)])),_:2},1536),[[M,S.value[U(e)]]])])),_:2},1032,["class"])))),128))])),_:1})])),_:1})])),_:1}))])),_:1})),D.value?(f(),i(l,{key:2,class:"modal-overlay",onClick:oe},{default:d((()=>[m(l,{class:"modal-container",onClick:t[0]||(t[0]=k((()=>{}),["stop"]))},{default:d((()=>[m(l,{class:"modal-header"},{default:d((()=>[m(r,{type:"info-filled",size:"24",color:"#1890ff"}),m(s,{class:"modal-title"},{default:d((()=>[_("培养方案说明")])),_:1})])),_:1}),m(l,{class:"modal-content"},{default:d((()=>[m(s,{class:"notice-text"},{default:d((()=>[_(" 本页面由教务系统培养方案表格直接生成，大部分专业的应修是160或170或175，该培养方案总和大部分都不足够（22级是），少的那些分就是你应该选的公选课的分。如果不够，请及时与对应负责老师沟通。 ")])),_:1}),m(s,{class:"notice-text",style:{"margin-top":"24rpx"}},{default:d((()=>[_(" 根据教务处官方规定：培养方案毕业学分原则上145-170学分，其中人文社会科学类专业毕业学分≤160学分，理科类专业毕业学分≤165学分，工科类专业毕业学分≤170学分，辅修学士学位专业毕业学分70学分左右。 ")])),_:1}),m(s,{class:"notice-text",style:{"margin-top":"16rpx","font-size":"24rpx",color:"#8c8c8c"}},{default:d((()=>[_(" 来源：https://jwc.qfnu.edu.cn/info/1068/7039.htm ")])),_:1})])),_:1}),m(l,{class:"modal-actions"},{default:d((()=>[m(o,{class:"action-btn primary-btn",onClick:re},{default:d((()=>[_(" 我已阅读 ")])),_:1})])),_:1})])),_:1})])),_:1})):h("",!0)])),_:1})}}},[["__scopeId","data-v-2085c6ae"]]);export{O as default};

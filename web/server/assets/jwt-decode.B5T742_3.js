"use strict";const e=require("@dcloudio/uni-h5");function r(r){if("undefined"!=typeof wx&&e.arrayBufferToBase64)try{const o=e.base64ToArrayBuffer(r),n=new Uint8Array(o);let t="";for(let e=0;e<n.length;e++)t+=String.fromCharCode(n[e]);return t}catch(a){}if("undefined"!=typeof atob)return atob(r);const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";let n="",t=0;for(r=r.replace(/[^A-Za-z0-9+/]/g,"");t<r.length;){const e=o.indexOf(r.charAt(t++)),a=o.indexOf(r.charAt(t++)),c=o.indexOf(r.charAt(t++)),s=o.indexOf(r.charAt(t++)),i=e<<18|a<<12|c<<6|s,l=i>>16&255,f=i>>8&255,h=255&i;n+=String.fromCharCode(l),64!==c&&(n+=String.fromCharCode(f)),64!==s&&(n+=String.fromCharCode(h))}return n}function o(e){var o=e.replace(/-/g,"+").replace(/_/g,"/");switch(o.length%4){case 0:break;case 2:o+="==";break;case 3:o+="=";break;default:throw new Error("Illegal base64url string!")}try{return function(e){try{const o=r(e);return decodeURIComponent(o.replace(/(.)/g,(function(e,r){var o=r.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o})))}catch(o){return r(e)}}(o)}catch(n){return console.warn("Unicode解码失败，尝试直接base64解码:",n),r(o)}}function n(e){if(console.log("开始解析JWT token..."),"string"!=typeof e)throw console.error("Token不是字符串类型:",typeof e),new Error("Invalid token specified");if(!e||""===e.trim())throw console.error("Token为空"),new Error("Token is empty");const r=e.split(".");if(console.log("Token分割结果:",r.length,"个部分"),3!==r.length)throw console.error("JWT格式错误，应该有3个部分，实际有:",r.length),new Error("JWT must have 3 parts");try{const e=o(r[1]);if(console.log("Base64解码成功"),!e)throw console.error("Base64解码结果为空"),new Error("Cannot decode the token.");const n=JSON.parse(e);if(console.log("JWT解析成功，payload:",n),n.exp){const e=Math.floor(Date.now()/1e3);if(n.exp<e)throw console.error("Token已过期，过期时间:",new Date(1e3*n.exp),"当前时间:",new Date),new Error("Token has expired")}return n}catch(n){throw console.error("JWT解析失败:",n),n}}exports.decode=n,exports.isTokenValid=function(e){try{return n(e),!0}catch(r){return console.log("Token验证失败:",r.message),!1}};

import{p as e,O as t,q as a,s,u as l,x as o,z as u,l as r,v as c,r as n,c as d,w as i,o as f,a as _,j as m,n as p,t as v,d as h,b as x,f as y,J as g,F as b,P as k,k as w,g as N,H as C,Q as M,R as q}from"./index-Gt-p3bjT.js";import{_ as j,o as z,b as E,c as $,r as A,a as F}from"./uni-app.es.qJWf9OlL.js";import{P as R,M as T}from"./ModernCard.Dq1oi0Yt.js";import{L as B,E as I}from"./EmptyState.B5CpJx7s.js";const L=j({__name:"index",setup(j){const L=e(!0),P=e([]),S=e([]),D=e(!1),G=t((()=>[...P.value].sort(((e,t)=>{const a=K(e),s=K(t);return a&&!s?-1:!a&&s?1:0})).map((e=>{const t=K(e);return{...e,courses:[...e.courses||[]].sort(((e,a)=>{const s=U(e),l=U(a);if(t){if(!s&&l)return-1;if(s&&!l)return 1}else{if(s&&!l)return-1;if(!s&&l)return 1}return 0}))}}))));z((()=>{H()})),E((()=>{if(!a("token"))return s({title:"请先登录",icon:"none"}),void l({url:"/pages/index/index"})})),$((async()=>{if(!a("token"))return s({title:"请先登录",icon:"none"}),l({url:"/pages/index/index"}),void o();await J(),o()}));const H=()=>{if(!a("token"))return s({title:"请先登录",icon:"none"}),void l({url:"/pages/index/index"});J()},J=async()=>{var e,t,o;const n=a("token");if(!n)return s({title:"请先登录",icon:"none"}),void l({url:"/pages/index/index"});L.value=!0;try{const a=await u({url:`${r().globalData.apiBaseURL}/api/v1/course-plan`,method:"GET",header:{Authorization:"Bearer "+n}});let d=null;if(200!==a.statusCode){if(401===a.statusCode)return console.error("身份验证失败，请重新登录"),c("token"),s({title:"登录已过期，请重新登录",icon:"none"}),void setTimeout((()=>{l({url:"/pages/index/index"})}),1500);if(404===a.statusCode)return console.error("未找到培养方案数据"),void s({title:"未找到培养方案数据",icon:"none"});{const e=(null==(t=a.data)?void 0:t.detail)||(null==(o=a.data)?void 0:o.message)||"未知错误";throw console.error(`请求错误：${a.statusCode}`,a.data,e),new Error(`请求错误：${a.statusCode} - ${e}`)}}if(d=(null==(e=a.data)?void 0:e.success)?a.data.data:a.data,console.log("培养方案数据获取成功",d),!d)throw new Error("无有效数据");if(!Array.isArray(d.modules))return console.warn("返回的培养方案格式异常",d),s({title:"培养方案格式异常",icon:"none"}),void(P.value=[]);P.value=d.modules,console.log(`成功加载了${P.value.length}个培养方案模块`),S.value=P.value.map((()=>!1)),0===P.value.length?s({title:"暂无培养方案数据",icon:"none"}):O()}catch(d){console.error("获取培养方案失败",d),s({title:d.message||"获取培养方案失败，请稍后重试",icon:"none",duration:2e3})}finally{L.value=!1}},O=()=>{setTimeout((()=>{D.value=!0}),500)},Q=e=>P.value.findIndex((t=>t.module_name===e.module_name)),U=e=>!!e.completion_status&&e.completion_status.includes("已修"),K=e=>{const t=Number(null==e?void 0:e.required_credits)||0;return(Number(null==e?void 0:e.completed_credits)||0)<t},V=e=>{const t=Number(null==e?void 0:e.required_credits)||0,a=Number(null==e?void 0:e.completed_credits)||0;if(t<=0)return 0;return Math.min(100,Math.max(0,Math.round(a/t*100)))},W=e=>{const t=Number(e);return Number.isNaN(t)?"0":t%1==0?String(t):t.toFixed(1)},X=t((()=>P.value.reduce(((e,t)=>e+(Number(t.required_credits)||0)),0))),Y=t((()=>P.value.reduce(((e,t)=>e+(Number(t.completed_credits)||0)),0))),Z=t((()=>{if(X.value<=0)return 0;return Math.min(100,Math.max(0,Math.round(Y.value/X.value*100)))})),ee=t((()=>Y.value<X.value)),te=()=>{D.value=!1},ae=()=>{D.value=!1};return(e,t)=>{const a=w,s=N,l=A(n("uni-icons"),F),o=C;return f(),d(R,null,{default:i((()=>[L.value?(f(),d(B,{key:0,text:"正在获取培养方案..."})):(f(),d(s,{key:1,class:"page-rounded-container"},{default:i((()=>[0===P.value.length?(f(),d(I,{key:0,"icon-type":"info-filled",title:"暂无培养方案数据",description:"请稍后重试或下拉刷新","show-retry":!0,onRetry:J})):(f(),d(s,{key:1},{default:i((()=>[_(T,{title:"总学分进度",class:"total-progress-card"},{default:i((()=>[_(s,{class:"total-progress-container"},{default:i((()=>[_(s,{class:"total-header"},{default:i((()=>[_(s,{class:"total-title-section"},{default:i((()=>[_(a,{class:"total-title"},{default:i((()=>[m("培养方案总进度")])),_:1}),_(s,{class:p(["status-chip",ee.value?"chip-module-incomplete":"chip-module-complete"])},{default:i((()=>[_(a,null,{default:i((()=>[m(v(ee.value?"未修满":"已修满"),1)])),_:1})])),_:1},8,["class"])])),_:1}),_(s,{class:"total-credits-info"},{default:i((()=>[_(a,{class:"total-credits-text"},{default:i((()=>[m(v(W(Y.value))+"/"+v(W(X.value))+" 学分",1)])),_:1}),ee.value?(f(),d(a,{key:0,class:"total-shortage-text"},{default:i((()=>[m("差 "+v(W(X.value-Y.value))+" 学分",1)])),_:1})):h("",!0),_(a,{class:"total-hint-text"},{default:i((()=>[m(" (相对于系统内方案，实际差值要看总学分要求，大部分专业是少几分的) ")])),_:1})])),_:1}),_(s,{class:"total-progress-bar-container"},{default:i((()=>[_(s,{class:"progress-bar total-progress-bar"},{default:i((()=>[_(s,{class:p(["progress-fill",{danger:ee.value}]),style:x({width:Z.value+"%"})},null,8,["style","class"])])),_:1}),_(a,{class:"progress-text total-progress-text"},{default:i((()=>[m(v(Z.value)+"%",1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),_(T,{title:"培养方案模块"},{default:i((()=>[_(s,{class:"modules-list"},{default:i((()=>[(f(!0),y(b,null,g(G.value,((e,t)=>(f(),d(s,{key:e.module_name,class:p(["module-card",{incomplete:K(e),expanded:S.value[Q(e)]}])},{default:i((()=>[_(s,{class:"module-header",onClick:t=>{return a=Q(e),void(S.value[a]=!S.value[a]);var a}},{default:i((()=>[_(s,{class:"header-info"},{default:i((()=>[_(s,{class:"header-top"},{default:i((()=>[_(a,{class:"module-title"},{default:i((()=>[m(v(e.module_name),1)])),_:2},1024),_(s,{class:p(["status-chip",K(e)?"chip-module-incomplete":"chip-module-complete"])},{default:i((()=>[_(a,null,{default:i((()=>[m(v(K(e)?"未修满":"已修满"),1)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024),_(s,{class:"header-middle"},{default:i((()=>[_(s,{class:"credits-info"},{default:i((()=>[_(a,{class:"credits-text"},{default:i((()=>[m(v(W(e.completed_credits))+"/"+v(W(e.required_credits))+" 学分",1)])),_:2},1024),K(e)?(f(),d(a,{key:0,class:"shortage-text"},{default:i((()=>[m("差 "+v(W(Number(e.required_credits)-Number(e.completed_credits)))+" 学分",1)])),_:2},1024)):h("",!0)])),_:2},1024),_(s,{class:"expand-action"},{default:i((()=>[S.value[Q(e)]?(f(),d(a,{key:1,class:"hint-text"},{default:i((()=>[m("点击收起")])),_:1})):(f(),d(a,{key:0,class:"hint-text"},{default:i((()=>[m("点击展开")])),_:1})),_(l,{class:p(["chevron-icon",{expanded:S.value[Q(e)]}]),type:"arrowdown",size:"20",color:"#7F4515"},null,8,["class"])])),_:2},1024)])),_:2},1024),_(s,{class:"progress-container"},{default:i((()=>[_(s,{class:"progress-bar"},{default:i((()=>[_(s,{class:p(["progress-fill",{danger:K(e)}]),style:x({width:V(e)+"%"})},null,8,["style","class"])])),_:2},1024),_(a,{class:"progress-text"},{default:i((()=>[m(v(V(e))+"%",1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"]),M(_(s,{class:"course-details"},{default:i((()=>[_(s,{class:"course-sort-hint"},{default:i((()=>[_(a,{class:"sort-hint-text"},{default:i((()=>[_(l,{type:"info",size:"16",color:"#666"}),m(" "+v(K(e)?"未修课程已置顶显示":"已修课程已置顶显示"),1)])),_:2},1024)])),_:2},1024),_(s,{class:"course-list"},{default:i((()=>[(f(!0),y(b,null,g(e.courses||[],(e=>(f(),d(s,{key:(e.course_code||"")+(e.course_name||""),class:p(["course-item",{completed:U(e)}])},{default:i((()=>[_(s,{class:"course-main"},{default:i((()=>[_(s,{class:"course-title-section"},{default:i((()=>[_(a,{class:"course-name"},{default:i((()=>[m(v(e.course_name),1)])),_:2},1024)])),_:2},1024),_(s,{class:"chips"},{default:i((()=>[_(a,{class:p(["chip completion-chip",U(e)?"chip-completed":"chip-incomplete"])},{default:i((()=>[m(v(e.completion_status||"未修"),1)])),_:2},1032,["class"]),e.course_nature?(f(),d(a,{key:0,class:"chip chip-neutral"},{default:i((()=>[m(v(e.course_nature),1)])),_:2},1024)):h("",!0),e.course_attribute?(f(),d(a,{key:1,class:"chip chip-neutral"},{default:i((()=>[m(v(e.course_attribute),1)])),_:2},1024)):h("",!0)])),_:2},1024)])),_:2},1024),_(s,{class:"course-meta"},{default:i((()=>{var t;return[_(a,{class:"meta"},{default:i((()=>[m("学分 "+v(e.credits),1)])),_:2},1024),e.semester?(f(),d(a,{key:0,class:"meta"},{default:i((()=>[m("学期 "+v(e.semester),1)])),_:2},1024)):h("",!0),(null==(t=e.hours)?void 0:t.total)?(f(),d(a,{key:1,class:"meta"},{default:i((()=>[m("学时 "+v(e.hours.total),1)])),_:2},1024)):h("",!0)]})),_:2},1024)])),_:2},1032,["class"])))),128))])),_:2},1024),e.subtotal?(f(),d(s,{key:0,class:"module-subtotal"},{default:i((()=>[_(a,{class:"subtotal-title"},{default:i((()=>[m("小计")])),_:1}),_(a,{class:"subtotal-credits"},{default:i((()=>[m("学分 "+v(e.subtotal.total_credits),1)])),_:2},1024),_(a,{class:"subtotal-hours"},{default:i((()=>{var t;return[m("总学时 "+v(null==(t=e.subtotal.hours)?void 0:t.total),1)]})),_:2},1024)])),_:2},1024)):h("",!0)])),_:2},1536),[[q,S.value[Q(e)]]])])),_:2},1032,["class"])))),128))])),_:1})])),_:1})])),_:1}))])),_:1})),D.value?(f(),d(s,{key:2,class:"modal-overlay",onClick:ae},{default:i((()=>[_(s,{class:"modal-container",onClick:t[0]||(t[0]=k((()=>{}),["stop"]))},{default:i((()=>[_(s,{class:"modal-header"},{default:i((()=>[_(l,{type:"info-filled",size:"24",color:"#1890ff"}),_(a,{class:"modal-title"},{default:i((()=>[m("培养方案说明")])),_:1})])),_:1}),_(s,{class:"modal-content"},{default:i((()=>[_(a,{class:"notice-text"},{default:i((()=>[m(" 本页面由教务系统培养方案表格直接生成，大部分专业的应修是160或170或175，该培养方案总和大部分都不足够（22级是），少的那些分就是你应该选的公选课的分。如果不够，请及时与对应负责老师沟通。 ")])),_:1}),_(a,{class:"notice-text",style:{"margin-top":"24rpx"}},{default:i((()=>[m(" 根据教务处官方规定：培养方案毕业学分原则上145-170学分，其中人文社会科学类专业毕业学分≤160学分，理科类专业毕业学分≤165学分，工科类专业毕业学分≤170学分，辅修学士学位专业毕业学分70学分左右。 ")])),_:1}),_(a,{class:"notice-text",style:{"margin-top":"16rpx","font-size":"24rpx",color:"#8c8c8c"}},{default:i((()=>[m(" 来源：https://jwc.qfnu.edu.cn/info/1068/7039.htm ")])),_:1})])),_:1}),_(s,{class:"modal-actions"},{default:i((()=>[_(o,{class:"action-btn primary-btn",onClick:te},{default:i((()=>[m(" 我已阅读 ")])),_:1})])),_:1})])),_:1})])),_:1})):h("",!0)])),_:1})}}},[["__scopeId","data-v-58fd2fde"]]);export{L as default};
